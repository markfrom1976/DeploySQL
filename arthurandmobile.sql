-- IMPORTANT - DO NOT REMOVE --
USE [TEAMS]
GO
-- IMPORTANT - DO NOT REMOVE - END --

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

SET ANSI_PADDING ON
GO
BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcIdMap'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcIdMap](
			[MobileDtcIdMapId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[TableName] [varchar](50) NOT NULL,
			[MobileId] [int] NOT NULL,
			[ServerId] [int] NOT NULL,
			[SetDtc] [bit] NULL,
		 CONSTRAINT [PK_MobileDtcIdMap_MobileDtcIdMapId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcIdMapId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]
	END 
COMMIT TRANSACTION
GO
SET ANSI_PADDING OFF
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

SET ANSI_PADDING ON
GO
BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcLog'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcLog](
			[MobileDtcLogId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[App] [varchar](50) NOT NULL,
			[Source] [varchar](50) NOT NULL,
			[Step] [varchar](200) NOT NULL,
			[EmployeeId] [int] NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[DateCompleted] [datetime] NULL,
		 CONSTRAINT [PK_MobileDtcLog_MobileDtcLogId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcLogId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]
	END 
COMMIT TRANSACTION
GO
SET ANSI_PADDING OFF
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_NextSampleRefBySystemName]    Script Date: 06/20/2018 12:29:18 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC

	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated, EmployeeID)
			SELECT 2, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE(), @EmployeeID

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
	
END




GO
USE [TEAMS]
-- Config.
IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'LegionellaID' AND OBJECT_ID = OBJECT_ID('TestEmployee'))
BEGIN
    ALTER TABLE TestEmployee
    ADD [LegionellaID] int NULL
END
USE [TEAMS]
-- Config.
IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'LegionellaID' AND OBJECT_ID = OBJECT_ID('TestSignOff'))
BEGIN
    ALTER TABLE TestSignOff
    ADD [LegionellaID] int NULL
END



USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[EnterpriseSiteData]    Script Date: 27/06/2018 09:47:20 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[EnterpriseSiteData]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
	  @IncludePhotoNoColumn BIT = 0
)
AS
BEGIN
       SET NOCOUNT ON;

       DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
       -- crack @ClientIDs into a table
       DECLARE @Clients TABLE ( ClientID INT )

       INSERT
              @Clients (ClientID)
       SELECT
              ClientID
       FROM
              ClientSite
       WHERE
              SiteID = @SiteID

       DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT 
              CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
              r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
              fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
              rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
              s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
       FROM 
              (
                     SELECT 
                           j.JobID, j.SiteID
                     FROM
                           Job j WITH (NOLOCK)
                           INNER JOIN @Clients c ON j.ClientID=c.ClientID
                           INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
                           INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
                     WHERE
                           a.DateDeclined IS NULL
                                  AND
                           j.Approved IS NOT NULL
              ) j
              INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
              INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
              LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
              LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
              LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
       WHERE 
              j.SiteID=@SiteID

       SELECT
              main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, p.PhotoData, p.ContentType,
              r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode
       FROM
              (
                     Select
                           'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                  MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RegisterID,BuildingGUID,BuildingGUIDVersion
                     ) _r
                     WHERE
                           _r.Identifier = 1
              ) main
              INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
              LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
       
       SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
              main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
              fp.FloorNumber, 
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData],
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType]
       FROM
              (      
                     Select
                           'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
                                  FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
                     ) _f
                     WHERE
                           _f.Identifier = 1
              ) main
              INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
       
       SELECT
              main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
              rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode
       FROM
              (
                     Select
                           'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
                                  RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
                     ) _rm
                     WHERE
                           _rm.Identifier = 1
              ) main
              INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
       
       DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       
       INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
       FROM
              (      
                     Select
                           'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
                                  SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
                     ) _s
                     WHERE
                           _s.Identifier = 1
              ) main
              INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
              INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
              INNER JOIN @Clients c ON gs.ClientID=c.ClientID
       GROUP BY
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion

	   IF @IncludePhotoNoColumn = 1
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, p.PhotoNo, s.SampleRef, s.AsSample,  
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID

		ELSE
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, s.SampleRef, s.AsSample, 
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
       
       SELECT
              main.TableName,
              main.SampleID,
              main.RegisterID,
              main.ElementTypeID,
              main.ElementText
       FROM
       (
              SELECT
                     'Element' [TableName],
                     e.SampleID, 
                     NULL [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     @GuidSamples main
                     INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     e.ElementTypeID NOT IN (32)
              UNION
              SELECT
                     'Element' [TableName],
                     NULL [SampleID], 
                     e.RegisterID [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     (
                           Select
                                  _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                           FROM
                           (
                                  SELECT
                                         ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                         MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                                  FROM
                                         @IDList
                                  GROUP BY
                                         RegisterID,BuildingGUID,BuildingGUIDVersion
                           ) _r
                           WHERE
                                  _r.Identifier = 1
                     ) main
                     INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
                     INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
                           1 
                     ELSE
                           CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
                     END = 1
       ) main
       
       SET NOCOUNT OFF;
END

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
End

GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]    Script Date: 03/07/2018 10:38:54 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
End

GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
	
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - JSM: This needs to be after the client
	SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX),[RemovalContracterID|INTEGER|NULL|Client|] INT NULL)	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) ,(SELECT top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] FROM @JobQuoteAppointmentIDList jqal INNER JOIN @AppointmentAirMonitoringTable aam ON jqal.AppointmentID=aam.[AppointmentID|INTEGER|NOTNULL||] WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END



GO


If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
End

GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables]    Script Date: 03/07/2018 10:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
	  DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable WHERE @DisableFunctionality>0
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable WHERE @DisableFunctionality>0

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable WHERE @DisableFunctionality>0
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable WHERE @DisableFunctionality>0
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable WHERE @DisableFunctionality>0

      SET NOCOUNT OFF;
END


GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
                  UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

      SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='PhotoCollectionAutoInsert') AND name='LegionellaAssetOutletQuestionID') < 1
BEGIN
  ALTER TABLE PhotoCollectionAutoInsert
      ADD LegionellaAssetOutletQuestionID INT NULL
END
GO

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
End
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables]    Script Date: 19/12/2018 16:32:05 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;
      
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType1|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0
      
	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0


	-- ================================================================================================================
	-- PJL - I split this up so I can see the wood from the trees!
	DECLARE @PhotoCollectionAutoInsertTable TABLE (
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)) ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL
	)   
		
	INSERT INTO @PhotoCollectionAutoInsertTable (
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||]
	)   
	Select 
		[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[Caption],[Description],[SortOrder],[LegionellaAssetOutletQuestionID] 
	FROM PhotoCollectionAutoInsert      
			
	SELECT 
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],
		[AirTestDataCollectionQuestionID|INTEGER|NULL||],
		[AirTestResultID|INTEGER|NULL||],
		[Caption|VARCHAR|NULL||],
		[Description|VARCHAR|NULL||],
		[SortOrder|INTEGER|NOTNULL||],
		[LegionellaAssetOutletQuestionID|INTEGER|NULL||] 
	FROM 
		@PhotoCollectionAutoInsertTable 
	WHERE 
		@DisableFunctionality>0
	-- ================================================================================================================


	DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
	DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
	DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0

	DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
	DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
	DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable

	DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable

	DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
	DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
	DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted] FROM LegionellaOutletCategory	SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaOutletCategoryTable
	DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
	DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
	DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
	DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
	DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
	DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
	DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
	DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
	DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable


	SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='App') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD App VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_CreateIdentityInsertStub') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_CreateIdentityInsertStub] AS BEGIN SET NOCOUNT ON; END')
End
GO

ALTER PROC [dbo].[mobile_CreateIdentityInsertStub]
(
	@TableName VARCHAR(MAX),
	@TableID INT
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	SELECT
       'SET IDENTITY_INSERT ' + @TableName + ' ON; INSERT INTO [' + @TableName + '] (' + cF.Fields + ') SELECT ' + cV.[Values] + '; SET IDENTITY_INSERT ' + @TableName + ' OFF;'
	FROM
       sys.tables t
       CROSS APPLY
       (
              SELECT STUFF((
              SELECT
                     ',' + c.[name]
              FROM
                     sys.columns c
                     INNER JOIN sys.tables t ON c.object_id=t.object_id
              WHERE
                     t.name = @TableName
                           AND
                     c.is_nullable=0
              ORDER BY
                     column_id
              FOR XML PATH('')),1,1,''
              ) [Fields]
       ) cF
       CROSS APPLY
       (
              SELECT STUFF((
              SELECT
                     ',' +
                     CASE WHEN is_identity = 1 THEN
                           '' + CAST(@TableID as VARCHAR) + ''
                     ELSE
                           CASE system_type_id
                                  WHEN 48 THEN '0'
                                  WHEN 52 THEN '0'
                                  WHEN 56 THEN '0'
                                  WHEN 60 THEN '0'
                                  WHEN 62 THEN '0'
                                  WHEN 104 THEN '0'
                                  WHEN 106 THEN '0'
                                  WHEN 108 THEN '0'
                                  WHEN 122 THEN '0'
                                  WHEN 127 THEN '0'
                                  WHEN 165 THEN '0'
                                  WHEN 36 THEN '''00000000-0000-0000-0000-000000000000'''
                                  WHEN 40 THEN 'GETDATE()'
                                  WHEN 58 THEN 'GETDATE()'
                                  WHEN 61 THEN 'GETDATE()'
                                  WHEN 189 THEN 'GETDATE()'
                                  ELSE ''''''
                           END
                     END [FieldValue]
              FROM
                     sys.columns c
                     INNER JOIN sys.tables t ON c.object_id=t.object_id
              WHERE
                     t.name = @TableName
                           AND
                     c.is_nullable=0
              ORDER BY
                     column_id
              FOR XML PATH(''), TYPE).value('.', 'varchar(max)'),1,1,''
              ) [Values]
       ) cV
	WHERE
       t.name = @TableName
	
	SET NOCOUNT OFF;
	
END
GO

-- IMPORTANT - DO NOT REMOVE --
USE [TEAMS]
GO
-- IMPORTANT - DO NOT REMOVE - END --

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobileV2_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobileV2_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobileV2_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobileV2_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobileV2_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobileV2_DataTransfer_StaticTables]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;
	
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)	
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	
	--SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
	
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)	INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])	Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])	Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory	SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])	Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice	SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])	Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration	SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])	Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation	SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])	Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType	SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])	Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement	SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended	SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory	SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])	Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType	SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion	SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert	SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])	Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning	SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended	SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption	SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
	DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])	Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased	SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
	
	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned	SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))	INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])	Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory	SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType	SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])	Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck	SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])	Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem	SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])	Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink	SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])	Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL	SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL	SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))	INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])	Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig	SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType	SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])	Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType	SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])	Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification	SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )	INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])	Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended	SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])	Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult	SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])	Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL	SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])	Select [TableCodeID],[TableName],[TableCode] FROM TableCode	SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )	INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])	Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType	SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])	Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase	SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])	Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory	SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient	SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])	Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType	SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])	Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient	SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

	DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory	SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
	DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType	SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
	DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion	SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
	DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])	Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert	SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])	Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL	SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])	Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert	SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))	INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])	Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType	SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

	SET NOCOUNT OFF;
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[EnterpriseSiteData]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
	-- crack @ClientIDs into a table
	DECLARE @Clients TABLE ( ClientID INT )

	INSERT
		@Clients (ClientID)
	SELECT
		ClientID
	FROM
		ClientSite
	WHERE
		SiteID = @SiteID

	DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
	Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
	SELECT 
		CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
		r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
		fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
		rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
		s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
	FROM 
		(
			SELECT 
				j.JobID, j.SiteID
			FROM
				Job j WITH (NOLOCK)
				INNER JOIN @Clients c ON j.ClientID=c.ClientID
				INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
				INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
			WHERE
				a.DateDeclined IS NULL
					AND
				j.Approved IS NOT NULL
		) j
		INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
		INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
		LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
		LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
		LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
	WHERE 
		j.SiteID=@SiteID

	SELECT
		main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, p.PhotoData, p.ContentType,
		r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode
	FROM
		(
			Select
				'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
					MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
				FROM
					@IDList
				GROUP BY
					RegisterID,BuildingGUID,BuildingGUIDVersion
			) _r
			WHERE
				_r.Identifier = 1
		) main
		INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
		LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
	
	SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
		main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
		fp.FloorNumber, 
		CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData],
		CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType]
	FROM
		(	
			Select
				'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
					FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
				FROM
					@IDList
				GROUP BY
					FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
			) _f
			WHERE
				_f.Identifier = 1
		) main
		INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
	
	SELECT
		main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
		rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode
	FROM
		(
			Select
				'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
					RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
				FROM
					@IDList
				GROUP BY
					RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
			) _rm
			WHERE
				_rm.Identifier = 1
		) main
		INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
	
	DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
	
	INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion)
	SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
	FROM
		(	
			Select
				'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
					SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
				FROM
					@IDList
				GROUP BY
					SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
			) _s
			WHERE
				_s.Identifier = 1
		) main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
		INNER JOIN @Clients c ON gs.ClientID=c.ClientID
	GROUP BY
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
	
	SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
		s.RegisterItemNo,p.PhotoID,p.PhotoData, s.SampleRef, s.AsSample, 
		s.SampleResultID, s.SampleClassificationID, 
		sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
		s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
	FROM
		@GuidSamples main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
		LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
		LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
	
	SELECT
		main.TableName,
		main.SampleID,
		main.RegisterID,
		main.ElementTypeID,
		main.ElementText
	FROM
	(
		SELECT
			'Element' [TableName],
			e.SampleID, 
			NULL [RegisterID],
			e.ElementTypeID,
			CASE WHEN e.ElementText IS NOT NULL THEN
				e.ElementText
			ELSE
				CASE WHEN e.ElementTypeID = 20 THEN
					ISNULL(eime.Description,eim.Description)
				ELSE
					ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
				END
			END [ElementText]
		FROM
			@GuidSamples main
			INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
			LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
			LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
		UNION
		SELECT
			'Element' [TableName],
			NULL [SampleID], 
			e.RegisterID [RegisterID],
			e.ElementTypeID,
			CASE WHEN e.ElementText IS NOT NULL THEN
				e.ElementText
			ELSE
				CASE WHEN e.ElementTypeID = 20 THEN
					ISNULL(eime.Description,eim.Description)
				ELSE
					ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
				END
			END [ElementText]
		FROM
			(
				Select
					_r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
				FROM
				(
					SELECT
						ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
						MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
					FROM
						@IDList
					GROUP BY
						RegisterID,BuildingGUID,BuildingGUIDVersion
				) _r
				WHERE
					_r.Identifier = 1
			) main
			INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
			INNER JOIN Element e WITH (NOLOCK) ON r.RegisterID=r.RegisterID
			LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
			LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
		WHERE
			CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
				1 
			ELSE
				CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
			END = 1
	) main
	
	SET NOCOUNT OFF;
END
GO

BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcIdMap'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcIdMap](
			[MobileDtcIdMapId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[TableName] [varchar](50) NOT NULL,
			[MobileId] [int] NOT NULL,
			[ServerId] [int] NOT NULL,
			[SetDtc] [bit] NULL,
		 CONSTRAINT [PK_MobileDtcIdMap_MobileDtcIdMapId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcIdMapId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]
	END 
COMMIT TRANSACTION
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'SetDtc' AND OBJECT_ID = OBJECT_ID('MobileDtcIdMap'))
BEGIN
    ALTER TABLE MobileDtcIdMap
    ADD [SetDtc] bit NULL
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_AirTestPDF_ToFile]    Script Date: 03/07/2018 17:45:19 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER PROC [dbo].[mobile_AirTestPDF_ToFile]
(
	@AirTestID INT
)
AS
BEGIN
	
	Declare
		@Stage int = (Select COALESCE((Select 1 FROM AirTestPDF Where AirTestID=@AirTestID AND PDFSaved=1),(Select 0 FROM AirTestPDF Where AirTestID=@AirTestID AND PDFSaved=0),-1)),
		@JobId int = (Select j.JobID FROM Job j INNER JOIN JobEmployee je ON j.JobID=je.JobID INNER JOIN AirTest a ON a.JobEmployeeID=je.JobEmployeeID Where a.AirTestID=@AirTestID),
		@PDF varbinary(Max) = (Select PDF FROM AirTestPDF Where AirTestID=@AirTestID),
		@ObjectToken int,
		@Path varchar(250) = (Select [dbo].[NextAirTestReportPath](@AirTestID)),
		@FileName varchar(50)
				
		IF @Stage = 0 BEGIN
		-- Save the PDF to the pdf archive
			EXEC sp_OACreate 'ADODB.Stream', @ObjectToken Output
			EXEC sp_OASetProperty @ObjectToken, 'Type', 1
			EXEC sp_OAMethod @ObjectToken, 'Open'
			EXEC sp_OAMethod @ObjectToken, 'Write', NULL, @PDF
			EXEC sp_OAMethod @ObjectToken, 'SaveToFile', NULL, @Path, 2
			EXEC sp_OAMethod @ObjectToken, 'Close'
			EXEC sp_OADestroy @ObjectToken
			Set @FileName = Cast(Right(@Path, CharIndex('\', Reverse(@Path))-1) as varchar)
			--Check to see if the file has saved
			IF dbo.FileExists(@Path) > 0 BEGIN
				Insert Into PDF (JobId, FileName, Uploaded) Values(@JobId, @FileName, 1)
				Update AirTestPDF Set PDFsaved=1 Where AirTestID=@AirTestID
				Set @Stage = 1
			END
		END
		
		Select @Stage	
		
END






GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_ConfigurationData') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_ConfigurationData] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_ConfigurationData]    Script Date: 03/07/2018 17:45:31 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER PROC [dbo].[mobile_ConfigurationData]

AS
BEGIN
	
	SET NOCOUNT ON;
	
	
	
	
	SET NOCOUNT OFF;
	
END





GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_CreateSiteStructure]    Script Date: 03/07/2018 17:45:39 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_CreateSiteStructure') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_CreateSiteStructure] AS BEGIN SET NOCOUNT ON; END')
End
GO

ALTER PROC [dbo].[mobile_CreateSiteStructure]
(
	@SiteArray nvarchar(MAX)
)
AS
BEGIN
	
	DECLARE @Sites table
	(
		SiteID INT NOT NULL
	)
	
	Insert into @Sites (SiteID) Select Item FROM dbo.SplitStrings_Moden(@SiteArray,',')
	
	Declare @SiteStructureData table
	(
		-- Job / Site Data
		JobID INT NOT NULL,
		JobNo VARCHAR(50) NOT NULL,
		SiteID INT NOT NULL,
		-- Register Data
		RegisterID INT NOT NULL,
		rBuildingDesignation VARCHAR(1000) NULL,	--ExtendedData_01
		rPhotoID INT NULL,							--ExtendedData_02
		rGUID VARCHAR(50) NULL,
		rGUIDVersion INT NULL,
		rDateRemoved DATETIME NULL,
		-- Floorplan Data
		FloorplanID INT NOT NULL,
		fpFloorNumber INT NOT NULL,					--ExtendedData_01
		fpHasData BIT NOT NULL,						--ExtendedData_02
		fpGUID VARCHAR(50) NULL,
		fpGUIDVersion INT NULL,
		fpDateRemoved DATETIME NULL,
		-- Room Data
		RoomID INT NULL,
		rmNumber INT NULL,							--ExtendedData_01
		rmDescription VARCHAR(50) NULL,				--ExtendedData_02
		rmNotes VARCHAR(MAX) NULL,					--ExtendedData_03
		rmRandD BIT NULL,							--ExtendedData_04
		rmInaccessible BIT NULL,					--ExtendedData_05
		rmRoomCode VARCHAR(MAX) NULL,				--ExtendedData_06
		rmGUID VARCHAR(50) NULL,
		rmGUIDVersion INT NULL,
		rmDateRemoved DATETIME NULL
	)
	
	Insert into @SiteStructureData 
	(
			JobID,JobNo,SiteID,
			RegisterID,rBuildingDesignation,rPhotoID,rGUID,rGUIDVersion,rDateRemoved,
			FloorplanID,fpFloorNumber,fpHasData,fpGUID,fpGUIDVersion,fpDateRemoved,
			RoomID,rmNumber,rmDescription,rmNotes,rmRandD,rmInaccessible,rmRoomCode,rmGUID,rmGUIDVersion,rmDateRemoved)
	Select 
			j.JobID,j.JobNo,j.SiteID,
			r.RegisterID,r.BuildingDesignation,r.PhotoID,r.GUID 'rGUID',r.GUIDVersion 'rGUIDVersion',r.DateRemoved 'rDateRemoved',
			fp.FloorplanID,fp.FloorNumber, CASE WHEN fp.AutocadData IS NULL THEN CASE WHEN fp.FloorplanData IS NULL THEN 0 ELSE 1 END ELSE 1 END,fp.GUID 'fpGUID', fp.GUIDVersion 'fpGUIDVersion', fp.DateRemoved 'fpDateRemoved',
			rm.RoomID,rm.Number,rm.Description,rm.Notes,rm.RandD,rm.Inaccessible,rm.RoomCode,rm.GUID 'rmGUID', rm.GUIDVersion 'rmGUIDVersion', rm.DateRemoved 'rmDateRemoved'
	FROM Job j 
		INNER JOIN @Sites s ON s.SiteID = j.SiteID
		INNER JOIN JobEmployee je ON j.JobID=je.JobID
		INNER JOIN Register r ON r.JobEmployeeID=je.JobEmployeeID
		INNER JOIN Floorplan fp ON r.RegisterID=fp.RegisterID
		LEFT OUTER JOIN Room rm ON rm.FloorplanID=fp.FloorplanID
	Where r.DateApproved IS NOT NULL

	Select Main.* FROM
	(--Register TableCodeID=1
	Select DISTINCT
		ssd.SiteID,ssd.RegisterID 'ServerID',1 'TableCodeID', ssd.JobID,ssd.JobNo,ssd.rGUID 'GUID',ssd.rGUIDVersion 'GUIDVersion',ssd.rDateRemoved 'DateRemoved',
		CAST(ssd.rBuildingDesignation as varchar) 'ExtendedData_01',CAST(ssd.rPhotoID as varchar) 'ExtendedData_02',null 'ExtendedData_03',null 'ExtendedData_04',null 'ExtendedData_05',null 'ExtendedData_06'
	FROM @SiteStructureData ssd
	UNION
	--Floorplan TableCodeID=2
	Select DISTINCT
		ssd.SiteID,ssd.FloorplanID 'ServerID',2 'TableCodeID', ssd.JobID,ssd.JobNo,ssd.fpGUID 'GUID',ssd.fpGUIDVersion 'GUIDVersion',ssd.fpDateRemoved 'DateRemoved',
		CAST(ssd.fpFloorNumber as varchar) 'ExtendedData_01',CAST(ssd.fpHasData as varchar) 'ExtendedData_02',null 'ExtendedData_03',null 'ExtendedData_04',null 'ExtendedData_05',null 'ExtendedData_06'
	FROM @SiteStructureData ssd
	--Room TableCodeID=3
	UNION
	Select DISTINCT
		ssd.SiteID,ssd.RoomID 'ServerID',3 'TableCodeID', ssd.JobID,ssd.JobNo,ssd.rmGUID 'GUID',ssd.rmGUIDVersion 'GUIDVersion',ssd.rmDateRemoved 'DateRemoved',
		CAST(ssd.rmNumber as varchar) 'ExtendedData_01',CAST(ssd.rmDescription as varchar) 'ExtendedData_02',CAST(ssd.rmNotes as varchar) 'ExtendedData_03',CAST(ssd.rmRandD as varchar) 'ExtendedData_04',CAST(ssd.rmInaccessible as varchar) 'ExtendedData_05',CAST(ssd.rmRoomCode as varchar) 'ExtendedData_06'
	FROM @SiteStructureData ssd) Main order by Main.JobID,Main.TableCodeID
END




GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_DataTransfer_JobQuoteAppointment') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_DataTransfer_JobQuoteAppointment]    Script Date: 03/07/2018 17:45:44 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/

	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL )	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	SET NOCOUNT OFF;
END







GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_DataTransfer_StaticTables]    Script Date: 03/07/2018 17:45:50 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_DataTransfer_StaticTables]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;
	
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)	
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	
	--SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
	
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)	INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])	Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])	Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory	SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])	Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice	SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])	Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration	SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])	Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation	SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])	Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType	SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])	Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement	SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended	SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory	SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])	Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType	SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion	SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert	SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])	Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning	SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended	SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption	SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
	DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])	Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased	SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
	
	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned	SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))	INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])	Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory	SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType	SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])	Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck	SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])	Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem	SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])	Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink	SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])	Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL	SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL	SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))	INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])	Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig	SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType	SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])	Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType	SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])	Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification	SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )	INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])	Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended	SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])	Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult	SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])	Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL	SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])	Select [TableCodeID],[TableName],[TableCode] FROM TableCode	SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )	INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])	Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType	SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])	Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase	SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])	Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory	SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient	SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])	Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType	SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])	Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient	SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

	
	SET NOCOUNT OFF;
END








GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_DTSOverrideCode]    Script Date: 03/07/2018 17:45:56 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER PROC [dbo].[mobile_DTSOverrideCode]

AS
BEGIN
	
	DECLARE @RegisterOverrideCode VARCHAR(8)
	DECLARE @MobileConfigID INT = (Select ISNULL((Select MobileConfigID FROM MobileConfig Where MobileConfigTypeID=46),0))
	
	IF @MobileConfigID = 0 BEGIN
		Insert into MobileConfig (MobileConfigTypeID, MobileConfigText, MobileConfigDateTime)
		Select 46, (SELECT LEFT(CAST(NEWID() AS VARCHAR(36)),4)), GETDATE() Where (Select COUNT(*) FROM MobileConfig Where MobileConfigTypeID=46)=0
	END
	
	IF CAST(GETDATE() AS DATE) <> CAST((Select MobileConfigDateTime FROM MobileConfig Where MobileConfigTypeID=46) AS DATE) BEGIN
		Update MobileConfig Set MobileConfigText=(SELECT LEFT(CAST(NEWID() AS VARCHAR(36)),4)), MobileConfigDateTime=GETDATE() Where MobileConfigTypeID=46
	END
	
	Set @RegisterOverrideCode = (Select MobileConfigText FROM MobileConfig Where MobileConfigTypeID=46)
	
	Select 	@RegisterOverrideCode
END





GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_NextSampleRefBySystemName]    Script Date: 03/07/2018 17:46:01 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC
	
	SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
	
	SET NOCOUNT OFF;
	
END




GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_SecuritySystem]    Script Date: 03/07/2018 17:46:06 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER PROC [dbo].[mobile_SecuritySystem]
(
	@SystemName nvarchar(MAX)
)
AS
BEGIN
	
	Select mu.SystemName, muma.MacAddress, CASE WHEN mu.Disabled < GETDATE() THEN 'Disabled' ELSE NULL END [Disabled] FROM MobileUnit mu INNER JOIN MobileUnitMacAddress muma ON mu.MobileUnitID=muma.MobileUnitID
	Where mu.SystemName=@SystemName
	
END





GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[MobileDataCheck]    Script Date: 03/07/2018 17:46:11 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[MobileDataCheck]
	@AppointmentID INT = NULL

AS
BEGIN

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SET NOCOUNT ON;

-- Start the main select
SELECT
	[MobileDataReturned] =		CASE
									WHEN a.ManuallyMarkWorkDone = 1 THEN 1
									WHEN ISNULL(qe.EmployeeID, 0) > 0 AND a.AppointmentTypeID = 8 THEN 1
									WHEN jea.JobEmployeeAppointmentID IS NOT NULL THEN 1
								ELSE
									0
								END,								
	[MobileData] =				CASE
									WHEN a.ManuallyMarkWorkDone = 1 THEN 1
								ELSE
									CASE
										WHEN a.AppointmentTypeID = 1 THEN regCount.regCount
										WHEN a.AppointmentTypeID = 3 THEN airCount.airCount
									END
								END
FROM
	Appointment a 
	LEFT JOIN Quote q ON a.QuoteID = q.QuoteID
	LEFT JOIN Job j ON q.JobID = j.JobID	
	LEFT JOIN QuoteEmployee qe ON q.QuoteID = qe.QuoteID
	LEFT JOIN JobEmployeeAppointment jea ON a.AppointmentID = jea.AppointmentID
	LEFT JOIN NoAccess na ON j.JobID = na.JobID	
	OUTER APPLY
	(
    SELECT
        COUNT(at.AirTestID) [airCount]
    FROM
        Job _j
        INNER JOIN JobEmployee je ON _j.JobID = je.JobID
        INNER JOIN Airtest at ON je.JobEmployeeID = at.JobEmployeeID
    WHERE
        _j.JobId = j.JobID
    )  airCount	
	OUTER APPLY
	(
	SELECT
		COUNT(r.RegisterID) [regCount]
	FROM
		Job _j
		INNER JOIN JobEmployee je ON _j.JobID = je.JobID
		INNER JOIN Register r ON je.JobEmployeeID = r.JobEmployeeID
	WHERE
		_j.JobId = j.JobID
	)  regCount
WHERE
	a.AppointmentID = @AppointmentID
END


GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2.2.5_DataTransfer_StaticTables]    Script Date: 03/07/2018 17:46:16 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO








ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

      SET NOCOUNT OFF;
END




GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2_DataTransfer_JobQuoteAppointment]    Script Date: 03/07/2018 17:46:20 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobileV2_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END



GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2_DataTransfer_StaticTables]    Script Date: 03/07/2018 17:46:25 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobileV2_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
	
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)	
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	
	--SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
	
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)	INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])	Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config	SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])	Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory	SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])	Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice	SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])	Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration	SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])	Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation	SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])	Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType	SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])	Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement	SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended	SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory	SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])	Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType	SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion	SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )	INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])	Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert	SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])	Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning	SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended	SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption	SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
	DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])	Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased	SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
	
	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned	SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))	INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])	Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory	SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType	SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])	Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck	SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])	Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem	SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])	Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink	SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])	Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL	SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL	SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))	INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])	Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig	SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType	SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])	Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType	SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])	Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification	SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )	INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])	Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended	SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])	Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult	SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])	Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL	SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])	Select [TableCodeID],[TableName],[TableCode] FROM TableCode	SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )	INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])	Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType	SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])	Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase	SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])	Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory	SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )	INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])	Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient	SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])	Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType	SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])	Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient	SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

	DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory	SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
	DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])	Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType	SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
	DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion	SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
	DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])	Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert	SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])	Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL	SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])	Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert	SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))	INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])	Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType	SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

	--DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer	SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable
	--DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))	INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])	Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter	SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
	--DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )	INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])	Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate	SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
	--DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure	SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
	--DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType	SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
	--DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))	INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||])	Select [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template	SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
	--DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL )	INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])	Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout	SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

	SET NOCOUNT OFF;
END

GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='AirtestdataCollectionQuestion') AND name='DescriptionSuffix') < 1
BEGIN
    ALTER TABLE AirtestdataCollectionQuestion
      ADD [DescriptionSuffix] VARCHAR(MAX) NULL
END

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='AirtestdataCollectionQuestion') AND name='DescriptionPrefix') < 1
BEGIN
    ALTER TABLE AirtestdataCollectionQuestion
      ADD [DescriptionPrefix] VARCHAR(MAX) NULL
END

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.0_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment]    Script Date: 12/03/2018 13:40:19 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable


	SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_StaticTables]    Script Date: 15/03/2018 13:24:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

      SET NOCOUNT OFF;
END



GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[EnterpriseSiteData]    Script Date: 12/03/2018 13:43:35 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[EnterpriseSiteData]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
	-- crack @ClientIDs into a table
	DECLARE @Clients TABLE ( ClientID INT )

	INSERT
		@Clients (ClientID)
	SELECT
		ClientID
	FROM
		ClientSite
	WHERE
		SiteID = @SiteID

	DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
	Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
	SELECT 
		CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
		r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
		fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
		rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
		s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
	FROM 
		(
			SELECT 
				j.JobID, j.SiteID
			FROM
				Job j WITH (NOLOCK)
				INNER JOIN @Clients c ON j.ClientID=c.ClientID
				INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
				INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
			WHERE
				a.DateDeclined IS NULL
					AND
				j.Approved IS NOT NULL
		) j
		INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
		INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
		LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
		LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
		LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
	WHERE 
		j.SiteID=@SiteID

	SELECT
		main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, p.PhotoData, p.ContentType,
		r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode
	FROM
		(
			Select
				'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
					MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
				FROM
					@IDList
				GROUP BY
					RegisterID,BuildingGUID,BuildingGUIDVersion
			) _r
			WHERE
				_r.Identifier = 1
		) main
		INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
		LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
	
	SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
		main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
		fp.FloorNumber, 
		CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData],
		CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType]
	FROM
		(	
			Select
				'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
					FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
				FROM
					@IDList
				GROUP BY
					FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
			) _f
			WHERE
				_f.Identifier = 1
		) main
		INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
	
	SELECT
		main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
		rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode
	FROM
		(
			Select
				'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
					RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
				FROM
					@IDList
				GROUP BY
					RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
			) _rm
			WHERE
				_rm.Identifier = 1
		) main
		INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
	
	DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
	
	INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion)
	SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
	FROM
		(	
			Select
				'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion
			FROM
			(
				SELECT
					ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
					SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
				FROM
					@IDList
				GROUP BY
					SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
			) _s
			WHERE
				_s.Identifier = 1
		) main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
		INNER JOIN @Clients c ON gs.ClientID=c.ClientID
	GROUP BY
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
	
	SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
		s.RegisterItemNo,p.PhotoID,p.PhotoData, s.SampleRef, s.AsSample, 
		s.SampleResultID, s.SampleClassificationID, 
		sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
		s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
	FROM
		@GuidSamples main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
		LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
		LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
	
	SELECT
		main.TableName,
		main.SampleID,
		main.RegisterID,
		main.ElementTypeID,
		main.ElementText
	FROM
	(
		SELECT
			'Element' [TableName],
			e.SampleID, 
			NULL [RegisterID],
			e.ElementTypeID,
			CASE WHEN e.ElementText IS NOT NULL THEN
				e.ElementText
			ELSE
				CASE WHEN e.ElementTypeID = 20 THEN
					ISNULL(eime.Description,eim.Description)
				ELSE
					ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
				END
			END [ElementText]
		FROM
			@GuidSamples main
			INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
			LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
			LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
		UNION
		SELECT
			'Element' [TableName],
			NULL [SampleID], 
			e.RegisterID [RegisterID],
			e.ElementTypeID,
			CASE WHEN e.ElementText IS NOT NULL THEN
				e.ElementText
			ELSE
				CASE WHEN e.ElementTypeID = 20 THEN
					ISNULL(eime.Description,eim.Description)
				ELSE
					ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
				END
			END [ElementText]
		FROM
			(
				Select
					_r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
				FROM
				(
					SELECT
						ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
						MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
					FROM
						@IDList
					GROUP BY
						RegisterID,BuildingGUID,BuildingGUIDVersion
				) _r
				WHERE
					_r.Identifier = 1
			) main
			INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
			INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
			LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
			LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
		WHERE
			CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
				1 
			ELSE
				CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
			END = 1
	) main
	
	SET NOCOUNT OFF;
END
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 's__ArthurVersion' AND OBJECT_ID = OBJECT_ID('Config'))
BEGIN
    ALTER TABLE Config
    ADD [s__ArthurVersion] [varchar](50) NULL
END
GO

INSERT INTO MobileConfig (MobileConfigTypeID,MobileConfigInt,MobileConfigText) SELECT 114,1,'ALL' WHERE (SELECT COUNT(*) FROM MobileConfig WHERE MobileConfigTypeID=114 AND MobileConfigInt=1 AND MobileConfigText='ALL')=0
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='PDF') AND name='mobileTEAMSv2') < 1
BEGIN
  ALTER TABLE PDF
      ADD mobileTEAMSv2 BIT NOT NULL DEFAULT(0)
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2.2.5_DataTransfer_StaticTables]    Script Date: 04/17/2018 10:12:03 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO








ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
      DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable WHERE @DisableFunctionality>0
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable WHERE @DisableFunctionality>0

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable WHERE @DisableFunctionality>0
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable WHERE @DisableFunctionality>0
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL, [BinaryPDF|IMAGE|NULL||] IMAGE NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||], [BinaryPDF|IMAGE|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted],[BinaryPDF] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||], [BinaryPDF|IMAGE|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable WHERE @DisableFunctionality>0
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable WHERE @DisableFunctionality>0

      SET NOCOUNT OFF;
END




GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2.2.5_DataTransfer_StaticTables]    Script Date: 04/17/2018 10:28:51 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO








ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
      DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable WHERE @DisableFunctionality>0
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable WHERE @DisableFunctionality>0

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable WHERE @DisableFunctionality>0
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable WHERE @DisableFunctionality>0
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable WHERE @DisableFunctionality>0
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable WHERE @DisableFunctionality>0

      SET NOCOUNT OFF;
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_NextSampleRefBySystemName')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_NextSampleRefBySystemName] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX)
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC

	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated)
			SELECT 1, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE()

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
	
END

GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment]    Script Date: 05/04/2018 15:02:17 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END



GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[AutomaticEmail_PortalUserForSite]    Script Date: 05/14/2018 16:08:05 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROCEDURE [dbo].[AutomaticEmail_PortalUserForSite]
    @PortalUserAutoEmailTypeID INT = NULL
/*
    For the Portal Automatic Email functionality, get the data that the Client can access. However, we only get the SiteID if we are want emails for this Site.
*/
AS
BEGIN
    SET NOCOUNT ON;


    -- Start the main SELECT.
    SELECT
        pu.PortalUserId [PortalUserID],
        pu.Email + ';' + pu.FullName [EMAILRECIPIENT],
        dbo.FormatTeamsDate(GETDATE(), 1) [EmailDate],
        si.Address + ISNULL(', ' + NULLIF(si.Postcode, ''), '') [SiteAddressWithPostcode],
        c.ClientIDs,
        ISNULL(pu.ProjectGroupID, 0) [ProjectGroupID],
        ISNULL(pu.ProjectID, 0) [ProjectID],
        si.SiteID [SiteID]
    FROM
        PortalUserAutoEmail puae WITH (NOLOCK)
        INNER JOIN PortalUserAutoEmailType puaet WITH (NOLOCK) ON puae.PortalUserAutoEmailTypeID = puaet.PortalUserAutoEmailTypeID
        INNER JOIN PortalUser pu WITH (NOLOCK) ON puae.PortalUserID = pu.PortalUserId AND pu.Deleted IS NULL
        INNER JOIN Site si WITH (NOLOCK) ON puae.SiteID = si.SiteID
        OUTER APPLY
        (
            SELECT STUFF((
                SELECT ',' + CAST(c.ClientID AS VARCHAR(50))
                FROM
                    ClientPortalUser cpu WITH (NOLOCK)
                    INNER JOIN Client c WITH (NOLOCK) ON cpu.ClientId = c.ClientID
                WHERE cpu.PortalUserId = pu.PortalUserId AND c.Deleted IS NULL
                GROUP BY c.ClientID
            FOR XML PATH(''), TYPE).value('.', 'VARCHAR(MAX)'), 1, 1, '') [ClientIDs]
        ) c
    WHERE
        puae.PortalUserAutoEmailTypeID = @PortalUserAutoEmailTypeID
            AND
        puaet.Deleted IS NULL
            AND
        pu.Email LIKE '%@%' -- Add basic validation to make sure it's an email.


    SET NOCOUNT OFF;
END

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.0_DataTransfer_JobQuoteAppointment]    Script Date: 21/05/2018 13:01:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
	
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - JSM: This needs to be after the client
	SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX),[RemovalContracterID|INTEGER|NULL|Client|] INT NULL)	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) ,(SELECT top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] FROM @JobQuoteAppointmentIDList jqal INNER JOIN @AppointmentAirMonitoringTable aam ON jqal.AppointmentID=aam.[AppointmentID|INTEGER|NOTNULL||] WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END


GO

ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
                  UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

      SET NOCOUNT OFF;
END

GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_NextSampleRefBySystemName]    Script Date: 19/06/2018 09:47:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC
	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated, EmployeeID)
			SELECT 2, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE(), @EmployeeID

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
END
GO

ALTER PROC [dbo].[EnterpriseSiteData]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
	  @IncludePhotoNoColumn BIT = 0
)
AS
BEGIN
       SET NOCOUNT ON;

       DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
       -- crack @ClientIDs into a table
       DECLARE @Clients TABLE ( ClientID INT )

       INSERT
              @Clients (ClientID)
       SELECT
              ClientID
       FROM
              ClientSite
       WHERE
              SiteID = @SiteID

       DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT 
              CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
              r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
              fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
              rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
              s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
       FROM 
              (
                     SELECT 
                           j.JobID, j.SiteID
                     FROM
                           Job j WITH (NOLOCK)
                           INNER JOIN @Clients c ON j.ClientID=c.ClientID
                           INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
                           INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
                     WHERE
                           a.DateDeclined IS NULL
                                  AND
                           j.Approved IS NOT NULL
              ) j
              INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
              INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
              LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
              LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
              LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
       WHERE 
              j.SiteID=@SiteID

       SELECT
              main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, p.PhotoData, p.ContentType,
              r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode
       FROM
              (
                     Select
                           'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                  MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RegisterID,BuildingGUID,BuildingGUIDVersion
                     ) _r
                     WHERE
                           _r.Identifier = 1
              ) main
              INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
              LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
       
       SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
              main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
              fp.FloorNumber, 
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData],
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType]
       FROM
              (      
                     Select
                           'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
                                  FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
                     ) _f
                     WHERE
                           _f.Identifier = 1
              ) main
              INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
       
       SELECT
              main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
              rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode
       FROM
              (
                     Select
                           'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
                                  RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
                     ) _rm
                     WHERE
                           _rm.Identifier = 1
              ) main
              INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
       
       DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       
       INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
       FROM
              (      
                     Select
                           'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
                                  SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
                     ) _s
                     WHERE
                           _s.Identifier = 1
              ) main
              INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
              INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
              INNER JOIN @Clients c ON gs.ClientID=c.ClientID
       GROUP BY
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion

	   IF @IncludePhotoNoColumn = 1
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, p.PhotoNo, s.SampleRef, s.AsSample,  
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID

		ELSE
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, s.SampleRef, s.AsSample, 
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
       
       SELECT
              main.TableName,
              main.SampleID,
              main.RegisterID,
              main.ElementTypeID,
              main.ElementText
       FROM
       (
              SELECT
                     'Element' [TableName],
                     e.SampleID, 
                     NULL [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     @GuidSamples main
                     INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     e.ElementTypeID NOT IN (32)
              UNION
              SELECT
                     'Element' [TableName],
                     NULL [SampleID], 
                     e.RegisterID [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     (
                           Select
                                  _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                           FROM
                           (
                                  SELECT
                                         ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                         MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                                  FROM
                                         @IDList
                                  GROUP BY
                                         RegisterID,BuildingGUID,BuildingGUIDVersion
                           ) _r
                           WHERE
                                  _r.Identifier = 1
                     ) main
                     INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
                     INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
                           1 
                     ELSE
                           CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
                     END = 1
       ) main
       
       SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.3.4.0_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentLegionellaTable TABLE ([AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentLegionellaTable ([AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select al.[AppointmentLegionellaID],al.[AppointmentID],al.LegionellaTypeID,al.DueDate FROM AppointmentLegionella al WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentLegionellaTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	
	
	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||]) 
		Select 
			qv.[QuoteVisitID],
			qv.[QuoteVisitTypeID],
			qv.[QuoteEmployeeID],
			qv.[QuoteVisitStart],
			qv.[QuoteVisitFinish],
			qv.[Notes],
			qv.[PhotoID],
			qv.[SystemName],
			qv.[Closed],
			qv.[Finished],
			qv.[SignatureID],
			qv.[_QuoteVisitConsumableMarkup],
			qv.[_QuoteVisitEquipmentMarkup],
			qv.[_QuoteVisitLabourMarkup] 
		FROM 
			QuoteVisit qv 
			INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	
			
	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
		DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

		SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
		DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
		DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType1|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
		DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
		DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
		DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
		DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0
      
		DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
		DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
		DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
		DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
		DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
		DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
		DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
		DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
		DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
		DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

		DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
		DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0

		DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
		DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
		DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0

		DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
		DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
		DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
		DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
		DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
		DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
		DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted] FROM LegionellaOutletCategory	SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaOutletCategoryTable
		DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
		DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
		DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
		DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
		DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
		DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
		DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
		DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
		DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable


      SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.3.4.0_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO


ALTER PROC [dbo].[mobile_Legionella_v1.3.4.0_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;
  
    DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
	DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
	--Get @LegionellaTypeID
	--Select * FROM LegionellaType
	DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

	--SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

	DECLARE @LegionellaGUIDED TABLE
		(
			LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
			LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
			LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
			LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT
		)

	--SELECT @RestrictedLegionellaAssetCategoryID
		
	INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
	Select 
		l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
		la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
		ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
		lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
	FROM
		Job j WITH (NOLOCK)
	    
		INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
		INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
		INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
	    
		INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
		INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
	    
		LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID
		LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID
		LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID
	    
	Where
		j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

	DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
	Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1
	DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
	Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)
	DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
	Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0
	DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
	Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

      DECLARE @ReinspectData TABLE  
      (
            TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
            GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
            SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
            SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
            SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
            EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
            [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
            LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
            LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
            SortOrder INT, TaskDueDate DATETIME
      )
      Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
      Select
            main.TableName,
            main.TableCategoryID,
            main.TableID,
            main.ParentID,
            main.GUID,
            main.GuidVersion,
            main.BuildingDesignation,
            main.GeneralDescriptionOfSite,
            main.AreasNotAccessed,
            main.Notes,
            main.SystemRef,
            main.Location,
            main.SourceCold,
            main.SourceHot,
            main.SourceMains,
            main.SourceMixed,
            main.SentinelCold,
            main.SentinelHot,
            main.SentinelMains,
            main.SentinelMixed,
            main.EnabledCold,
            main.EnabledHot,
            main.EnabledMains,
            main.EnabledMixed,
            main.LowUseCold,
            main.LowUseHot,
            main.LowUseMains,
            main.LowUseMixed,
            main.[LegionellaTaskAutoInsertID],
            main.[LegionellaTaskAutoInsertTypeID],
            main.[LegionellaTaskNo],
            main.[LegionellaSectionID], 
            main.[LegionellaRiskCategoryID],
            main.[RiskDescription],
            main.[Action], 
            main.[LegionellaFrequencyCategoryID],
            main.[LegionellaRiskRatingID],
            main.[LegionellaPriorityRatingID],
            main.[SortOrder],
			main.TaskDueDate [TaskDueDate]
      FROM
            (
                  Select 
                        'Legionella' [TableName],
                        NULL [TableCategoryID],
                        l.LegionellaID [TableID],
                        NULL [ParentID],
                        l.GUID [GUID],
                        l.GUIDVersion [GUIDVersion],
                        l.BuildingDesignation [BuildingDesignation],
                        l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
						l.AreasNotAccessed [AreasNotAccessed],
						l.Notes [Notes],
                        NULL [SystemRef],
                        NULL [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate]
                  FROM 
                        Legionella l WITH (NOLOCK)
                        INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
						INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
				  WHERE
					    lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
                  UNION
                  Select 
                        'LegionellaAsset' [TableName],
                        la.LegionellaAssetCategoryID [TableCategoryID],
                        la.LegionellaAssetID [TableID],
                        ld.LegionellaID [ParentID],
                        la.GUID [GUID],
                        la.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        la.SystemRef [SystemRef],
                        la.Location [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate]
                  FROM 
                        LegionellaAsset la WITH (NOLOCK)
                        INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
                        INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID
                  UNION
                  Select 
                        'LegionellaLocation' [TableName],
                        NULL [TableCategoryID],
                        ll.LegionellaLocationID [TableID],
                        ld.LegionellaID [ParentID],
                        ll.GUID [GUID],
                        ll.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        NULL [SystemRef],
                        ll.Location [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
						NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate]
                  FROM 
                        LegionellaLocation ll WITH (NOLOCK)
                        INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
                        INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
                  UNION
                  Select 
                        'LegionellaOutlet' [TableName],
                        lo.LegionellaOutletCategoryID [TableCategoryID],
                        lo.LegionellaOutletID [TableID],
                        lld.LegionellaLocationID [ParentID],
                        lo.GUID [GUID],
                        lo.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        lo.SystemRef [SystemRef],
                        NULL [Location],
                        lo.SourceCold [SourceCold],
                        lo.SourceHot [SourceHot],
                        lo.SourceMains [SourceMains],
                        lo.SourceMixed [SourceMixed],
                        lo.SentinelCold [SentinelCold],
                        lo.SentinelHot [SentinelHot],
                        lo.SentinelMains [SentinelMains],
                        lo.SentinelMixed [SentinelMixed],
                        lo.EnabledCold [EnabledCold],
                        lo.EnabledHot [EnabledHot],
                        lo.EnabledMains [EnabledMains],
                        lo.EnabledMixed [EnabledMixed],
                        lo.LowUseCold [LowUseCold],
						lo.LowUseHot [LowUseHot],
						lo.LowUseMains [LowUseMains],
						lo.LowUseMixed [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate]
                  FROM 
                        LegionellaOutlet lo WITH (NOLOCK)
						INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
						INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
            ) main

		Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
		Select
			main.TableName,
			main.TableCategoryID,
			main.TableID,
			main.ParentID,
			main.GUID,
			main.GuidVersion,
			main.BuildingDesignation,
			main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
			main.AreasNotAccessed [AreasNotAccessed],
			main.Notes [Notes],
			main.SystemRef,
			main.Location,
			main.SourceCold,
			main.SourceHot,
			main.SourceMains,
			main.SourceMixed,
			main.SentinelCold,
			main.SentinelHot,
			main.SentinelMains,
			main.SentinelMixed,
			main.EnabledCold,
			main.EnabledHot,
			main.EnabledMains,
			main.EnabledMixed,
			main.LowUseCold,
			main.LowUseHot,
			main.LowUseMains,
			main.LowUseMixed,
			main.[LegionellaTaskAutoInsertID],
			main.[LegionellaTaskAutoInsertTypeID],
			main.[LegionellaTaskNo],
			main.[LegionellaSectionID], 
			main.[LegionellaRiskCategoryID],
			main.[RiskDescription],
			main.[Action], 
			main.[LegionellaFrequencyCategoryID],
			main.[LegionellaRiskRatingID],
			main.[LegionellaPriorityRatingID],
			main.[SortOrder],
			main.TaskDueDate [TaskDueDate]
		FROM
		(
			--now for the tasks!
			Select 
				'LegionellaTask_Outlet' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				lto.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Asset' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				lta.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Location' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				ltll.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Legionella' [TableName],
				lt.LegionellaSectionID [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				ltl.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
			WHERE
				lt.Deleted IS NULL
		) main

      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
            UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
            DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
            Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
            UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
            DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
            Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
            UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
            DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
            Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
            UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
            DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
            Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
      END

      Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL
  
  SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='LegionellaOutletCategory') AND name='DefaultOutletCode') < 1
BEGIN
  ALTER TABLE [dbo].[LegionellaOutletCategory]
	ADD [DefaultOutletCode] [varchar] (MAX) NULL
END
GO

update LegionellaOutletCategory set DefaultOutletCode = 'TAP' where LegionellaOutletCategoryID = 1
update LegionellaOutletCategory set DefaultOutletCode = 'SHW' where LegionellaOutletCategoryID = 2
update LegionellaOutletCategory set DefaultOutletCode = 'TLT' where LegionellaOutletCategoryID = 3
update LegionellaOutletCategory set DefaultOutletCode = 'URI' where LegionellaOutletCategoryID = 4


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.9_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.9_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.9_DataTransfer_StaticTables]    Script Date: 08/10/2018 10:41:04 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.9_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
		DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

		SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
		DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
		DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType1|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
		DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
		DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
		DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
		DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
		DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
		DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
		DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0
      
		DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
		DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
		DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
		DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
		DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
		DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
		DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
		DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
		DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
		DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
		DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
		DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

		DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
		DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0

		DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
		DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
		DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0

		DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
		DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
		DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
		DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
		DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
		DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
		DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted] FROM LegionellaOutletCategory	SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaOutletCategoryTable
		DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
		DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
		DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
		DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
		DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
		DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
		DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
		DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
		DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable


      SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='LegionellaOutlet') AND name='LegionellaAssetID') < 1
BEGIN
  ALTER TABLE [dbo].[LegionellaOutlet]
	ADD [LegionellaAssetID] [int] NULL
END
GO


ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
	
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - JSM: This needs to be after the client
	SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX),[RemovalContracterID|INTEGER|NULL|Client|] INT NULL)	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) ,(SELECT top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] FROM @JobQuoteAppointmentIDList jqal INNER JOIN @AppointmentAirMonitoringTable aam ON jqal.AppointmentID=aam.[AppointmentID|INTEGER|NOTNULL||] WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobileV2.4.1_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobileV2.4.1_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

/****** Object:  StoredProcedure [dbo].[mobileV2.4.1_DataTransfer_StaticTables]    Script Date: 20/09/2018 14:33:32 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobileV2.4.1_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;
      
	UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

	SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
	--SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable

	-- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
	DECLARE @EquipmentTable TABLE (
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
		[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
		[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
		[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
		[BranchOfficeID|INTEGER|NULL||] INTEGER NULL
	)

	INSERT INTO @EquipmentTable (
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
		[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
		[BranchOfficeID|INTEGER|NULL||]
	)      
	SELECT 
		e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
		e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
	FROM 
		Equipment e 
		LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
		LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
	WHERE 
		e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
	GROUP BY 
		e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

	SELECT 
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
		[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
		[BranchOfficeID|INTEGER|NULL||] 
	FROM 
		@EquipmentTable
	-------------------------------------------------------------------------------------------------------------

	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

	DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
	DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
	DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
	DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

	DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
	DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
	DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
	DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
	DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
	DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
	DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

	SET NOCOUNT OFF;
END



GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData_Surveying_v2.4.1.8')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData_Surveying_v2.4.1.8] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[EnterpriseSiteData_Surveying_v2.4.1.5]    Script Date: 08/11/2018 09:28:58 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[EnterpriseSiteData_Surveying_v2.4.1.8]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
	  @IncludePhotoNoColumn BIT = 0,
	  @ExcludeBinaryData BIT = 0,
	  @JobReinspectionStructureID INT = 0,
	  @FilterToJobID INT = 0
)
AS
BEGIN
       SET NOCOUNT ON;
	   
	   If @RequestingServerCode != (SELECT s__ServerCode FROM Config) BEGIN
			SET @FilterToJobID = 0
	   END

	   IF @FilterToJobID > 0 BEGIN
			SET @JobReinspectionStructureID = (SELECT ISNULL((SELECT TOP 1 JobReinspectionStructureID FROM JobReinspectionStructure WHERE JobID=@FilterToJobID AND NoDataRequired=0),0))
			IF @JobReinspectionStructureID = 0 BEGIN
				SET @FilterToJobID = 0
			END
	   END

       DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
       -- crack @ClientIDs into a table
       DECLARE @Clients TABLE ( ClientID INT )

       INSERT
              @Clients (ClientID)
       SELECT
              ClientID
       FROM
              ClientSite
       WHERE
              SiteID = @SiteID

       DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT 
              CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
              r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
              fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
              rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
              s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
       FROM 
              (
                     SELECT 
                           j.JobID, j.SiteID
                     FROM
                           Job j WITH (NOLOCK)
                           INNER JOIN @Clients c ON j.ClientID=c.ClientID
                           INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
                           INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
                     WHERE
                           a.DateDeclined IS NULL
                                  AND
                           j.Approved IS NOT NULL
              ) j
              INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
              INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
			  LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RegisterID=r.RegisterID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
              LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
              LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
              LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
       WHERE 
              j.SiteID=@SiteID
				AND
			  CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1

       SELECT
              main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, CASE WHEN @ExcludeBinaryData=0 THEN p.PhotoData END [PhotoData], p.ContentType,
              r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode,
			  main.Included
       FROM
              (
                     Select
                           'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode,
						   CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                  MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RegisterID,BuildingGUID,BuildingGUIDVersion
                     ) _r
					 LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RegisterID=_r.RegisterID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
                     WHERE
                           _r.Identifier = 1
					GROUP BY
						_r.RegisterID, BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode, CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
              ) main
              INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
              LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
	   WHERE
			r.[GUID] IS NOT NULL AND r.[GUIDVersion] IS NOT NULL
       
       SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
              main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
              fp.FloorNumber, 
              CASE WHEN @ExcludeBinaryData=0 THEN CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END END [FloorplanData],
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType],
			  main.Included
       FROM
              (      
                     Select
                           'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,
							CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
                                  id.FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
                           FROM
                                  @IDList id
                           GROUP BY
                                  id.FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
                     ) _f
					 LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.FloorplanID=_f.FloorplanID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
                     WHERE
                        _f.Identifier = 1
							AND
						CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
					 GROUP BY
						 _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
              ) main
              INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
	   WHERE
			fp.[GUID] IS NOT NULL AND fp.[GUIDVersion] IS NOT NULL
	   
       SELECT
              main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
              rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode,
			  CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included],
			  rm.RoomGroupID [ServerRoomGroupID], rm.ParentGroupID [ServerParentGroupID]
       FROM
              (
                     Select
                           'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
                                  RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
                     ) _rm
                     WHERE
                           _rm.Identifier = 1
              ) main
              INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
			  LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RoomID=rm.RoomID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
	   WHERE
			CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
				AND
			rm.[GUID] IS NOT NULL AND rm.[GUIDVersion] IS NOT NULL
	   GROUP BY
			main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode, rm.RoomGroupID, rm.ParentGroupID,
			CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
       
       DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT, Included INT)
       
       INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion,Included)
       SELECT
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion, main.Included
       FROM
              (      
                     Select
                           'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion,
							CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
                                  SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
                     ) _s
					 LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.SampleID=_s.SampleID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
                     WHERE
                        _s.Identifier = 1
							AND
						CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
              ) main
              INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
              INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
              INNER JOIN @Clients c ON gs.ClientID=c.ClientID
	   WHERE
			  s.[GUID] IS NOT NULL AND s.[GUIDVersion] IS NOT NULL
       GROUP BY
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
			  main.Included

	   IF @IncludePhotoNoColumn = 1
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,CASE WHEN @ExcludeBinaryData=0 THEN p.PhotoData END [PhotoData], p.PhotoNo, REPLACE(REPLACE(REPLACE(s.SampleRef,'****','*'),'***','*'),'**','*') [SampleRef], s.AsSample,  
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee], main.Included
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
		ELSE
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,CASE WHEN @ExcludeBinaryData=0 THEN p.PhotoData END [PhotoData], REPLACE(REPLACE(REPLACE(s.SampleRef,'****','*'),'***','*'),'**','*') [SampleRef], s.AsSample, 
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee], main.Included
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
       SELECT
              main.TableName,
              main.SampleID,
              main.RegisterID,
              main.ElementTypeID,
              main.ElementText
       FROM
       (
              SELECT
                     'Element' [TableName],
                     e.SampleID, 
                     NULL [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     @GuidSamples main
                     INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     e.ElementTypeID NOT IN (32)
              UNION
              SELECT
                     'Element' [TableName],
                     NULL [SampleID], 
                     e.RegisterID [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,ISNULL(eim.ShortDescription,eim.Description))
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     (
                           Select
                                  _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                           FROM
                           (
                                  SELECT
                                         ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                         MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                                  FROM
                                         @IDList
                                  GROUP BY
                                         RegisterID,BuildingGUID,BuildingGUIDVersion
                           ) _r
                           WHERE
                                  _r.Identifier = 1
                     ) main
                     INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
                     INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
                           1 
                     ELSE
                           CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
                     END = 1
       ) main
   
	  SELECT
            main.TableName,
            main.RoomID,
            main.ItemNo,
            main.[Description],
            main.[Position],
			main.[Comments]
       FROM
       (
              SELECT
                     'BuildingComponent' [TableName],
                     main.RoomID,
					 bc.ItemNo,
					 bc.[Description],
					 bc.[Position],
					 bc.[Comments]
              FROM
	                (
						Select
							'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
						FROM
						(
							SELECT
									ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
									RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
							FROM
									@IDList
							GROUP BY
									RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
						) _rm
						WHERE
							_rm.Identifier = 1
					  ) main
					  INNER JOIN BuildingComponent bc WITH (NOLOCK) ON main.RoomID=bc.RoomID
       ) main
       
       SET NOCOUNT OFF;
END

GO

IF (Select COUNT(*) FROM sys.tables Where name='EnterpriseDataTransfer') < 1
BEGIN
        CREATE TABLE [dbo].[EnterpriseDataTransfer](
			[EnterpriseDataTransferID] [int] IDENTITY(1,1) NOT NULL,
			[JobID] [int] NOT NULL,
			[EnterpriseJobID] [int] NULL,
			[ServerCode] [varchar](max) NOT NULL,
			[EnterpriseServerCode] [varchar](max) NOT NULL,
			[TEAMSUPRN] [varchar](max) NOT NULL,
			[DateCreated] [datetime] NOT NULL DEFAULT (GETDATE()),
			[DateStarted] [datetime] NULL,
			[TransferFailedStatus] [varchar](max) NULL,
			[ValidationFailedResult] [varchar](max) NULL,
			[DateFailed] [datetime] NULL,
			[DateCompleted] [datetime] NULL,
			[IVF_ImportGroupID] [int] NULL,
			[DateExported] [datetime] NULL,
			[DateTransferred] [datetime] NULL,
			CONSTRAINT [PK_EnterpriseDataTransfer] PRIMARY KEY CLUSTERED 
		(
			[EnterpriseDataTransferID] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
		) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
END

GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='EnterpriseDataTransfer') AND name='DateExported') < 1
BEGIN
    ALTER TABLE EnterpriseDataTransfer
        ADD [DateExported] DATETIME NULL
END
IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='Client') AND name='EnterpriseAuthEnc') < 1
BEGIN
    ALTER TABLE Client
        ADD [EnterpriseAuthEnc] [varchar] (max) NULL
END
IF (Select COUNT(*) FROM sys.tables Where name='EnterpriseDataTransfer_ServerCodeStoredProcedure') < 1
BEGIN
        CREATE TABLE [dbo].[EnterpriseDataTransfer_ServerCodeStoredProcedure](
            [EnterpriseDataTransfer_ServerCodeStoredProcedureID] [int] IDENTITY(1,1) NOT NULL,
            [ServerCode] [varchar](max) NOT NULL,
			[StoredProcedureName] [varchar](max) NOT NULL,
			[Deleted] [datetime] NULL
        CONSTRAINT [PK_EnterpriseDataTransfer_ServerCodeStoredProcedure] PRIMARY KEY CLUSTERED 
        (
            [EnterpriseDataTransfer_ServerCodeStoredProcedureID] ASC
        )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
        ) ON [PRIMARY]
END
IF (Select COUNT(*) FROM sys.tables Where name='EnterpriseDataTransfer_PostExportProcess') < 1
BEGIN
        CREATE TABLE [dbo].[EnterpriseDataTransfer_PostExportProcess](
            [EnterpriseDataTransfer_PostExportProcessID] [int] IDENTITY(1,1) NOT NULL,
            [ServerCode] [varchar](max) NOT NULL,
			[StoredProcedureName] [varchar](max) NOT NULL,
			[Deleted] [datetime] NULL
        CONSTRAINT [PK_EnterpriseDataTransfer_PostExportProcess] PRIMARY KEY CLUSTERED 
        (
            [EnterpriseDataTransfer_PostExportProcessID] ASC
        )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
        ) ON [PRIMARY]
END

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobileV2_DataTransfer_JobQuoteAppointment]    Script Date: 08/11/2018 12:19:34 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------
	

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='PhotoCollectionAutoInsert') AND name='LegionellaAssetOutletQuestionID') < 1
BEGIN
  ALTER TABLE PhotoCollectionAutoInsert
      ADD LegionellaAssetOutletQuestionID INT NULL
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO
/*    ==Scripting Parameters==

    Source Server Version : SQL Server 2008 (10.0.1600)
    Source Database Engine Edition : Microsoft SQL Server Standard Edition
    Source Database Engine Type : Standalone SQL Server

    Target Server Version : SQL Server 2008
    Target Database Engine Edition : Microsoft SQL Server Standard Edition
    Target Database Engine Type : Standalone SQL Server
*/

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment]    Script Date: 05/12/2018 16:20:37 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO





ALTER PROC [dbo].[mobile_Surveying_v2.4.1.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------
	

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END



GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.8_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Surveying_v2.4.2.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------
	

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ( [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ( [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID SELECT [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='App') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD App VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_JobQuoteAppointment]    Script Date: 21/02/2019 09:24:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.16_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = '',
	@DeviceGuid uniqueidentifier = NULL,
	@App VARCHAR(50) = NULL,
	@Platform VARCHAR(50) = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Appointment a
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
		LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
		LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
			) jqa ON c.ClientID=jqa.ClientID 

	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable
	--------------------------------------------------------
	

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]
	, dbo.get_SiteHighestRegisterItemNo([SiteID|INTEGER|NOTNULL||SERVERKEY]) [SiteHighestRegisterItemNo|VARCHAR|INT||] 
	FROM @SiteTable
	--------------------------------------------------------

	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID WHERE ae.EmployeeID=@EmployeeID SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
	DECLARE @JobTable TABLE ( [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ( [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


	SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.20_OrgInstruction]    Script Date: 21/02/2019 09:22:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.20_OrgInstruction')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.20_OrgInstruction] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.20_OrgInstruction]
(
	@JobID INT,
	@EmployeeID INT,
	@ScriptURL TEXT,
	@PreApprovalPath TEXT,
	@ApprovalPath TEXT
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @CreatedDate DATE

	SET @CreatedDate = ISNULL(@CreatedDate,GETDATE())
		
	INSERT INTO orgInstruction (JobID, orgPriorityID, orgStateID, EmployeeId, GenerateScriptURL, GenerationType, PreApprovalPath, ApprovalPath) VALUES (@JobID, 4, 0, @EmployeeID, @ScriptURL, 'legionella', @PreApprovalPath, @ApprovalPath)

	SELECT SCOPE_IDENTITY();

	SET NOCOUNT OFF;
END
GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.15_DataTransfer_MonitoringData]    Script Date: 21/02/2019 09:21:41 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.15_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.15_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.15_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;
  
    DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
	DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
	--Get @LegionellaTypeID
	--Select * FROM LegionellaType
	DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

	--SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

	DECLARE @LegionellaGUIDED TABLE
		(
			LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
			LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
			LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
			LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
			LegionellaAssetPhotoData IMAGE
		)

	--SELECT @RestrictedLegionellaAssetCategoryID
		
	INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
	Select 
		l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
		la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
		ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
		lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
	FROM
		Job j WITH (NOLOCK)
	    
		INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
		INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
		INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
	    
		INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
		INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
	    
		LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID
		LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID
		LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID

	Where
		j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

	DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
	Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1
	DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
	Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)
	DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
	Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0
	DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
	Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

      DECLARE @ReinspectData TABLE  
      (
            TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
            GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
            SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
            SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
            SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
            EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
            [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
            LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
            LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
            SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE
      )
      Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
      Select
            main.TableName,
            main.TableCategoryID,
            main.TableID,
            main.ParentID,
            main.GUID,
            main.GuidVersion,
            main.BuildingDesignation,
            main.GeneralDescriptionOfSite,
            main.AreasNotAccessed,
            main.Notes,
            main.SystemRef,
            main.Location,
            main.SourceCold,
            main.SourceHot,
            main.SourceMains,
            main.SourceMixed,
            main.SentinelCold,
            main.SentinelHot,
            main.SentinelMains,
            main.SentinelMixed,
            main.EnabledCold,
            main.EnabledHot,
            main.EnabledMains,
            main.EnabledMixed,
            main.LowUseCold,
            main.LowUseHot,
            main.LowUseMains,
            main.LowUseMixed,
            main.[LegionellaTaskAutoInsertID],
            main.[LegionellaTaskAutoInsertTypeID],
            main.[LegionellaTaskNo],
            main.[LegionellaSectionID], 
            main.[LegionellaRiskCategoryID],
            main.[RiskDescription],
            main.[Action], 
            main.[LegionellaFrequencyCategoryID],
            main.[LegionellaRiskRatingID],
            main.[LegionellaPriorityRatingID],
            main.[SortOrder],
			main.TaskDueDate [TaskDueDate],
			p.PhotoData [AssetPhotoData]

      FROM
            (
                  Select 
                        'Legionella' [TableName],
                        NULL [TableCategoryID],
                        l.LegionellaID [TableID],
                        NULL [ParentID],
                        l.GUID [GUID],
                        l.GUIDVersion [GUIDVersion],
                        l.BuildingDesignation [BuildingDesignation],
                        l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
						l.AreasNotAccessed [AreasNotAccessed],
						l.Notes [Notes],
                        NULL [SystemRef],
                        NULL [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate],
						NULL [PhotoID]
                  FROM 
                        Legionella l WITH (NOLOCK)
                        INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
						INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
				  WHERE
					    lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
                  UNION
                  Select 
                        'LegionellaAsset' [TableName],
                        la.LegionellaAssetCategoryID [TableCategoryID],
                        la.LegionellaAssetID [TableID],
                        ld.LegionellaID [ParentID],
                        la.GUID [GUID],
                        la.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        la.SystemRef [SystemRef],
                        la.Location [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate],
						la.PhotoID [PhotoID]
                  FROM 
                        LegionellaAsset la WITH (NOLOCK)
                        INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
                        INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID						                  
				  UNION
                  Select 
                        'LegionellaLocation' [TableName],
                        NULL [TableCategoryID],
                        ll.LegionellaLocationID [TableID],
                        ld.LegionellaID [ParentID],
                        ll.GUID [GUID],
                        ll.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        NULL [SystemRef],
                        ll.Location [Location],
                        NULL [SourceCold],
                        NULL [SourceHot],
                        NULL [SourceMains],
                        NULL [SourceMixed],
                        NULL [SentinelCold],
                        NULL [SentinelHot],
                        NULL [SentinelMains],
                        NULL [SentinelMixed],
                        NULL [EnabledCold],
                        NULL [EnabledHot],
                        NULL [EnabledMains],
                        NULL [EnabledMixed],
                        NULL [LowUseCold],
                        NULL [LowUseHot],
                        NULL [LowUseMains],
                        NULL [LowUseMixed],
						NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate],
						NULL [PhotoID]
                  FROM 
                        LegionellaLocation ll WITH (NOLOCK)
                        INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
                        INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
                  UNION
                  Select 
                        'LegionellaOutlet' [TableName],
                        lo.LegionellaOutletCategoryID [TableCategoryID],
                        lo.LegionellaOutletID [TableID],
                        lld.LegionellaLocationID [ParentID],
                        lo.GUID [GUID],
                        lo.GUIDVersion [GUIDVersion],
                        NULL [BuildingDesignation],
                        NULL [GeneralDescriptionOfSite],
						NULL [AreasNotAccessed],
						NULL [Notes],
                        lo.SystemRef [SystemRef],
                        NULL [Location],
                        lo.SourceCold [SourceCold],
                        lo.SourceHot [SourceHot],
                        lo.SourceMains [SourceMains],
                        lo.SourceMixed [SourceMixed],
                        lo.SentinelCold [SentinelCold],
                        lo.SentinelHot [SentinelHot],
                        lo.SentinelMains [SentinelMains],
                        lo.SentinelMixed [SentinelMixed],
                        lo.EnabledCold [EnabledCold],
                        lo.EnabledHot [EnabledHot],
                        lo.EnabledMains [EnabledMains],
                        lo.EnabledMixed [EnabledMixed],
                        lo.LowUseCold [LowUseCold],
						lo.LowUseHot [LowUseHot],
						lo.LowUseMains [LowUseMains],
						lo.LowUseMixed [LowUseMixed],
                        NULL [LegionellaTaskAutoInsertID],
                        NULL [LegionellaTaskAutoInsertTypeID],
                        NULL [LegionellaTaskNo],
                        NULL [LegionellaSectionID], 
                        NULL [LegionellaRiskCategoryID],
                        NULL [RiskDescription],
                        NULL [Action], 
                        NULL [LegionellaFrequencyCategoryID],
                        NULL [LegionellaRiskRatingID],
                        NULL [LegionellaPriorityRatingID],
                        NULL [SortOrder],
						NULL [TaskDueDate],
						NULL [PhotoID]
                  FROM 
                        LegionellaOutlet lo WITH (NOLOCK)
						INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
						INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
            ) main
			LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

		Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
		Select
			main.TableName,
			main.TableCategoryID,
			main.TableID,
			main.ParentID,
			main.GUID,
			main.GuidVersion,
			main.BuildingDesignation,
			main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
			main.AreasNotAccessed [AreasNotAccessed],
			main.Notes [Notes],
			main.SystemRef,
			main.Location,
			main.SourceCold,
			main.SourceHot,
			main.SourceMains,
			main.SourceMixed,
			main.SentinelCold,
			main.SentinelHot,
			main.SentinelMains,
			main.SentinelMixed,
			main.EnabledCold,
			main.EnabledHot,
			main.EnabledMains,
			main.EnabledMixed,
			main.LowUseCold,
			main.LowUseHot,
			main.LowUseMains,
			main.LowUseMixed,
			main.[LegionellaTaskAutoInsertID],
			main.[LegionellaTaskAutoInsertTypeID],
			main.[LegionellaTaskNo],
			main.[LegionellaSectionID], 
			main.[LegionellaRiskCategoryID],
			main.[RiskDescription],
			main.[Action], 
			main.[LegionellaFrequencyCategoryID],
			main.[LegionellaRiskRatingID],
			main.[LegionellaPriorityRatingID],
			main.[SortOrder],
			main.TaskDueDate [TaskDueDate]
		FROM
		(
			--now for the tasks!
			Select 
				'LegionellaTask_Outlet' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				lto.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Asset' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				lta.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Location' [TableName],
				NULL [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				ltll.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
			WHERE
				lt.Deleted IS NULL
			UNION
			Select 
				'LegionellaTask_Legionella' [TableName],
				lt.LegionellaSectionID [TableCategoryID],
				lt.LegionellaTaskID [TableID],
				ltl.TableID [ParentID],
				lt.GUID [GUID],
				lt.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
				NULL [AreasNotAccessed],
				NULL [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
				lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
				lt.LegionellaTaskNo [LegionellaTaskNo],
				lt.LegionellaSectionID [LegionellaSectionID], 
				lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
				lt.RiskDescription [RiskDescription],
				lt.[Action] [Action], 
				lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
				lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
				lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
				lt.SortOrder [SortOrder],
				lt.DueDate [TaskDueDate]
			FROM 
				LegionellaTask lt
				INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
			WHERE
				lt.Deleted IS NULL
		) main

      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
            UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
            DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
            Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
            UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
            DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
            Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
            UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
            DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
            Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
      END
      
      WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
      BEGIN
            DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
            UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
            DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
            Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
      END

      Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL
  
  SET NOCOUNT OFF;
END
GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_StaticTables]    Script Date: 21/02/2019 09:33:18 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.34_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0,
	  @DeviceGuid uniqueidentifier,
	  @App VARCHAR(50),
	  @Platform VARCHAR(50),
	  @DbSizeMb INT,
	  @DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
      SET NOCOUNT ON;
      
	  SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 3,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Airtest_v1.0.0.34_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable 
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable 
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable 
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable 
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable 
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable 
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable 
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable 
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable 
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable 
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable 
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable 
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable 
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable 

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable 
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable 
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable 
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable 
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable 
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable 
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable 
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable 
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable 
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable 
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable 
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable 
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable 
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable 
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable 
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable 
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable 
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable 

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable 
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable 
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable 
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable 
	  DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL AND (AirTestTypeID > 200 OR AirTestTypeID=2 OR AirTestTypeID=100)  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable 
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable 

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable 
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable 
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable 
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable 
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable 
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable 

      SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_StaticTables]    Script Date: 03/07/2019 13:09:27 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.45_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO


ALTER PROC [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0,
    @DeviceGuid uniqueidentifier,
    @App VARCHAR(50),
    @Platform VARCHAR(50),
    @DbSizeMb INT,
    @DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
      SET NOCOUNT ON;
      
    SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 3,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Airtest_v1.0.0.45_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable 
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable 
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable 
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable 
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable 
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable 
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable 
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable 
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable 
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable 
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable 
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable 
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable 
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable 

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable 
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable 
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable 
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable 
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable 
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable 
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable 
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable 
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable 
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable 
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable 
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable 
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable 
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable 
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable 
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable 
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable 
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable 

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable 
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable 
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable 
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable 
    DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL AND (AirTestTypeID > 200 OR AirTestTypeID=2 OR AirTestTypeID=100)  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable 
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable 

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable 
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable 
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable 
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable 
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable 
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable 

      SET NOCOUNT OFF;
END
GO


USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_JobQuoteAppointment]    Script Date: 21/02/2019 09:32:58 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.34_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.34_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = '',
	@DeviceGuid uniqueidentifier = NULL,
	@App VARCHAR(50) = NULL,
	@Platform VARCHAR(50) = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
	
	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
	
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - JSM: This needs to be after the client
	SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable 
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable 
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable 
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable 
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
	DECLARE @JobTable TABLE ( [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ( [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable 
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 


	SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_JobQuoteAppointment]    Script Date: 03/07/2019 13:07:14 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.45_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO



ALTER PROC [dbo].[mobile_Airtest_v1.0.0.45_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
  
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
          UNION
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - JSM: This needs to be after the client
  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable 
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable 
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable 
  --------------------------------------------------------


  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable 
  DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ( [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX), [RemovalContracterID|INTEGER|NULL|Client|] INT NULL ) INSERT INTO @JobTable ( [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|], [SiteAlert|VARCHAR|NULL||] ) Select j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), (
         SELECT
            top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] 
         FROM
            @JobQuoteAppointmentIDList jqal 
            INNER JOIN
               @AppointmentAirMonitoringTable aam 
               ON jqal.AppointmentID = aam.[AppointmentID|INTEGER|NOTNULL||]
         WHERE
            jqal.JobID = j.JobID
      ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 
  DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 

  DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 


  SET NOCOUNT OFF;
END
GO


USE [TEAMS]
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'DtsGuid' AND OBJECT_ID = OBJECT_ID('MobileAuditTrail'))
BEGIN
    ALTER TABLE MobileAuditTrail
    ADD [DtsGuid] uniqueidentifier NULL
END
GO

USE [TEAMS]
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'DtsGuid' AND OBJECT_ID = OBJECT_ID('MobileDtcLog'))
BEGIN
    ALTER TABLE MobileDtcLog
    ADD [DtsGuid] uniqueidentifier NULL
END
GO

USE [TEAMS]
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'DtsGuid' AND OBJECT_ID = OBJECT_ID('MobileDtcIdMap'))
BEGIN
    ALTER TABLE MobileDtcIdMap
    ADD [DtsGuid] uniqueidentifier NULL
END
GO

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_CreateMobileGuid')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_CreateMobileGuid] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_CreateMobileGuid]
(
	@DevDevice BIT,
	@Licensable BIT,
	@LicensableExpiry DATETIME = NULL
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE @MobileGuidID INT

	INSERT INTO MobileGuid (DevDevice,Licensable,LicensableExpiry) SELECT @DevDevice,@Licensable,@LicensableExpiry

	SET @MobileGuidID = SCOPE_IDENTITY();

	SELECT DeviceGuid FROM MobileGuid WHERE MobileGuidID = @MobileGuidID
	
	SET NOCOUNT OFF;
	
END

GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_StaticTables]    Script Date: 21/02/2019 09:26:07 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.16_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Surveying_v2.4.2.16_DataTransfer_StaticTables]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Platform VARCHAR(50),
	@DbSizeMb INT,
	@DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
      
	UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v2.4.2.16_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
	--SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable

	-- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
	DECLARE @EquipmentTable TABLE (
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
		[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
		[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
		[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
		[BranchOfficeID|INTEGER|NULL||] INTEGER NULL
	)

	INSERT INTO @EquipmentTable (
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
		[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
		[BranchOfficeID|INTEGER|NULL||]
	)      
	SELECT 
		e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
		e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
	FROM 
		Equipment e 
		LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
		LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
	WHERE 
		e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
	GROUP BY 
		e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

	SELECT 
		[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
		[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
		[BranchOfficeID|INTEGER|NULL||] 
	FROM 
		@EquipmentTable
	-------------------------------------------------------------------------------------------------------------

	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

	DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
	DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
	DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
	DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

	DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
	DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
	DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
	DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
	DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
	DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
	DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

	DECLARE @EmployeeTable TABLE ([EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @EmployeeTable ([EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])	Select [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee	SELECT [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable

	SET NOCOUNT OFF;
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.20_OrgInstruction]    Script Date: 06/03/2019 17:58:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Legionella_v1.4.0.20_OrgInstruction]
(
	@JobID INT,
	@EmployeeID INT,
	@ScriptURL TEXT,
	@PreApprovalPath TEXT,
	@ApprovalPath TEXT
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @CreatedDate DATE

	SET @CreatedDate = ISNULL(@CreatedDate,GETDATE())

	INSERT INTO ReportInformation (TemplateId, Report)
		SELECT TOP 1 t.TemplateID, t.Template FROM Job j
		INNER JOIN Quote q ON j.JobID = q.JobID
		INNER JOIN Appointment a ON q.QuoteID = a.QuoteID
		INNER JOIN AppointmentLegionella al ON a.AppointmentID = al.AppointmentID
		INNER JOIN LegionellaType lt ON al.LegionellaTypeID = lt.LegionellaTypeID
		INNER JOIN TemplateType tt ON lt.TemplateTypeID = tt.TemplateTypeID
		OUTER APPLY (
			SELECT Top 1 TemplateID, Template FROM Template t WHERE t.TemplateTypeID = tt.TemplateTypeID ORDER BY ISNULL(Version, 0) DESC
		) AS t
		WHERE j.JobID = @JobID

	UPDATE Legionella SET ReportInformationID = (SELECT SCOPE_IDENTITY()) WHERE LegionellaID = (SELECT MAX (LegionellaID) LegionellaID FROM Job j
		INNER JOIN JobEmployee je ON j.JobID = je.JobID
		INNER JOIN Legionella l ON je.JobEmployeeID = l.JobEmployeeID
		WHERE j.JobID = @JobID)
				
	INSERT INTO orgInstruction (JobID, orgPriorityID, orgStateID, EmployeeId, GenerateScriptURL, GenerationType, PreApprovalPath, ApprovalPath) VALUES (@JobID, 4, 0, @EmployeeID, @ScriptURL, 'legionella', @PreApprovalPath, @ApprovalPath)

	SELECT SCOPE_IDENTITY();

	SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.23_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_JobQuoteAppointment]    Script Date: 12/04/2019 12:32:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Quote q
    INNER JOIN Site si ON q.SiteID = si.SiteID
    INNER JOIN Client c ON c.ClientID = q.ClientID
    INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable  GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable 
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable 
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable 
  DECLARE @AppointmentLegionellaTable TABLE ([AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentLegionellaTable ([AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select al.[AppointmentLegionellaID],al.[AppointmentID],al.LegionellaTypeID,al.DueDate FROM AppointmentLegionella al WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentLegionellaTable 
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
          UNION
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------


  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------


  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable 
  DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ) 
  
  INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||]) 
    Select 
      qv.[QuoteVisitID],
      qv.[QuoteVisitTypeID],
      qv.[QuoteEmployeeID],
      qv.[QuoteVisitStart],
      qv.[QuoteVisitFinish],
      qv.[Notes],
      qv.[PhotoID],
      qv.[SystemName],
      qv.[Closed],
      qv.[Finished],
      qv.[SignatureID],
      qv.[_QuoteVisitConsumableMarkup],
      qv.[_QuoteVisitEquipmentMarkup],
      qv.[_QuoteVisitLabourMarkup] 
    FROM 
      QuoteVisit qv 
      INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID 
      
  SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  --------------------------------------------------------

  DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 

  DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 


  SET NOCOUNT OFF;
END


GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.23_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_StaticTables]    Script Date: 12/04/2019 12:33:20 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.23_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
    @SystemName nvarchar(MAX),
    @Version nvarchar(MAX),
	@EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Platform VARCHAR(50),
	@DbSizeMb INT,
	@DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
      SET NOCOUNT ON;
      
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.4.0.23_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
		DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
		DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType1|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
		DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
		DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
		DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
		DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
		DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
		DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
		DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
		DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
		DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
		DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
		DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
		DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
		DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
		DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
		DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
		DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
		DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
		DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
		DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
		DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
		DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
		DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
		DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL  SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
		DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
		DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
		DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
		DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
		DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
		DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
		DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
		DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
		DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
		DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

		DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
		DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable

		DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable 
		DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
		DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable

		DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
		DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
		DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
		DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
		DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
		DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
		DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DefaultOutletCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||])  Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted],[DefaultOutletCode] FROM LegionellaOutletCategory SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||] FROM @LegionellaOutletCategoryTable
		DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
		DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
		DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
		DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
		DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
		DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
		DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
		DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
		DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable

		DECLARE @OrgErrorCode TABLE ([ErrorCodeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ParentCodeID|INTEGER|NULL||] INT NULL ,[ExceptionMessage|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[orgErrorCodeID|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgErrorCode ([ErrorCodeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||]) Select [ErrorCodeID],[Description],[ParentCodeID],[ExceptionMessage],[orgErrorCodeID] FROM OrgErrorCode SELECT [ErrorCodeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||] FROM @OrgErrorCode
		DECLARE @OrgState TABLE ([orgStateID|INTEGER|NOTNULL||] INT NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgState ([orgStateID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||]) Select [orgStateID],[ShortDescription],[Description] FROM orgState SELECT [orgStateID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||] FROM @OrgState

      SET NOCOUNT OFF;
END
GO

SET ANSI_PADDING ON
GO
BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcIdMapHistory'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcIdMapHistory](
			[MobileDtcIdMapHistoryId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[TableName] [varchar](50) NOT NULL,
			[MobileId] [int] NOT NULL,
			[ServerId] [int] NOT NULL,
			[SetDtc] [bit] NULL,
			[App] [varchar](50) NULL,
			[Version] [varchar](50) NULL,
			[DeviceGuid] [uniqueidentifier] NULL,
			[Platform] [varchar](50) NULL,
			[DtsGuid] [uniqueidentifier] NULL,
		 CONSTRAINT [PK_MobileDtcIdMapHistory_MobileDtcIdMapHistoryId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcIdMapHistoryId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]	
	END 
COMMIT TRANSACTION
GO
SET ANSI_PADDING OFF
GO

IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'Processed' AND OBJECT_ID = OBJECT_ID('MobileDtcIdMap'))
BEGIN
    ALTER TABLE MobileDtcIdMap ADD Processed BIT NULL
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_IdMapClearDown') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_v2_IdMapClearDown] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_v2_IdMapClearDown]
(
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50)
)
AS
BEGIN
	
	SET NOCOUNT ON;	

	DELETE FROM MobileDtcIdMap WHERE DeviceGuid=@DeviceGuid AND App=@App AND DateCreated < DATEADD(week,-1,GETDATE());

	DELETE FROM MobileDtcIdMapHistory WHERE DeviceGuid=@DeviceGuid AND App=@App AND DateCreated < DATEADD(week,-4,GETDATE());
	
	SET NOCOUNT OFF;
END
GO



IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'PhotoCollectionID' AND OBJECT_ID = OBJECT_ID('Element'))
BEGIN
    ALTER TABLE Element
    ADD [PhotoCollectionID] int NULL
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_NextSampleRefBySystemName')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_NextSampleRefBySystemName] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_v2_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Version VARCHAR(50),
	@Platform VARCHAR(50)
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	IF (SELECT COUNT(*) FROM Config WHERE s__CompanyName = 'TEAMS DEMO COMPANY' OR s__CompanyName = 'App Review Demo Company') = 1 BEGIN 
		UPDATE Config SET s__EnableMobileLicensing = DATEADD(dd,2,GETDATE())
	END

	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC

	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated, EmployeeID,DeviceGuid,App,[Version],[Platform])
			SELECT 2, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_v2_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE(), @EmployeeID, @DeviceGuid,@App,@Version,@Platform

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
	
END
GO


USE [TEAMS]
GO
DELETE FROM MobileAuditTrail WHERE Category=0 AND Message = 'Failed Authorsation' AND DateCreated<'2019-08-08 08:00:00'

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_LicenceAuthorisation')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_LicenceAuthorisation] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_v2_LicenceAuthorisation]    Script Date: 26/03/2019 09:49:14 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_v2_LicenceAuthorisation]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Version VARCHAR(50),
	@Platform VARCHAR(50),
	@DevDevice BIT,
	@Licensable BIT,
	@LicensableExpiry DATETIME = NULL
)
AS
BEGIN
	
	SET NOCOUNT ON;	
	
	/* ### Override the Extra parameters from what is in the MobileGuid table ### */
	If (SELECT COUNT(*) FROM MobileGuid WHERE DeviceGuid=@DeviceGuid) > 0 BEGIN
		SELECT @DevDevice=DevDevice,@Licensable=Licensable,@LicensableExpiry=LicensableExpiry FROM MobileGuid WhERE DeviceGuid=@DeviceGuid
	END
	
	/* ### Create the MobileGuid record ### */
	If (SELECT COUNT(*) FROM MobileGuid WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
		INSERT INTO MobileGuid (DeviceGuid,DevDevice,Licensable,LicensableExpiry) SELECT @DeviceGuid,@DevDevice,@Licensable,@LicensableExpiry
	END

	/* ### Auto license the equipment record that matches the system name, if a free key is available ### */
	IF (SELECT COUNT(*) FROM Equipment WHERE EquipmentCategoryID=19 AND RefNo=@SystemName AND MobileUnitLicenceKeyID IS NULL) > 0 BEGIN
		UPDATE e
			Set MobileUnitLicenceKeyID=u.MobileUnitLicenceKeyID
		FROM
			Equipment e
			CROSS APPLY
			(
				Select TOP 1
					mulk.MobileUnitLicenceKeyID
				FROM 
					MobileUnitLicenceKey mulk
					LEFT OUTER JOIN 
					(
						SELECT
							e.MobileUnitLicenceKeyID
						FROM
							Equipment e
						WHERE
							e.EquipmentCategoryID=19 
								AND 
							e.DeviceGuid IS NULL 
						GROUP BY
							e.MobileUnitLicenceKeyID
					) e ON mulk.MobileUnitLicenceKeyID=e.MobileUnitLicenceKeyID
				WHERE 
					e.MobileUnitLicenceKeyID IS NULL
			) u
		WHERE
			e.RefNo=@SystemName AND e.MobileUnitLIcenceKeyID IS NULL AND e.EquipmentCategoryID=19

	END

	/* ### Create the Equipment record if it doesnt exist ### */
	If (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
		INSERT INTO Equipment (DeviceGuid,EquipmentCategoryID,RefNo,Description,BranchOfficeID,MobileUnitLicenceKeyID)
		SELECT @DeviceGuid,19,@DeviceGuid,@DeviceGuid,ISNULL((SELECT BranchOfficeID FROM Employee WHERE EmployeeID=@EmployeeID),(SELECT TOP 1 BranchOfficeID FROM BranchOffice WHERE [Default]=1)),
		CASE WHEN @Licensable = 1 THEN
			(
				SELECT 
					mulk.MobileUnitLicenceKeyID
				FROM
					Equipment e
					INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID
					LEFT OUTER JOIN Equipment ge ON mulk.MobileUnitLicenceKeyID=ge.MobileUnitLicenceKeyID AND ge.DeviceGuid IS NOT NULL
				WHERE
					e.EquipmentCategoryID = 19
						AND
					e.RefNo = @SystemName
						AND
					ge.EquipmentID IS NULL
			)
		END
	END
	
	IF (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid) > 0 AND (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid AND MobileUnitLicenceKeyID IS NOT NULL) = 0 BEGIN
		UPDATE
			Equipment
			SET MobileUnitLicenceKeyID =
					CASE WHEN @Licensable = 1 THEN
						(
							SELECT 
								mulk.MobileUnitLicenceKeyID
							FROM
								Equipment e
								INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID
								LEFT OUTER JOIN Equipment ge ON mulk.MobileUnitLicenceKeyID=ge.MobileUnitLicenceKeyID AND ge.DeviceGuid IS NOT NULL
							WHERE
								e.EquipmentCategoryID = 19
									AND
								e.RefNo = @SystemName
									AND
								ge.EquipmentID IS NULL
						)
					END
		WHERE
			 DeviceGuid=@DeviceGuid
	END

	IF (SELECT COUNT(*) FROM MobileAuditTrail WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform]) SELECT 2,@SystemName,'Initial Connection for DeviceGuid','MobileAuditTrail',0,'mobile_v2_LicenceAuthorisation',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform
	END


	DECLARE @Authorised BIT = 0

	IF (SELECT COUNT(*) FROM Equipment e INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID WHERE e.DeviceGuid=@DeviceGuid AND (@LicensableExpiry>GETDATE() OR @LicensableExpiry IS NULL)) > 0 OR (@Licensable = 1 AND @LicensableExpiry>GETDATE()) OR @Licensable=0 BEGIN
		SET @Authorised = 1
	END
	
	IF (SELECT COUNT(*) FROM Config WHERE s__CompanyName = 'TEAMS DEMO COMPANY' OR s__CompanyName = 'App Review Demo Company') = 1 BEGIN 
		UPDATE Config SET s__EnableMobileLicensing = DATEADD(dd,2,GETDATE())
	END
	
	IF @Authorised = 0 BEGIN
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform]) SELECT 0,@SystemName,'Failed Authorisation','MobileAuditTrail',0,'mobile_v2_LicenceAuthorisation','0.0.0.0','0.0.0.0',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform
		SET @Authorised = 1
	END

	SELECT @Authorised [Authorised], @DeviceGuid [DeviceGuid], @DevDevice [DevDevice], @Licensable [Licensable], @LicensableExpiry [LicensableExpiry];
	
	SET NOCOUNT OFF;
	
END
GO

USE [TEAMS]
GO
IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'LegionellaMonitoringStructureOnly' AND OBJECT_ID = OBJECT_ID('LegionellaType'))
BEGIN
    ALTER TABLE LegionellaType
    ADD [LegionellaMonitoringStructureOnly] int DEFAULT(0) NOT NULL
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.38_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.38_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.38_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;

    
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  12452 AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 1
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

  --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

  DECLARE @LegionellaGUIDED TABLE
  (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
  )

  --SELECT @RestrictedLegionellaAssetCategoryID
    
  INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
  Select 
  l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
  la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
  ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
  lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
  FROM
  Job j WITH (NOLOCK)
      
  INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
  INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
  INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
  INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
  INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
  LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID
  LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID
  LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID

  Where
  j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

  DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
  Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1
  DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
  Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)
  DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
  Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0
  DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
  Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE
    )
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData]

    FROM
      (
          Select 
            'Legionella' [TableName],
            NULL [TableCategoryID],
            l.LegionellaID [TableID],
            NULL [ParentID],
            l.GUID [GUID],
            l.GUIDVersion [GUIDVersion],
            l.BuildingDesignation [BuildingDesignation],
            l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
            NULL [SystemRef],
            NULL [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            Legionella l WITH (NOLOCK)
            INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
      INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
        lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
          UNION
          Select 
            'LegionellaAsset' [TableName],
            la.LegionellaAssetCategoryID [TableCategoryID],
            la.LegionellaAssetID [TableID],
            ld.LegionellaID [ParentID],
            la.GUID [GUID],
            la.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            la.SystemRef [SystemRef],
            la.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
          FROM 
            LegionellaAsset la WITH (NOLOCK)
            INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
            INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID                              
      UNION
          Select 
            'LegionellaLocation' [TableName],
            NULL [TableCategoryID],
            ll.LegionellaLocationID [TableID],
            ld.LegionellaID [ParentID],
            ll.GUID [GUID],
            ll.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            NULL [SystemRef],
            ll.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaLocation ll WITH (NOLOCK)
            INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
            INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
          UNION
          Select 
            'LegionellaOutlet' [TableName],
            lo.LegionellaOutletCategoryID [TableCategoryID],
            lo.LegionellaOutletID [TableID],
            lld.LegionellaLocationID [ParentID],
            lo.GUID [GUID],
            lo.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            lo.SystemRef [SystemRef],
            NULL [Location],
            lo.SourceCold [SourceCold],
            lo.SourceHot [SourceHot],
            lo.SourceMains [SourceMains],
            lo.SourceMixed [SourceMixed],
            lo.SentinelCold [SentinelCold],
            lo.SentinelHot [SentinelHot],
            lo.SentinelMains [SentinelMains],
            lo.SentinelMixed [SentinelMixed],
            lo.EnabledCold [EnabledCold],
            lo.EnabledHot [EnabledHot],
            lo.EnabledMains [EnabledMains],
            lo.EnabledMixed [EnabledMixed],
            lo.LowUseCold [LowUseCold],
      lo.LowUseHot [LowUseHot],
      lo.LowUseMains [LowUseMains],
      lo.LowUseMixed [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

  Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
  Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
  FROM
  (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
  ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END

    Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID
  
  SET NOCOUNT OFF;
END


GO


USE [TEAMS]
GO
IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.40_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.40_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v2.4.2.40_DataTransfer_JobQuoteAppointment]    Script Date: 09/03/2019 10:25:23 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Surveying_v2.4.2.40_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )  
  
  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
      ) jqa ON c.ClientID=jqa.ClientID      
      
  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM StandardPhraseCategoryClient WHERE ClientID IS NOT NULL GROUP BY ClientID 
      ) spcc ON c.ClientID=spcc.ClientID      

  SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable GROUP BY [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]
  --------------------------------------------------------
  

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]
  , dbo.get_SiteHighestRegisterItemNo([SiteID|INTEGER|NOTNULL||SERVERKEY]) [SiteHighestRegisterItemNo|VARCHAR|INT||] 
  FROM @SiteTable
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
  DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID WHERE ae.EmployeeID=@EmployeeID SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
  DECLARE @JobTable TABLE ( [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ( [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
  DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable

  DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
  DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
  DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


  SET NOCOUNT OFF;
END


GO

USE [TEAMS]
GO
IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_IdMapCheck')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_IdMapCheck] AS BEGIN SET NOCOUNT ON; END')
END
GO

/****** Object:  StoredProcedure [dbo].[mobile_v2_IdMapCheck]    Script Date: 10/22/2019 10:56:35 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_v2_IdMapCheck]
(
  @SystemName nvarchar(MAX),
    @EmployeeID INT,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Version VARCHAR(50),
  @Platform VARCHAR(50),
  @DevDevice BIT,
  @Licensable BIT,
  @LicensableExpiry DATETIME = NULL
)
AS
BEGIN
  
  SET NOCOUNT ON; 
  
  DECLARE @RecordCount INT = (SELECT COUNT(*) FROM MobileDtcIdMap WHERE DeviceGuid=@DeviceGuid AND App=@App)

  SELECT 
    @RecordCount [RecordCount], 
    CASE WHEN @RecordCount > 0 THEN 'This tablet currently has previous data on the server that needs verification. Please contact TEAMS support.' ELSE '' END [TabletErrorDescription]


  SET NOCOUNT OFF;
  
END


GO


INSERT INTO MobileConfigType(MobileConfigTypeID, ConfigType, Description) SELECT 134, 'PhotoCompressionLevel', 'MobileConfigInt for the value between 0-100 of compression to apply when saving a photo. 0 being the worse to 100 maximum quality' WHERE (SELECT COUNT(*) FROM MobileConfigType WHERE MobileConfigTypeID=134)=0
GO

INSERT INTO MobileConfigType(MobileConfigTypeID, ConfigType, Description) SELECT 135, 'FloorplanImportCompressionLevel', 'MobileConfigInt for the value between 0-100 of compression to apply when importing an image into the Floorplan Designer. 0 being the worse to 100 maximum quality' WHERE (SELECT COUNT(*) FROM MobileConfigType WHERE MobileConfigTypeID=135)=0
GO

INSERT INTO MobileConfigType(MobileConfigTypeID, ConfigType, Description) SELECT 136, 'StandardProcedureAutoImport', 'MobileConfigInt for the value between 0-100 of compression to apply when saving a photo. 0 being the worse to 100 maximum quality' WHERE (SELECT COUNT(*) FROM MobileConfigType WHERE MobileConfigTypeID=136)=0
GO

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.46_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.46_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
End
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.46_DataTransfer_StaticTables]    Script Date: 13/11/2019 15:57:21 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Legionella_v1.4.0.46_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
    @SystemName nvarchar(MAX),
    @Version nvarchar(MAX),
	@EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Platform VARCHAR(50),
	@DbSizeMb INT,
	@DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
      SET NOCOUNT ON;
      
		INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.4.0.46_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
		DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
		DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
		DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
		DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
		DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
		DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
		DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
		DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
		DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
		DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
		DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
		DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
		DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
		DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
		DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
		DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
		DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
		DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
		DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
		DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
		DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
		DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
		DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
		DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
		DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL  SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
		DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
		DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
		DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
		DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
		DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
		DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
		DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
		DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
		DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
		DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

		DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
		DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable

		DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable 
		DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
		DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable

		DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
		DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
		DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
		DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
		DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
		DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
		DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DefaultOutletCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||])  Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted],[DefaultOutletCode] FROM LegionellaOutletCategory SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||] FROM @LegionellaOutletCategoryTable
		DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
		DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
		DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
		DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
		DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
		DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
		DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
		DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
		DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable

		DECLARE @OrgErrorCode TABLE ([ErrorCodeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ParentCodeID|INTEGER|NULL||] INT NULL ,[ExceptionMessage|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[orgErrorCodeID|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgErrorCode ([ErrorCodeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||]) Select [ErrorCodeID],[Description],[ParentCodeID],[ExceptionMessage],[orgErrorCodeID] FROM OrgErrorCode SELECT [ErrorCodeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||] FROM @OrgErrorCode
		DECLARE @OrgState TABLE ([orgStateID|INTEGER|NOTNULL||] INT NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgState ([orgStateID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||]) Select [orgStateID],[ShortDescription],[Description] FROM orgState SELECT [orgStateID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||] FROM @OrgState

      SET NOCOUNT OFF;
END
GO


If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData_Surveying_v2.4.2.58') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData_Surveying_v2.4.2.58] AS BEGIN SET NOCOUNT ON; END')
End
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[EnterpriseSiteData_Surveying_v2.4.2.58]
(
      @ClientID INT,
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
      @IncludePhotoNoColumn BIT = 0,
      @ExcludeBinaryData BIT = 0,
      @JobReinspectionStructureID INT = 0,
      @FilterToJobID INT = 0,
	  @IncludeTableResponse VARCHAR(MAX) = 'Register,Floorplan,Room,Sample,Element,BuildingComponent,JobLink'
)
AS
BEGIN
	SET NOCOUNT ON;
                   
	If @RequestingServerCode != (SELECT s__ServerCode FROM Config) BEGIN
		SET @FilterToJobID = 0
	END

	IF @FilterToJobID > 0 BEGIN
	SET @JobReinspectionStructureID = (SELECT ISNULL((SELECT TOP 1 JobReinspectionStructureID FROM JobReinspectionStructure WHERE JobID=@FilterToJobID AND NoDataRequired=0),0))
		IF @JobReinspectionStructureID = 0 BEGIN
			SET @FilterToJobID = 0
		END
	END

    DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
                
    DECLARE @IDList TABLE (JobID INT, JobNo VARCHAR(MAX), UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
    Insert into @IDList (JobID,JobNo,UseRoomCode,RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
    SELECT 
		j.JobID, TEAMS.dbo.FormatTeamsReference('J',j.JobNo),
		CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
		r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
		fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
		rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
		s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
    FROM 
        (
			SELECT 
				j.JobID, j.JobNo, j.SiteID
			FROM
				Job j WITH (NOLOCK)
				INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
				INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
			WHERE
				j.SiteID = @SiteID
					AND
				j.ClientID = @ClientID
					AND
				a.DateDeclined IS NULL
					AND
				j.Approved IS NOT NULL
        ) j
        INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
        INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
        LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
        LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
        LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
        LEFT OUTER JOIN Element e2 WITH (NOLOCK) ON s.SampleID = e2.SampleID AND e2.ElementTypeID = 2
        LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON 
            (
                CASE WHEN s.SampleID IS NOT NULL AND jrsd.SampleID IS NOT NULL THEN
                    CASE WHEN jrsd.SampleID=s.SampleID THEN 1 ELSE 0 END
                ELSE
                    CASE WHEN rm.RoomID IS NOT NULL AND jrsd.RoomID IS NOT NULL THEN
		                CASE WHEN jrsd.RoomID=rm.RoomID THEN 1 ELSE 0 END
                    ELSE
                        CASE WHEN fp.FloorplanID IS NOT NULL AND jrsd.FloorplanID IS NOT NULL THEN
                            CASE WHEN jrsd.FloorplanID=fp.FloorplanID THEN 1 ELSE 0 END
                        ELSE
                            CASE WHEN jrsd.RegisterID=r.RegisterID THEN 1 ELSE 0 END
                        END
                    END
                END = 1
            )
                AND 
			jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
    WHERE 
        CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
            AND
        (CASE WHEN s.SampleID IS NOT NULL AND e2.ElementID IS NULL THEN 0 ELSE 1 END=1)

	IF @IncludeTableResponse LIKE '%Register%' BEGIN
		SELECT
			main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, CASE WHEN @ExcludeBinaryData=0 THEN p.PhotoData END [PhotoData], p.ContentType,
			r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode,
			main.Included, NULL [AssociatedJobNoList]
		FROM
			(
				Select
					'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode,
					CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
							MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
						FROM
							@IDList idl
						GROUP BY
							RegisterID,BuildingGUID,BuildingGUIDVersion
					) _r
					LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RegisterID=_r.RegisterID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
				WHERE
					_r.Identifier = 1
				GROUP BY
					_r.RegisterID, BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode, CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
			) main
			INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
			LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
		WHERE
			r.[GUID] IS NOT NULL AND r.[GUIDVersion] IS NOT NULL
	END

	IF @IncludeTableResponse LIKE '%Floorplan%' BEGIN
		SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
			main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
			CASE WHEN fp.FloorNumber = -200 THEN -2 ELSE fp.FloorNumber END [FloorNumber], 
			CASE WHEN @ExcludeBinaryData=0 THEN CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END END [FloorplanData],
			CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType],
			main.Included, NULL [AssociatedJobNoList]
		FROM
			(      
				Select
					'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,
					CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
							id.FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
						FROM
							@IDList id											
						GROUP BY
							id.FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
					) _f
					LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.FloorplanID=_f.FloorplanID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
				WHERE
					_f.Identifier = 1
									AND
					CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
				GROUP BY
					_f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
			) main
			INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
		WHERE
			fp.[GUID] IS NOT NULL AND fp.[GUIDVersion] IS NOT NULL
	END

	IF @IncludeTableResponse LIKE '%Room%' BEGIN    
		SELECT
			main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
			rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode,
			CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included],
			rm.RoomGroupID [ServerRoomGroupID], rm.ParentGroupID [ServerParentGroupID], NULL [AssociatedJobNoList]
		FROM
			(
				Select
					'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
							RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
						FROM
							@IDList id
						GROUP BY
							RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
					) _rm
				WHERE
					_rm.Identifier = 1
			) main
			INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
			LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RoomID=rm.RoomID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
		WHERE
			CASE WHEN @FilterToJobID > 0 THEN 
				CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 
			END = 1
				AND
			rm.[GUID] IS NOT NULL AND rm.[GUIDVersion] IS NOT NULL
		GROUP BY
			main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode, rm.RoomGroupID, rm.ParentGroupID,
			CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
    END
	 
    DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT, Included INT, AssociatedJobNoList VARCHAR(MAX))
       
    INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion,Included,AssociatedJobNoList)
    SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion, main.Included,  NULL [AssociatedJobNoList]
    FROM
        (      
			Select
				'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion,
				CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
			FROM
				(
					SELECT
						ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
					FROM
						@IDList id
					GROUP BY
						SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
				) _s
				LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.SampleID=_s.SampleID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
			WHERE
				_s.Identifier = 1
					AND
				CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
        ) main
        INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
        INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID AND gs.ClientID=@ClientID
    WHERE
        s.[GUID] IS NOT NULL AND s.[GUIDVersion] IS NOT NULL
    GROUP BY
        main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion, main.Included

	CREATE TABLE #PhotoDataFromStore  (PhotoID INT, PhotoData IMAGE, TEAMS_StoreID INT, DataTaken INT)
	INSERT INTO #PhotoDataFromStore  (PhotoID,TEAMS_StoreID,DataTaken)
	SELECT
		p.PhotoID, p.TEAMS_StoreID, 0
	FROM
		@GuidSamples main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		INNER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
	WHERE
		p.TEAMS_StoreID IS NOT NULL
	GROUP BY 
		p.PhotoID, p.TEAMS_StoreID
	
	IF (SELECT COUNT(*) FROM #PhotoDataFromStore ) > 0 BEGIN
		DECLARE @curTEAMS_StoreID INT=0
		DECLARE storeData CURSOR FOR
		SELECT 
			pdfsCur.TEAMS_StoreID
		FROM 
			#PhotoDataFromStore  pdfsCur 
		GROUP BY
			pdfsCur.TEAMS_StoreID
		
		OPEN storeData
		FETCH NEXT FROM storeData INTO @curTEAMS_StoreID
		WHILE @@FETCH_STATUS = 0 BEGIN
			DECLARE @DynamicSQL NVARCHAR(MAX) = 'SELECT p.PhotoID,p.PhotoData,pdfs.TEAMS_StoreID,1 FROM TEAMS_Store' + CAST(@curTEAMS_StoreID as varchar(MAX)) + '.dbo.Photo p INNER JOIN #PhotoDataFromStore pdfs ON p.PhotoID=pdfs.PhotoID WHERE pdfs.TEAMS_StoreID=' + CAST(@curTEAMS_StoreID as varchar(MAX))
			INSERT INTO #PhotoDataFromStore (PhotoID,PhotoData,TEAMS_StoreID,DataTaken)
			EXEC sp_executesql @DynamicSQL
			FETCH NEXT FROM storeData INTO @curTEAMS_StoreID
		END
		CLOSE storeData
		DEALLOCATE storeData
	END

	IF @IncludeTableResponse LIKE '%Sample%' BEGIN
		SELECT
			main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
			s.RegisterItemNo,p.PhotoID,CASE WHEN @ExcludeBinaryData=0 THEN CASE WHEN pdfs.PhotoID IS NOT NULL THEN ISNULL(pdfs.PhotoData,p.PhotoData) ELSE p.PhotoData END END [PhotoData], 
			p.PhotoNo, REPLACE(REPLACE(REPLACE(s.SampleRef,'****','*'),'***','*'),'**','*') [SampleRef], s.AsSample,  
			s.SampleResultID, s.SampleClassificationID, 
			sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
			s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee], main.Included, main.AssociatedJobNoList [AssociatedJobNoList]
		FROM
			@GuidSamples main
			INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
			LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
			LEFT OUTER JOIN #PhotoDataFromStore pdfs ON s.PhotoID=pdfs.PhotoID AND pdfs.DataTaken = 1
			LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
			LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
	END

	IF @IncludeTableResponse LIKE '%Element%' BEGIN
		SELECT
			main.TableName,
			main.SampleID,
			main.RegisterID,
			main.ElementTypeID,
			main.ElementText
		FROM
		(
			SELECT
				'Element' [TableName],
				e.SampleID, 
				NULL [RegisterID],
				e.ElementTypeID,
				CASE WHEN e.ElementText IS NOT NULL THEN
					e.ElementText
				ELSE
					CASE WHEN e.ElementTypeID = 20 THEN
							ISNULL(eime.Description,ISNULL(eim.ShortDescription,eim.Description))
					ELSE
							CASE WHEN e.ElementTypeID = 32 THEN
									CAST(e.ElementIntID as varchar)
							ELSE
									ISNULL(ISNULL(eime.Description,eimso.Description),eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
							END
					END
				END [ElementText]
			FROM
				@GuidSamples main
				INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
				LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
				LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
				LEFT OUTER JOIN ElementIntMeaningSubOption eimso WITH (NOLOCK) ON eimso.ElementIntMeaningSubOptionID=e.ElementIntMeaningSubOptionID
			WHERE
				e.ElementTypeID NOT IN (32)
			UNION
			SELECT
				'Element' [TableName],
				NULL [SampleID], 
				e.RegisterID [RegisterID],
				e.ElementTypeID,
				CASE WHEN e.ElementText IS NOT NULL THEN
					e.ElementText
				ELSE
					CASE WHEN e.ElementTypeID = 20 THEN
							ISNULL(eime.Description,ISNULL(eim.ShortDescription,eim.Description))
					ELSE
							CASE WHEN e.ElementTypeID = 32 THEN
									CAST(e.ElementIntID as varchar)
							ELSE
									ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
							END
					END
				END [ElementText]
			FROM
				(
					Select
							_r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
					FROM
					(
							SELECT
									ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
									MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
							FROM
									@IDList
							GROUP BY
									RegisterID,BuildingGUID,BuildingGUIDVersion
					) _r
					WHERE
							_r.Identifier = 1
				) main
				INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
				INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
				LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
				LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
			WHERE
				CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
					1 
				ELSE
					CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
				END = 1
		) main
	END
   
   IF @IncludeTableResponse LIKE '%BuildingComponent%' BEGIN
		SELECT
			main.TableName,
			main.RoomID,
			main.ItemNo,
			main.[Description],
			main.[Position],
			main.[Comments]
		FROM
			(
				SELECT
					'BuildingComponent' [TableName],
					main.RoomID,
					bc.ItemNo,
					bc.[Description],
					bc.[Position],
					bc.[Comments]
				FROM
					(
						Select
							'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
						FROM
							(
								SELECT
									ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
									RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
								FROM
									@IDList
								GROUP BY
									RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
							) _rm
						WHERE
							_rm.Identifier = 1
					) main
					INNER JOIN BuildingComponent bc WITH (NOLOCK) ON main.RoomID=bc.RoomID
			) main
    END

	IF @IncludeTableResponse LIKE '%JobLink%' BEGIN
		SELECT
			'Ignore' [TableName], 
			id.JobNo, 
			id.SampleID, 
			id.ItemGUID,
			id.ItemGUIDVersion 
			--id.*
		FROM 
			@IDList id
		WHERE
			id.SampleID IS NOT NULL
				AND
			id.ItemGUID IS NOT NULL
		GROUP BY
			id.JobNo,
			id.SampleId,
			id.ItemGUID,
			id.ItemGUIDVersion
	END
	SET NOCOUNT OFF;

END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.46_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.46_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Legionella_v1.4.0.46_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;
    
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

  --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

  DECLARE @LegionellaGUIDED TABLE
  (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
  )

  --SELECT @RestrictedLegionellaAssetCategoryID
    
  INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
  Select 
    l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
    la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
    ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
    lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
  FROM
    Job j WITH (NOLOCK)
      
    INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
    INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
    INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
    INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
    INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
    LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID
    LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID
    LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID

  WHERE
    j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

  DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
  Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

  DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
  Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

  DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
  Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

  DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
  Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE
    )
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData]

    FROM
      (
          Select 
            'Legionella' [TableName],
            NULL [TableCategoryID],
            l.LegionellaID [TableID],
            NULL [ParentID],
            l.GUID [GUID],
            l.GUIDVersion [GUIDVersion],
            l.BuildingDesignation [BuildingDesignation],
            l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
            NULL [SystemRef],
            NULL [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            Legionella l WITH (NOLOCK)
            INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
      INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
        lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
          UNION
          Select 
            'LegionellaAsset' [TableName],
            la.LegionellaAssetCategoryID [TableCategoryID],
            la.LegionellaAssetID [TableID],
            ld.LegionellaID [ParentID],
            la.GUID [GUID],
            la.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            la.SystemRef [SystemRef],
            la.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
          FROM 
            LegionellaAsset la WITH (NOLOCK)
            INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
            INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID                              
      UNION
          Select 
            'LegionellaLocation' [TableName],
            NULL [TableCategoryID],
            ll.LegionellaLocationID [TableID],
            ld.LegionellaID [ParentID],
            ll.GUID [GUID],
            ll.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            NULL [SystemRef],
            ll.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaLocation ll WITH (NOLOCK)
            INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
            INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
          UNION
          Select 
            'LegionellaOutlet' [TableName],
            lo.LegionellaOutletCategoryID [TableCategoryID],
            lo.LegionellaOutletID [TableID],
            lld.LegionellaLocationID [ParentID],
            lo.GUID [GUID],
            lo.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            lo.SystemRef [SystemRef],
            NULL [Location],
            lo.SourceCold [SourceCold],
            lo.SourceHot [SourceHot],
            lo.SourceMains [SourceMains],
            lo.SourceMixed [SourceMixed],
            lo.SentinelCold [SentinelCold],
            lo.SentinelHot [SentinelHot],
            lo.SentinelMains [SentinelMains],
            lo.SentinelMixed [SentinelMixed],
            lo.EnabledCold [EnabledCold],
            lo.EnabledHot [EnabledHot],
            lo.EnabledMains [EnabledMains],
            lo.EnabledMixed [EnabledMixed],
            lo.LowUseCold [LowUseCold],
      lo.LowUseHot [LowUseHot],
      lo.LowUseMains [LowUseMains],
      lo.LowUseMixed [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

  Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
  Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
  FROM
  (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
  ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END
  
  -- Add row in for latest floorplan image
  If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    SELECT
      'Legionella_Floorplan' [TableName],
      NULL [TableCategoryID],
      NULL [TableID],
      NULL [ParentID],
      NULL [GUID],
      NULL [GUIDVersion],
      NULL [BuildingDesignation],
      NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
      NULL [SystemRef],
      NULL [Location],
      NULL [SourceCold],
      NULL [SourceHot],
      NULL [SourceMains],
      NULL [SourceMixed],
      NULL [SentinelCold],
      NULL [SentinelHot],
      NULL [SentinelMains],
      NULL [SentinelMixed],
      NULL [EnabledCold],
      NULL [EnabledHot],
      NULL [EnabledMains],
      NULL [EnabledMixed],
      NULL [LowUseCold],
      NULL [LowUseHot],
      NULL [LowUseMains],
      NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
      NULL [LegionellaTaskAutoInsertTypeID],
      NULL [LegionellaTaskNo],
      NULL [LegionellaSectionID], 
      NULL [LegionellaRiskCategoryID],
      NULL [RiskDescription],
      NULL [Action], 
      NULL [LegionellaFrequencyCategoryID],
      NULL [LegionellaRiskRatingID],
      NULL [LegionellaPriorityRatingID],
      NULL [SortOrder],
      NULL [TaskDueDate],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
    FROM 
      (
        SELECT TOP 1
          all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
        FROM
          @Legionella_Data ld 
          INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
          INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
          INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID
          INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
          INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
          INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
          INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
          INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
          INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
          INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
        WHERE
          CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
        ORDER BY
          all_l.LegionellaFinish DESC
      ) ld
      INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
  END

    Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID
  
  SET NOCOUNT OFF;
END


GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.53_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.53_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.53_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;
    
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

  --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

  DECLARE @LegionellaGUIDED TABLE
  (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
  )

  --SELECT @RestrictedLegionellaAssetCategoryID
    
  INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
  Select 
    l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
    la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
    ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
    lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
  FROM
    Job j WITH (NOLOCK)
      
    INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
    INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
    INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
    INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
    INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
    LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID
    LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID
    LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID

  WHERE
    j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

  DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
  Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

  DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
  Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

  DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
  Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

  DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
  Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE
    )
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData]

    FROM
      (
          Select 
            'Legionella' [TableName],
            NULL [TableCategoryID],
            l.LegionellaID [TableID],
            NULL [ParentID],
            l.GUID [GUID],
            l.GUIDVersion [GUIDVersion],
            l.BuildingDesignation [BuildingDesignation],
            l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
            NULL [SystemRef],
            NULL [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            Legionella l WITH (NOLOCK)
            INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
      INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
        lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
          UNION
          Select 
            'LegionellaAsset' [TableName],
            la.LegionellaAssetCategoryID [TableCategoryID],
            la.LegionellaAssetID [TableID],
            ld.LegionellaID [ParentID],
            la.GUID [GUID],
            la.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            la.SystemRef [SystemRef],
            la.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
          FROM 
            LegionellaAsset la WITH (NOLOCK)
            INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
            INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID                              
      UNION
          Select 
            'LegionellaLocation' [TableName],
            NULL [TableCategoryID],
            ll.LegionellaLocationID [TableID],
            ld.LegionellaID [ParentID],
            ll.GUID [GUID],
            ll.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            NULL [SystemRef],
            ll.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaLocation ll WITH (NOLOCK)
            INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
            INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
          UNION
          Select 
            'LegionellaOutlet' [TableName],
            lo.LegionellaOutletCategoryID [TableCategoryID],
            lo.LegionellaOutletID [TableID],
            lld.LegionellaLocationID [ParentID],
            lo.GUID [GUID],
            lo.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            lo.SystemRef [SystemRef],
            NULL [Location],
            lo.SourceCold [SourceCold],
            lo.SourceHot [SourceHot],
            lo.SourceMains [SourceMains],
            lo.SourceMixed [SourceMixed],
            lo.SentinelCold [SentinelCold],
            lo.SentinelHot [SentinelHot],
            lo.SentinelMains [SentinelMains],
            lo.SentinelMixed [SentinelMixed],
            lo.EnabledCold [EnabledCold],
            lo.EnabledHot [EnabledHot],
            lo.EnabledMains [EnabledMains],
            lo.EnabledMixed [EnabledMixed],
            lo.LowUseCold [LowUseCold],
      lo.LowUseHot [LowUseHot],
      lo.LowUseMains [LowUseMains],
      lo.LowUseMixed [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

  Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
  Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
  FROM
  (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
  ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END
  
  -- Add row in for latest floorplan image
  If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    SELECT
      'Legionella_Floorplan' [TableName],
      NULL [TableCategoryID],
      NULL [TableID],
      NULL [ParentID],
      NULL [GUID],
      NULL [GUIDVersion],
      NULL [BuildingDesignation],
      NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
      NULL [SystemRef],
      NULL [Location],
      NULL [SourceCold],
      NULL [SourceHot],
      NULL [SourceMains],
      NULL [SourceMixed],
      NULL [SentinelCold],
      NULL [SentinelHot],
      NULL [SentinelMains],
      NULL [SentinelMixed],
      NULL [EnabledCold],
      NULL [EnabledHot],
      NULL [EnabledMains],
      NULL [EnabledMixed],
      NULL [LowUseCold],
      NULL [LowUseHot],
      NULL [LowUseMains],
      NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
      NULL [LegionellaTaskAutoInsertTypeID],
      NULL [LegionellaTaskNo],
      NULL [LegionellaSectionID], 
      NULL [LegionellaRiskCategoryID],
      NULL [RiskDescription],
      NULL [Action], 
      NULL [LegionellaFrequencyCategoryID],
      NULL [LegionellaRiskRatingID],
      NULL [LegionellaPriorityRatingID],
      NULL [SortOrder],
      NULL [TaskDueDate],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
    FROM 
      (
        SELECT TOP 1
          all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
        FROM
          @Legionella_Data ld 
          INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
          INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
          INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID AND j.Approved IS NOT NULL
          INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
          INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
          INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
          INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
          INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
          INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
          INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
        WHERE
          CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
        ORDER BY
          all_l.LegionellaFinish DESC
      ) ld
      INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
  END

    Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID
  
  SET NOCOUNT OFF;
END

GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.71_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.71_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Surveying_v2.4.2.71_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select 'AppointmentAirMonitoring' AS [TableName], aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringType' AS [TableName], aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringSampleClassification' AS [TableName], aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable

  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )  
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID UNION SELECT [RemovalContractorID|INTEGER|NOTNULL||] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL||]
      ) jqa ON c.ClientID=jqa.ClientID      
      
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM StandardPhraseCategoryClient WHERE ClientID IS NOT NULL GROUP BY ClientID 
      ) spcc ON c.ClientID=spcc.ClientID      

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]
  --------------------------------------------------------
  

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]
  , dbo.get_SiteHighestRegisterItemNo([SiteID|INTEGER|NOTNULL||SERVERKEY]) [SiteHighestRegisterItemNo|VARCHAR|INT||] 
  FROM @SiteTable
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID WHERE ae.EmployeeID=@EmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,  [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select 'Job' AS [TableName], j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable
  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select 'QuoteVisit' AS [TableName], qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


  SET NOCOUNT OFF;
END


GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
      
  UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
  --[mobile__HighestJobNo] is an exception from structure!
  --DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
  --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
  --SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
  IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
    DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [TableName], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT 'Config' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
    DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
    DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
    DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
    DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
  END

  -- This is where the StartTableNumber check has to check the lower limit as well

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
    DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
    DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
  DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
  DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
  DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
  DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
  DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
  DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
  DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
  DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
  DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
  -- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
  DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, 
    [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
    [RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
    [Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
    [IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
    [BranchOfficeID|INTEGER|NULL||] INTEGER NULL
  )

  INSERT INTO @EquipmentTable (
    [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||]
  )      
  SELECT 
    'Equipment' AS [TableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
    e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
  FROM 
    Equipment e 
    LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
    LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
  WHERE 
    e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
  GROUP BY 
    e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

  SELECT 
    'Equipment' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||] 
  FROM 
    @EquipmentTable
  -------------------------------------------------------------------------------------------------------------
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
  DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
  DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
  DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
  DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
  DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
  DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
  DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
  DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
  DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
  DECLARE @QuoteVisitTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'QuoteVisitType' AS [SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT 'QuoteVisitType' AS [SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
  DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
  DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
  DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
  DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
  DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
  DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID],[TableName],[TableCode] FROM TableCode      SELECT 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
  DECLARE @TemplateTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select 'TemplateType' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT 'TemplateType' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
  DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
  DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
  DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
  DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
  DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
  DECLARE @AirTestDataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select 'AirTestDataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT 'AirTestDataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
  DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'AirTestDataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT 'AirTestDataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 38 AND @StartTableNumber <= 42) BEGIN
  DECLARE @AirTestDataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT 'AirTestDataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 39 AND @StartTableNumber <= 43) BEGIN
  DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 40 AND @StartTableNumber <= 44) BEGIN
  DECLARE @AirTestTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select 'AirTestType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT 'AirTestType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 41 AND @StartTableNumber <= 45) BEGIN
  DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 42 AND @StartTableNumber <= 46) BEGIN
  DECLARE @ResultTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select 'ResultType' AS [SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT 'ResultType' AS [SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 43 AND @StartTableNumber <= 47) BEGIN
  DECLARE @MobileURLFileTransferTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'MobileURLFileTransfer' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT 'MobileURLFileTransfer' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 44 AND @StartTableNumber <= 48) BEGIN
  DECLARE @ReportFooterTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select 'ReportFooter' AS [SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT 'ReportFooter' AS [SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 45 AND @StartTableNumber <= 49) BEGIN
  DECLARE @RowTemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select 'RowTemplate' AS [SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT 'RowTemplate' AS [SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 46 AND @StartTableNumber <= 50) BEGIN
  DECLARE @StandardProcedureTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 47 AND @StartTableNumber <= 51) BEGIN
  DECLARE @StandardProcedureTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 48 AND @StartTableNumber <= 52) BEGIN
  DECLARE @TemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT 'Template' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT 'Template' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 49 AND @StartTableNumber <= 53) BEGIN
  DECLARE @TemplatePageLayoutTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select 'TemplatePageLayout' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT 'TemplatePageLayout' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 50 AND @StartTableNumber <= 54) BEGIN
  DECLARE @EmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @EmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])  Select 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee SELECT 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable
  END

  SET NOCOUNT OFF;
END
GO



IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.72_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.72_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_Airtest_v1.0.0.72_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select 'AppointmentAirMonitoring' AS [TableName], aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable 
  
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
          UNION
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - JSM: This needs to be after the client  
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringType' AS [TableName], aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable 
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringSampleClassification' AS [TableName], aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable 
  --------------------------------------------------------


  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable 
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,  [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX), [RemovalContracterID|INTEGER|NULL|Client|] INT NULL ) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|], [SiteAlert|VARCHAR|NULL||] ) Select 'Job' AS [TableName], j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), (
         SELECT
            top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] 
         FROM
            @JobQuoteAppointmentIDList jqal 
            INNER JOIN
               @AppointmentAirMonitoringTable aam 
               ON jqal.AppointmentID = aam.[AppointmentID|INTEGER|NOTNULL||]
         WHERE
            jqal.JobID = j.JobID
      ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select 'QuoteVisit' AS [TableName], qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 

  DECLARE @NoAccessTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([SQLTableName|NVARCHAR|NOTNULL||], [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT 'NoAccess' AS [TableName], na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 


  SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.72_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.72_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Airtest_v1.0.0.72_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0,
    @DeviceGuid uniqueidentifier,
    @App VARCHAR(50),
    @Platform VARCHAR(50),
    @DbSizeMb INT,
    @DtsGuid uniqueidentifier = NULL
)
AS
BEGIN
      SET NOCOUNT ON;
      
    SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 3,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Airtest_v1.0.0.72_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
      DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [SQLTableName],[ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable 
      DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName],[AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
      DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName],[AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
      DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName],[BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable 
      DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName],[CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable 
      DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName],[CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable 
      DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName],[CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     Select [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable 
      DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName],[ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable 
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName],[ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable 
      DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' as [SQLTableName], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable 
      DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName],[DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable 
      DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName],[DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName],[DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable 
      DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName],[ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable 
      DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName],[ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable 
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName],[ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable 
      DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select 'Equipment' AS [SQLTableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     Select [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable 

      DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName],[EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable 
      DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName],[EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable 
      DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName],[EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable 
      DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName],[IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      Select [SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable 
      DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' as [SQLTableName], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
      DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName],[InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable 
      DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName],[InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable 
      DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName],[InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable 
      DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName],[MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
      DECLARE @QuoteVisitTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'QuoteVisitType' AS [SQLTableName],[QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable 
      DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName],[RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
      DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName],[SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable 
      DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName],[SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable 
      DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName],[SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      Select [SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable 
      DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName],[SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      Select [SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
      DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName],[TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable 
      DECLARE @TemplateTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select 'TemplateType' AS [SQLTableName],[TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      Select [SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable 
      DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName],[StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable 
      DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName],[StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable 
      DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName],[StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable 
      DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName],[StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable 
      DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName],[StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable 

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select 'AirTestDataCollectionCategory' AS [SQLTableName],[AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable 
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select 'AirTestDataCollectionCategoryType' AS [SQLTableName],[AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable 
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT 'AirTestDataCollectionQuestion' AS [SQLTableName],[AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable 
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName],[AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable 
      DECLARE @AirTestTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select 'AirTestType' AS [SQLTableName],[AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL AND (AirTestTypeID > 200 OR AirTestTypeID=2 OR AirTestTypeID=100)  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable 
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName],[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
      DECLARE @ResultTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select 'ResultType' AS [SQLTableName],[ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable 

      DECLARE @MobileURLFileTransferTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'MobileURLFileTransfer' AS [SQLTableName],[MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  
      DECLARE @ReportFooterTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([SQLTableName|NVARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select 'ReportFooter' AS [SQLTableName],[ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      Select [SQLTableName|NVARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable 
      DECLARE @RowTemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([SQLTableName|NVARCHAR|NOTNULL||],[RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select 'RowTemplate' AS [SQLTableName],[RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable 
      DECLARE @StandardProcedureTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedure' AS [SQLTableName],[StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable 
      DECLARE @StandardProcedureTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedureType' AS [SQLTableName],[StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable 
      DECLARE @TemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT 'Template' AS [SQLTableName],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable 
      DECLARE @TemplatePageLayoutTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select 'TemplatePageLayout' AS [SQLTableName],[TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      Select [SQLTableName|NVARCHAR|NOTNULL||],[TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable 

      SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.64_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Quote q
    INNER JOIN Site si ON q.SiteID = si.SiteID
    INNER JOIN Client c ON c.ClientID = q.ClientID
    INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentLegionellaTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentLegionellaTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select 'AppointmentLegionella' AS [TableName], al.[AppointmentLegionellaID],al.[AppointmentID],al.LegionellaTypeID,al.DueDate FROM AppointmentLegionella al WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentLegionellaTable 
  
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable 
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select 'Job' AS [TableName], j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ) 
  
  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||]) 
    Select 'QuoteVisit' AS [TableName],  
      qv.[QuoteVisitID],
      qv.[QuoteVisitTypeID],
      qv.[QuoteEmployeeID],
      qv.[QuoteVisitStart],
      qv.[QuoteVisitFinish],
      qv.[Notes],
      qv.[PhotoID],
      qv.[SystemName],
      qv.[Closed],
      qv.[Finished],
      qv.[SignatureID],
      qv.[_QuoteVisitConsumableMarkup],
      qv.[_QuoteVisitEquipmentMarkup],
      qv.[_QuoteVisitLabourMarkup] 
    FROM 
      QuoteVisit qv 
      INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID 
      
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  --------------------------------------------------------

  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 
  DECLARE @NoAccessTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) Select 'NoAccess' AS [TableName], na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 
  
  SET NOCOUNT OFF;
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData_Surveying_v2.4.2.81')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData_Surveying_v2.4.2.81] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[EnterpriseSiteData_Surveying_v2.4.2.81]
(
      @ClientID INT,
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
      @IncludePhotoNoColumn BIT = 0,
      @JobReinspectionStructureID INT = 0,
      @FilterToJobID INT = 0,
	  @IncludeTableResponse VARCHAR(MAX) = 'Register,Floorplan,Room,Sample,Element,BuildingComponent,JobLink'
)
AS
BEGIN
	SET NOCOUNT ON;
                   
	If @RequestingServerCode != (SELECT s__ServerCode FROM Config) BEGIN
		SET @FilterToJobID = 0
	END

	IF @FilterToJobID > 0 BEGIN
	SET @JobReinspectionStructureID = (SELECT ISNULL((SELECT TOP 1 JobReinspectionStructureID FROM JobReinspectionStructure WHERE JobID=@FilterToJobID AND NoDataRequired=0),0))
		IF @JobReinspectionStructureID = 0 BEGIN
			SET @FilterToJobID = 0
		END
	END

    DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
                
    DECLARE @IDList TABLE (JobID INT, JobNo VARCHAR(MAX), UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
    Insert into @IDList (JobID,JobNo,UseRoomCode,RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
    SELECT 
		j.JobID, TEAMS.dbo.FormatTeamsReference('J',j.JobNo),
		CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
		r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
		fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
		rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
		s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
    FROM 
        (
			SELECT 
				j.JobID, j.JobNo, j.SiteID
			FROM
				Job j WITH (NOLOCK)
				INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
				INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
			WHERE
				j.SiteID = @SiteID
					AND
				j.ClientID = @ClientID
					AND
				a.DateDeclined IS NULL
					AND
				j.Approved IS NOT NULL
        ) j
        INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
        INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
        LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
        LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
        LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
        LEFT OUTER JOIN Element e2 WITH (NOLOCK) ON s.SampleID = e2.SampleID AND e2.ElementTypeID = 2
        LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON 
            (
                CASE WHEN s.SampleID IS NOT NULL AND jrsd.SampleID IS NOT NULL THEN
                    CASE WHEN jrsd.SampleID=s.SampleID THEN 1 ELSE 0 END
                ELSE
                    CASE WHEN rm.RoomID IS NOT NULL AND jrsd.RoomID IS NOT NULL THEN
		                CASE WHEN jrsd.RoomID=rm.RoomID THEN 1 ELSE 0 END
                    ELSE
                        CASE WHEN fp.FloorplanID IS NOT NULL AND jrsd.FloorplanID IS NOT NULL THEN
                            CASE WHEN jrsd.FloorplanID=fp.FloorplanID THEN 1 ELSE 0 END
                        ELSE
                            CASE WHEN jrsd.RegisterID=r.RegisterID THEN 1 ELSE 0 END
                        END
                    END
                END = 1
            )
                AND 
			jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
    WHERE 
        CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
            AND
        (CASE WHEN s.SampleID IS NOT NULL AND e2.ElementID IS NULL THEN 0 ELSE 1 END=1)

	IF @IncludeTableResponse LIKE '%Register%' BEGIN
		SELECT
			main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, NULL [PhotoData], p.ContentType,
			r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode,
			main.Included, NULL [AssociatedJobNoList], 1 [GetBlobData]
		FROM
			(
				Select
					'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode,
					CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
							MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
						FROM
							@IDList idl
						GROUP BY
							RegisterID,BuildingGUID,BuildingGUIDVersion
					) _r
					LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RegisterID=_r.RegisterID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
				WHERE
					_r.Identifier = 1
				GROUP BY
					_r.RegisterID, BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode, CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
			) main
			INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
			LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
		WHERE
			r.[GUID] IS NOT NULL AND r.[GUIDVersion] IS NOT NULL
	END

	IF @IncludeTableResponse LIKE '%Floorplan%' BEGIN
		SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
			main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
			CASE WHEN fp.FloorNumber = -200 THEN -2 ELSE fp.FloorNumber END [FloorNumber], 
			NULL [FloorplanData],
			CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType],
			main.Included, NULL [AssociatedJobNoList], 1 [GetBlobData]
		FROM
			(      
				Select
					'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,
					CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
							id.FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
						FROM
							@IDList id											
						GROUP BY
							id.FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
					) _f
					LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.FloorplanID=_f.FloorplanID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
				WHERE
					_f.Identifier = 1
									AND
					CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
				GROUP BY
					_f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion,CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
			) main
			INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
		WHERE
			fp.[GUID] IS NOT NULL AND fp.[GUIDVersion] IS NOT NULL
	END

	IF @IncludeTableResponse LIKE '%Room%' BEGIN    
		SELECT
			main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
			rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode,
			CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included],
			rm.RoomGroupID [ServerRoomGroupID], rm.ParentGroupID [ServerParentGroupID], NULL [AssociatedJobNoList]
		FROM
			(
				Select
					'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
				FROM
					(
						SELECT
							ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
							RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
						FROM
							@IDList id
						GROUP BY
							RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
					) _rm
				WHERE
					_rm.Identifier = 1
			) main
			INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
			LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.RoomID=rm.RoomID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
		WHERE
			CASE WHEN @FilterToJobID > 0 THEN 
				CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 
			END = 1
				AND
			rm.[GUID] IS NOT NULL AND rm.[GUIDVersion] IS NOT NULL
		GROUP BY
			main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode, rm.RoomGroupID, rm.ParentGroupID,
			CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END
    END
	 
    DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT, Included INT, AssociatedJobNoList VARCHAR(MAX))
       
    INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion,Included,AssociatedJobNoList)
    SELECT
		main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion, main.Included,  NULL [AssociatedJobNoList]
    FROM
        (      
			Select
				'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion,
				CASE WHEN jrsd.JobReinspectionStructureID IS NOT NULL THEN 1 ELSE 0 END [Included]
			FROM
				(
					SELECT
						ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
					FROM
						@IDList id
					GROUP BY
						SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
				) _s
				LEFT OUTER JOIN JobReinspectionStructureData jrsd WITH (NOLOCK) ON jrsd.SampleID=_s.SampleID AND jrsd.JobReinspectionStructureID=@JobReinspectionStructureID
			WHERE
				_s.Identifier = 1
					AND
				CASE WHEN @FilterToJobID > 0 THEN CASE WHEN jrsd.JobReinspectionStructureDataID IS NOT NULL THEN 1 ELSE 0 END ELSE 1 END = 1
        ) main
        INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
        INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID AND gs.ClientID=@ClientID
    WHERE
        s.[GUID] IS NOT NULL AND s.[GUIDVersion] IS NOT NULL
    GROUP BY
        main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion, main.Included

	CREATE TABLE #PhotoDataFromStore  (PhotoID INT, PhotoData IMAGE, TEAMS_StoreID INT, DataTaken INT)
	INSERT INTO #PhotoDataFromStore  (PhotoID,TEAMS_StoreID,DataTaken)
	SELECT
		p.PhotoID, p.TEAMS_StoreID, 0
	FROM
		@GuidSamples main
		INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
		INNER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
	WHERE
		p.TEAMS_StoreID IS NOT NULL
	GROUP BY 
		p.PhotoID, p.TEAMS_StoreID
	
	IF (SELECT COUNT(*) FROM #PhotoDataFromStore ) > 0 BEGIN
		DECLARE @curTEAMS_StoreID INT=0
		DECLARE storeData CURSOR FOR
		SELECT 
			pdfsCur.TEAMS_StoreID
		FROM 
			#PhotoDataFromStore  pdfsCur 
		GROUP BY
			pdfsCur.TEAMS_StoreID
		
		OPEN storeData
		FETCH NEXT FROM storeData INTO @curTEAMS_StoreID
		WHILE @@FETCH_STATUS = 0 BEGIN
			DECLARE @DynamicSQL NVARCHAR(MAX) = 'SELECT p.PhotoID,p.PhotoData,pdfs.TEAMS_StoreID,1 FROM TEAMS_Store' + CAST(@curTEAMS_StoreID as varchar(MAX)) + '.dbo.Photo p INNER JOIN #PhotoDataFromStore pdfs ON p.PhotoID=pdfs.PhotoID WHERE pdfs.TEAMS_StoreID=' + CAST(@curTEAMS_StoreID as varchar(MAX))
			INSERT INTO #PhotoDataFromStore (PhotoID,PhotoData,TEAMS_StoreID,DataTaken)
			EXEC sp_executesql @DynamicSQL
			FETCH NEXT FROM storeData INTO @curTEAMS_StoreID
		END
		CLOSE storeData
		DEALLOCATE storeData
	END

	IF @IncludeTableResponse LIKE '%Sample%' BEGIN
		SELECT
			main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
			s.RegisterItemNo,p.PhotoID, NULL [PhotoData], 
			p.PhotoNo, REPLACE(REPLACE(REPLACE(s.SampleRef,'****','*'),'***','*'),'**','*') [SampleRef], s.AsSample,  
			s.SampleResultID, s.SampleClassificationID, 
			sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
			s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee], main.Included, main.AssociatedJobNoList [AssociatedJobNoList],
			1 [GetBlobData]
		FROM
			@GuidSamples main
			INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
			LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
			LEFT OUTER JOIN #PhotoDataFromStore pdfs ON s.PhotoID=pdfs.PhotoID AND pdfs.DataTaken = 1
			LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
			LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
	END

	IF @IncludeTableResponse LIKE '%Element%' BEGIN
		SELECT
			main.TableName,
			main.SampleID,
			main.RegisterID,
			main.ElementTypeID,
			main.ElementText
		FROM
		(
			SELECT
				'Element' [TableName],
				e.SampleID, 
				NULL [RegisterID],
				e.ElementTypeID,
				CASE WHEN e.ElementText IS NOT NULL THEN
					e.ElementText
				ELSE
					CASE WHEN e.ElementTypeID = 20 THEN
							ISNULL(eime.Description,ISNULL(eim.ShortDescription,eim.Description))
					ELSE
							CASE WHEN e.ElementTypeID = 32 THEN
									CAST(e.ElementIntID as varchar)
							ELSE
									ISNULL(ISNULL(eime.Description,eimso.Description),eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
							END
					END
				END [ElementText]
			FROM
				@GuidSamples main
				INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
				LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
				LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
				LEFT OUTER JOIN ElementIntMeaningSubOption eimso WITH (NOLOCK) ON eimso.ElementIntMeaningSubOptionID=e.ElementIntMeaningSubOptionID
			WHERE
				e.ElementTypeID NOT IN (32)
			UNION
			SELECT
				'Element' [TableName],
				NULL [SampleID], 
				e.RegisterID [RegisterID],
				e.ElementTypeID,
				CASE WHEN e.ElementText IS NOT NULL THEN
					e.ElementText
				ELSE
					CASE WHEN e.ElementTypeID = 20 THEN
							ISNULL(eime.Description,ISNULL(eim.ShortDescription,eim.Description))
					ELSE
							CASE WHEN e.ElementTypeID = 32 THEN
									CAST(e.ElementIntID as varchar)
							ELSE
									ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
							END
					END
				END [ElementText]
			FROM
				(
					Select
							_r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
					FROM
					(
							SELECT
									ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
									MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
							FROM
									@IDList
							GROUP BY
									RegisterID,BuildingGUID,BuildingGUIDVersion
					) _r
					WHERE
							_r.Identifier = 1
				) main
				INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
				INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
				LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
				LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
			WHERE
				CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
					1 
				ELSE
					CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
				END = 1
		) main
	END
   
   IF @IncludeTableResponse LIKE '%BuildingComponent%' BEGIN
		SELECT
			main.TableName,
			main.RoomID,
			main.ItemNo,
			main.[Description],
			main.[Position],
			main.[Comments]
		FROM
			(
				SELECT
					'BuildingComponent' [TableName],
					main.RoomID,
					bc.ItemNo,
					bc.[Description],
					bc.[Position],
					bc.[Comments]
				FROM
					(
						Select
							'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
						FROM
							(
								SELECT
									ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
									RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
								FROM
									@IDList
								GROUP BY
									RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
							) _rm
						WHERE
							_rm.Identifier = 1
					) main
					INNER JOIN BuildingComponent bc WITH (NOLOCK) ON main.RoomID=bc.RoomID
			) main
    END

	IF @IncludeTableResponse LIKE '%JobLink%' BEGIN
		SELECT
			'Ignore' [TableName], 
			id.JobNo, 
			id.SampleID, 
			id.ItemGUID,
			id.ItemGUIDVersion 
			--id.*
		FROM 
			@IDList id
		WHERE
			id.SampleID IS NOT NULL
				AND
			id.ItemGUID IS NOT NULL
		GROUP BY
			id.JobNo,
			id.SampleId,
			id.ItemGUID,
			id.ItemGUIDVersion
	END
	SET NOCOUNT OFF;

END
GO



IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'EnterpriseSiteData_Surveying_v2.4.2.81_GetBlobData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[EnterpriseSiteData_Surveying_v2.4.2.81_GetBlobData] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[EnterpriseSiteData_Surveying_v2.4.2.81_GetBlobData]
(
      @BlobID INT,
      @IsPhoto BIT = 0,
	  @IsFloorplan BIT = 0
)
AS
BEGIN
	SET NOCOUNT ON;

	DECLARE @curTEAMS_StoreID INT = 0
	DECLARE @DynamicSQL NVARCHAR(MAX)

	IF @IsPhoto > 0 BEGIN
		
		
		Select @curTEAMS_StoreID = TEAMS_StoreID FROM Photo WHERE PhotoID=@BlobID
		
		IF @curTEAMS_StoreID > 0 BEGIN
			SET @DynamicSQL = 'SELECT p.PhotoData FROM TEAMS_Store' + CAST(@curTEAMS_StoreID as varchar(MAX)) + '.dbo.Photo p WHERE p.PhotoID=' + CAST(@BlobID as varchar(MAX)) + ' AND p.TEAMS_StoreID=' + CAST(@curTEAMS_StoreID as varchar(MAX))
			EXEC sp_executesql @DynamicSQL
		END

		IF NULLIF(@curTEAMS_StoreID,0) IS NULL BEGIN
			SELECT PhotoData FROM Photo WHERE PhotoID = @BlobID
		END

	END

	IF @IsFloorplan > 0 BEGIN
		
		Select @curTEAMS_StoreID = TEAMS_StoreID FROM Floorplan WHERE FloorplanID=@BlobID
		
		IF @curTEAMS_StoreID > 0 BEGIN
			SET @DynamicSQL = 'SELECT CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE ''%pdf%'') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData] FROM TEAMS_Store' + CAST(@curTEAMS_StoreID as varchar(MAX)) + '.dbo.Floorplan fp WHERE fp.FloorplanID=' + CAST(@BlobID as varchar(MAX)) + ' AND fp.TEAMS_StoreID=' + CAST(@curTEAMS_StoreID as varchar(MAX))
			EXEC sp_executesql @DynamicSQL
		END

		IF NULLIF(@curTEAMS_StoreID,0) IS NULL BEGIN
			SELECT CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData] FROM Floorplan fp WHERE FloorplanID = @BlobID
		END
	END

	SET NOCOUNT OFF;

END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.64_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;
    
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

  --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

  DECLARE @LegionellaGUIDED TABLE
  (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
  )

  --SELECT @RestrictedLegionellaAssetCategoryID
    
  INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
  Select 
    l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
    la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
    ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
    lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
  FROM
    Job j WITH (NOLOCK)
      
    INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
    INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
    INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
    INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
    INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
    LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID AND la.DateRemoved IS NULL
    LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID AND ll.DateRemoved IS NULL
    LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID AND lo.DateRemoved IS NULL

  WHERE
    j.ClientID=@ClientID AND j.SiteID=@SiteID AND j.Approved IS NOT NULL

  DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
  Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

  DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
  Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

  DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
  Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

  DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
  Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE
    )
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData]

    FROM
      (
          Select 
            'Legionella' [TableName],
            NULL [TableCategoryID],
            l.LegionellaID [TableID],
            NULL [ParentID],
            l.GUID [GUID],
            l.GUIDVersion [GUIDVersion],
            l.BuildingDesignation [BuildingDesignation],
            l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
            NULL [SystemRef],
            NULL [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            Legionella l WITH (NOLOCK)
            INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
      INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
        lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
          UNION
          Select 
            'LegionellaAsset' [TableName],
            la.LegionellaAssetCategoryID [TableCategoryID],
            la.LegionellaAssetID [TableID],
            ld.LegionellaID [ParentID],
            la.GUID [GUID],
            la.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            la.SystemRef [SystemRef],
            la.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
          FROM 
            LegionellaAsset la WITH (NOLOCK)
            INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
            INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID                              
      UNION
          Select 
            'LegionellaLocation' [TableName],
            NULL [TableCategoryID],
            ll.LegionellaLocationID [TableID],
            ld.LegionellaID [ParentID],
            ll.GUID [GUID],
            ll.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
        NULL [AreasNotAccessed],
        NULL [Notes],
            NULL [SystemRef],
            ll.Location [Location],
            NULL [SourceCold],
            NULL [SourceHot],
            NULL [SourceMains],
            NULL [SourceMixed],
            NULL [SentinelCold],
            NULL [SentinelHot],
            NULL [SentinelMains],
            NULL [SentinelMixed],
            NULL [EnabledCold],
            NULL [EnabledHot],
            NULL [EnabledMains],
            NULL [EnabledMixed],
            NULL [LowUseCold],
            NULL [LowUseHot],
            NULL [LowUseMains],
            NULL [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
          FROM 
            LegionellaLocation ll WITH (NOLOCK)
            INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
            INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
          UNION
          Select 
            'LegionellaOutlet' [TableName],
            lo.LegionellaOutletCategoryID [TableCategoryID],
            lo.LegionellaOutletID [TableID],
            lld.LegionellaLocationID [ParentID],
            lo.GUID [GUID],
            lo.GUIDVersion [GUIDVersion],
            NULL [BuildingDesignation],
            NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
            lo.SystemRef [SystemRef],
            NULL [Location],
            lo.SourceCold [SourceCold],
            lo.SourceHot [SourceHot],
            lo.SourceMains [SourceMains],
            lo.SourceMixed [SourceMixed],
            lo.SentinelCold [SentinelCold],
            lo.SentinelHot [SentinelHot],
            lo.SentinelMains [SentinelMains],
            lo.SentinelMixed [SentinelMixed],
            lo.EnabledCold [EnabledCold],
            lo.EnabledHot [EnabledHot],
            lo.EnabledMains [EnabledMains],
            lo.EnabledMixed [EnabledMixed],
            lo.LowUseCold [LowUseCold],
        lo.LowUseHot [LowUseHot],
        lo.LowUseMains [LowUseMains],
        lo.LowUseMixed [LowUseMixed],
            NULL [LegionellaTaskAutoInsertID],
            NULL [LegionellaTaskAutoInsertTypeID],
            NULL [LegionellaTaskNo],
            NULL [LegionellaSectionID], 
            NULL [LegionellaRiskCategoryID],
            NULL [RiskDescription],
            NULL [Action], 
            NULL [LegionellaFrequencyCategoryID],
            NULL [LegionellaRiskRatingID],
            NULL [LegionellaPriorityRatingID],
            NULL [SortOrder],
        NULL [TaskDueDate],
        NULL [PhotoID]
          FROM 
            LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

  Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
  Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
  FROM
  (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
  ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END
  
  -- Add row in for latest floorplan image
  If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    SELECT
      'Legionella_Floorplan' [TableName],
      NULL [TableCategoryID],
      NULL [TableID],
      NULL [ParentID],
      NULL [GUID],
      NULL [GUIDVersion],
      NULL [BuildingDesignation],
      NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
      NULL [SystemRef],
      NULL [Location],
      NULL [SourceCold],
      NULL [SourceHot],
      NULL [SourceMains],
      NULL [SourceMixed],
      NULL [SentinelCold],
      NULL [SentinelHot],
      NULL [SentinelMains],
      NULL [SentinelMixed],
      NULL [EnabledCold],
      NULL [EnabledHot],
      NULL [EnabledMains],
      NULL [EnabledMixed],
      NULL [LowUseCold],
      NULL [LowUseHot],
      NULL [LowUseMains],
      NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
      NULL [LegionellaTaskAutoInsertTypeID],
      NULL [LegionellaTaskNo],
      NULL [LegionellaSectionID], 
      NULL [LegionellaRiskCategoryID],
      NULL [RiskDescription],
      NULL [Action], 
      NULL [LegionellaFrequencyCategoryID],
      NULL [LegionellaRiskRatingID],
      NULL [LegionellaPriorityRatingID],
      NULL [SortOrder],
      NULL [TaskDueDate],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
    FROM 
      (
        SELECT TOP 1
          all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
        FROM
          @Legionella_Data ld 
          INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
          INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
          INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID AND j.Approved IS NOT NULL
          INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
          INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
          INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
          INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
          INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
          INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
          INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
        WHERE
          CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
        ORDER BY
          all_l.LegionellaFinish DESC
      ) ld
      INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
  END

    Select * FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID
  
  SET NOCOUNT OFF;
END

GO




IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_CheckDeviceGuidStatus')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_CheckDeviceGuidStatus] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_v2_CheckDeviceGuidStatus]
(
  @DeviceGuid uniqueidentifier
)
AS
BEGIN
  
  SET NOCOUNT ON; 
  
  If (SELECT COUNT(*) FROM MobileGuid WHERE DeviceGuid=@DeviceGuid) > 0 BEGIN
    SELECT * FROM MobileGuid WhERE DeviceGuid=@DeviceGuid
  END
  
  SET NOCOUNT OFF;
  
END
GO

INSERT INTO LegionellaOutletCategory (LegionellaOutletcategoryID,Description,TabName,SortOrder,Deleted,DefaultOutletCode) SELECT 5,'WHB','WHB',5,'2020/07/06 17:00:00','WHB' WHERE (SELECT COUNT(*) FROM LegionellaOutletCategory WHERE LegionellaOutletCategoryID=5)=0
INSERT INTO LegionellaOutletCategory (LegionellaOutletcategoryID,Description,TabName,SortOrder,Deleted,DefaultOutletCode) SELECT 6,'Bath','Bath',6,'2020/07/06 17:00:00','BTH' WHERE (SELECT COUNT(*) FROM LegionellaOutletCategory WHERE LegionellaOutletCategoryID=6)=0
INSERT INTO LegionellaOutletCategory (LegionellaOutletcategoryID,Description,TabName,SortOrder,Deleted,DefaultOutletCode) SELECT 7,'Sink','Sink',7,'2020/07/06 17:00:00','SNK' WHERE (SELECT COUNT(*) FROM LegionellaOutletCategory WHERE LegionellaOutletCategoryID=7)=0
GO


IF (Select COUNT(*) FROM sys.tables Where name='LegionellaMonitoringDataCache') < 1
BEGIN
  CREATE TABLE [dbo].[LegionellaMonitoringDataCache](
	[LegionellaMonitoringDataCacheID] [int] IDENTITY(1,1) NOT NULL,
	[JobID] [int] NOT NULL,
	[DateCreated] [datetime] NOT NULL,
	[TableName] [varchar](max) NULL,
	[TableID] [int] NULL,
	[TableCategoryID] [int] NULL,
	[ParentID] [int] NULL,
	[GUID] [varchar](50) NULL,
	[GuidVersion] [int] NULL,
	[BuildingDesignation] [varchar](max) NULL,
	[GeneralDescriptionOfSite] [varchar](max) NULL,
	[AreasNotAccessed] [varchar](max) NULL,
	[Notes] [varchar](max) NULL,
	[SystemRef] [varchar](max) NULL,
	[Location] [varchar](max) NULL,
	[SourceCold] [int] NULL,
	[SourceHot] [int] NULL,
	[SourceMains] [int] NULL,
	[SourceMixed] [int] NULL,
	[SentinelCold] [int] NULL,
	[SentinelHot] [int] NULL,
	[SentinelMains] [int] NULL,
	[SentinelMixed] [int] NULL,
	[EnabledCold] [int] NULL,
	[EnabledHot] [int] NULL,
	[EnabledMains] [int] NULL,
	[EnabledMixed] [int] NULL,
	[LowUseCold] [int] NULL,
	[LowUseHot] [int] NULL,
	[LowUseMains] [int] NULL,
	[LowUseMixed] [int] NULL,
	[LegionellaTaskAutoInsertID] [int] NULL,
	[LegionellaTaskAutoInsertTypeID] [int] NULL,
	[LegionellaTaskNo] [int] NULL,
	[LegionellaSectionID] [int] NULL,
	[LegionellaRiskCategoryID] [int] NULL,
	[RiskDescription] [varchar](max) NULL,
	[Action] [varchar](max) NULL,
	[LegionellaFrequencyCategoryID] [int] NULL,
	[LegionellaRiskRatingID] [int] NULL,
	[LegionellaPriorityRatingID] [int] NULL,
	[SortOrder] [int] NULL,
	[TaskDueDate] [datetime] NULL,
	[AssetPhotoID] [int] NULL,
 CONSTRAINT [PK_LegionellaMonitoringDataCache] PRIMARY KEY CLUSTERED 
(
	[LegionellaMonitoringDataCacheID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) 

ALTER TABLE [dbo].[LegionellaMonitoringDataCache] ADD  CONSTRAINT [DF_LegionellaMonitoringDataCache_DateCreated]  DEFAULT (getdate()) FOR [DateCreated]

END
GO

IF (Select COUNT(*) FROM sys.tables Where name='LegionellaMonitoringDataCacheJob') < 1
BEGIN
  CREATE TABLE [dbo].[LegionellaMonitoringDataCacheJob](
	[LegionellaMonitoringDataCacheJobID] [int] IDENTITY(1,1) NOT NULL,
	[JobID] [int] NOT NULL
	) ON [PRIMARY]
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;

  /*
  DECLARE @CachedJobIDList VARCHAR(MAX) = '12914,11718,12210,12534,12485,12606,12627,12628,12629,12631,12635,12661,12660,12680,12633, 12680, 12687, 12704,12682,12683,12689, 8688,9693,9709,9723,9739,9751,12452,12455,12456,12459,12460,12464,12467,12619,12639,12644,
  12645,12646,12682,12683,12689,12714,12716,12717,12718,12721,12723,12724,12725,12726,12727,12728,12733,12735,12736
  ,12737,8754,12736,12742,12744,12745,12746,12747,12748,12749,12750,12751,12752,12753,12754,12755,12756,12757,12759,12760,12761,
  12762,12763,12764,12765,12766,12767,12768,12769,12772,12773,12774,12775,12777,12778,12779,12780,12782,12783,12784,12785,12786,12787,12788,12789,
  12790,12791,12792,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12804,12805,12806,12807,12808,12809,12810,12811,12812,12898,12813,12814,
  12815,12816,12817,12818,12819,12820,12821,12822,12823,12824,12825,12826,12828,12829,12830,12831,12832,12833,12834,12835,12836,12837,12838,12840,12841,12842,
  12843,12844,12845,12846,12848,12849,12850,12851,12852,12853,12854,12855,12856,12857,12858,12859,12860,12861,12862,12863,12864,12865,12866,12867,12868,12869,
  12870,12871,12872,12873,12874,12875,12876,12877,12878,12879,12880,12881,12882,12883,12884,12885,12886,12887,12888,12889,12890,12891,12892,12894,12895,12896,12897,12899,12900,12940,12900,12946,12984'
  */
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE, AssetPhotoID INT
    )

	If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) > 0 BEGIN

		Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
		SELECT 
			TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,lmdc.Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,p.PhotoData [AssetPhotoData],lmdc.AssetPhotoID
		FROM
			LegionellaMonitoringDataCache lmdc
			LEFT OUTER JOIN Photo p ON lmdc.AssetPhotoID = p.PhotoID
		WHERE
			JobID = @JobID
	END
	ELSE BEGIN

		DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

		--SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

		DECLARE @LegionellaGUIDED TABLE
		(
		LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
		LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
		LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
		LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
		LegionellaAssetPhotoData IMAGE
		)

		--SELECT @RestrictedLegionellaAssetCategoryID
    
		INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
		Select 
			l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
			la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
			ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
			lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
		FROM
			Job j WITH (NOLOCK)
      
			INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
			INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
			INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
			INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
			INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
			LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID AND la.DateRemoved IS NULL
			LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID AND ll.DateRemoved IS NULL
			LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID AND lo.DateRemoved IS NULL

			OUTER APPLY
			  (
				SELECT TOP 1
				  _lo.DateRemoved
				FROM
				  LegionellaOutlet _lo
				WHERE
				  _lo.GUID = lo.GUID
				ORDER BY
				  _lo.GUIDVersion DESC
			  ) latestOutletRemoved
			  OUTER APPLY
			  (
				SELECT TOP 1
				  _la.DateRemoved
				FROM
				  LegionellaAsset _la
				WHERE
				  _la.GUID = la.GUID
				ORDER BY
				  _la.GUIDVersion DESC
			  ) latestAssetRemoved
			  OUTER APPLY
			  (
				SELECT TOP 1
				  _ll.DateRemoved
				FROM
				  LegionellaLocation _ll
				WHERE
				  _ll.GUID = ll.GUID
				ORDER BY
				  _ll.GUIDVersion DESC
			  ) latestLocationRemoved
			  WHERE
				j.ClientID=@ClientID 
				AND 
			  j.SiteID=@SiteID 
				AND 
			  j.Approved IS NOT NULL  
				AND
			  latestOutletRemoved.DateRemoved IS NULL
				AND
			  latestLocationRemoved.DateRemoved IS NULL
				AND
			  latestAssetRemoved.DateRemoved IS NULL
			  
		DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
		Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

		DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
		Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

		DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
		Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

		DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
		Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

		Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
		Select
		  main.TableName,
		  main.TableCategoryID,
		  main.TableID,
		  main.ParentID,
		  main.GUID,
		  main.GuidVersion,
		  main.BuildingDesignation,
		  main.GeneralDescriptionOfSite,
		  main.AreasNotAccessed,
		  main.Notes,
		  main.SystemRef,
		  main.Location,
		  main.SourceCold,
		  main.SourceHot,
		  main.SourceMains,
		  main.SourceMixed,
		  main.SentinelCold,
		  main.SentinelHot,
		  main.SentinelMains,
		  main.SentinelMixed,
		  main.EnabledCold,
		  main.EnabledHot,
		  main.EnabledMains,
		  main.EnabledMixed,
		  main.LowUseCold,
		  main.LowUseHot,
		  main.LowUseMains,
		  main.LowUseMixed,
		  main.[LegionellaTaskAutoInsertID],
		  main.[LegionellaTaskAutoInsertTypeID],
		  main.[LegionellaTaskNo],
		  main.[LegionellaSectionID], 
		  main.[LegionellaRiskCategoryID],
		  main.[RiskDescription],
		  main.[Action], 
		  main.[LegionellaFrequencyCategoryID],
		  main.[LegionellaRiskRatingID],
		  main.[LegionellaPriorityRatingID],
		  main.[SortOrder],
		main.TaskDueDate [TaskDueDate],
		p.PhotoData [AssetPhotoData],
		p.PhotoID [AssetPhotoID]
		FROM
		  (
			  Select 
				'Legionella' [TableName],
				NULL [TableCategoryID],
				l.LegionellaID [TableID],
				NULL [ParentID],
				l.GUID [GUID],
				l.GUIDVersion [GUIDVersion],
				l.BuildingDesignation [BuildingDesignation],
				l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
		  l.AreasNotAccessed [AreasNotAccessed],
		  l.Notes [Notes],
				NULL [SystemRef],
				NULL [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				NULL [LegionellaTaskAutoInsertID],
				NULL [LegionellaTaskAutoInsertTypeID],
				NULL [LegionellaTaskNo],
				NULL [LegionellaSectionID], 
				NULL [LegionellaRiskCategoryID],
				NULL [RiskDescription],
				NULL [Action], 
				NULL [LegionellaFrequencyCategoryID],
				NULL [LegionellaRiskRatingID],
				NULL [LegionellaPriorityRatingID],
				NULL [SortOrder],
		  NULL [TaskDueDate],
		  NULL [PhotoID]
			  FROM 
				Legionella l WITH (NOLOCK)
				INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
				INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
		  WHERE
			lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
			  UNION
			  Select 
				'LegionellaAsset' [TableName],
				la.LegionellaAssetCategoryID [TableCategoryID],
				la.LegionellaAssetID [TableID],
				ld.LegionellaID [ParentID],
				la.GUID [GUID],
				la.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
		  NULL [AreasNotAccessed],
		  NULL [Notes],
				la.SystemRef [SystemRef],
				la.Location [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
				NULL [LegionellaTaskAutoInsertID],
				NULL [LegionellaTaskAutoInsertTypeID],
				NULL [LegionellaTaskNo],
				NULL [LegionellaSectionID], 
				NULL [LegionellaRiskCategoryID],
				NULL [RiskDescription],
				NULL [Action], 
				NULL [LegionellaFrequencyCategoryID],
				NULL [LegionellaRiskRatingID],
				NULL [LegionellaPriorityRatingID],
				NULL [SortOrder],
		  NULL [TaskDueDate],
		  la.PhotoID [PhotoID]
			  FROM 
				LegionellaAsset la WITH (NOLOCK)
				INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
				INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID          
			  WHERE la.Deleted Is Null                    
		  UNION
			  Select 
				'LegionellaLocation' [TableName],
				NULL [TableCategoryID],
				ll.LegionellaLocationID [TableID],
				ld.LegionellaID [ParentID],
				ll.GUID [GUID],
				ll.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
		  NULL [AreasNotAccessed],
		  NULL [Notes],
				NULL [SystemRef],
				ll.Location [Location],
				NULL [SourceCold],
				NULL [SourceHot],
				NULL [SourceMains],
				NULL [SourceMixed],
				NULL [SentinelCold],
				NULL [SentinelHot],
				NULL [SentinelMains],
				NULL [SentinelMixed],
				NULL [EnabledCold],
				NULL [EnabledHot],
				NULL [EnabledMains],
				NULL [EnabledMixed],
				NULL [LowUseCold],
				NULL [LowUseHot],
				NULL [LowUseMains],
				NULL [LowUseMixed],
		  NULL [LegionellaTaskAutoInsertID],
				NULL [LegionellaTaskAutoInsertTypeID],
				NULL [LegionellaTaskNo],
				NULL [LegionellaSectionID], 
				NULL [LegionellaRiskCategoryID],
				NULL [RiskDescription],
				NULL [Action], 
				NULL [LegionellaFrequencyCategoryID],
				NULL [LegionellaRiskRatingID],
				NULL [LegionellaPriorityRatingID],
				ll.SortOrder [SortOrder],
		  NULL [TaskDueDate],
		  NULL [PhotoID]
			  FROM 
				LegionellaLocation ll WITH (NOLOCK)
				INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
				INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
				WHERE ll.Deleted Is Null
			  UNION
			  Select 
				'LegionellaOutlet' [TableName],
				lo.LegionellaOutletCategoryID [TableCategoryID],
				lo.LegionellaOutletID [TableID],
				lld.LegionellaLocationID [ParentID],
				lo.GUID [GUID],
				lo.GUIDVersion [GUIDVersion],
				NULL [BuildingDesignation],
				NULL [GeneralDescriptionOfSite],
		  NULL [AreasNotAccessed],
		  NULL [Notes],
				lo.SystemRef [SystemRef],
				NULL [Location],
				lo.SourceCold [SourceCold],
				lo.SourceHot [SourceHot],
				lo.SourceMains [SourceMains],
				lo.SourceMixed [SourceMixed],
				lo.SentinelCold [SentinelCold],
				lo.SentinelHot [SentinelHot],
				lo.SentinelMains [SentinelMains],
				lo.SentinelMixed [SentinelMixed],
				lo.EnabledCold [EnabledCold],
				lo.EnabledHot [EnabledHot],
				lo.EnabledMains [EnabledMains],
				lo.EnabledMixed [EnabledMixed],
				lo.LowUseCold [LowUseCold],
		  lo.LowUseHot [LowUseHot],
		  lo.LowUseMains [LowUseMains],
		  lo.LowUseMixed [LowUseMixed],
				NULL [LegionellaTaskAutoInsertID],
				NULL [LegionellaTaskAutoInsertTypeID],
				NULL [LegionellaTaskNo],
				NULL [LegionellaSectionID], 
				NULL [LegionellaRiskCategoryID],
				NULL [RiskDescription],
				NULL [Action], 
				NULL [LegionellaFrequencyCategoryID],
				NULL [LegionellaRiskRatingID],
				NULL [LegionellaPriorityRatingID],
				NULL [SortOrder],
		  NULL [TaskDueDate],
		  NULL [PhotoID]
			  FROM 
				LegionellaOutlet lo WITH (NOLOCK)
		  INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
		  INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
		  WHERE lo.Deleted Is Null
		  ) main
		LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

	  Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
	  Select
		main.TableName,
		main.TableCategoryID,
		main.TableID,
		main.ParentID,
		main.GUID,
		main.GuidVersion,
		main.BuildingDesignation,
		main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
		main.AreasNotAccessed [AreasNotAccessed],
		main.Notes [Notes],
		main.SystemRef,
		main.Location,
		main.SourceCold,
		main.SourceHot,
		main.SourceMains,
		main.SourceMixed,
		main.SentinelCold,
		main.SentinelHot,
		main.SentinelMains,
		main.SentinelMixed,
		main.EnabledCold,
		main.EnabledHot,
		main.EnabledMains,
		main.EnabledMixed,
		main.LowUseCold,
		main.LowUseHot,
		main.LowUseMains,
		main.LowUseMixed,
		main.[LegionellaTaskAutoInsertID],
		main.[LegionellaTaskAutoInsertTypeID],
		main.[LegionellaTaskNo],
		main.[LegionellaSectionID], 
		main.[LegionellaRiskCategoryID],
		main.[RiskDescription],
		main.[Action], 
		main.[LegionellaFrequencyCategoryID],
		main.[LegionellaRiskRatingID],
		main.[LegionellaPriorityRatingID],
		main.[SortOrder],
		main.TaskDueDate [TaskDueDate]
	  FROM
	  (
		--now for the tasks!
		Select 
		'LegionellaTask_Outlet' [TableName],
		NULL [TableCategoryID],
		lt.LegionellaTaskID [TableID],
		lto.TableID [ParentID],
		lt.GUID [GUID],
		lt.GUIDVersion [GUIDVersion],
		NULL [BuildingDesignation],
		NULL [GeneralDescriptionOfSite],
		NULL [AreasNotAccessed],
		NULL [Notes],
		NULL [SystemRef],
		NULL [Location],
		NULL [SourceCold],
		NULL [SourceHot],
		NULL [SourceMains],
		NULL [SourceMixed],
		NULL [SentinelCold],
		NULL [SentinelHot],
		NULL [SentinelMains],
		NULL [SentinelMixed],
		NULL [EnabledCold],
		NULL [EnabledHot],
		NULL [EnabledMains],
		NULL [EnabledMixed],
		NULL [LowUseCold],
		NULL [LowUseHot],
		NULL [LowUseMains],
		NULL [LowUseMixed],
		lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
		lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
		lt.LegionellaTaskNo [LegionellaTaskNo],
		lt.LegionellaSectionID [LegionellaSectionID], 
		lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
		lt.RiskDescription [RiskDescription],
		lt.[Action] [Action], 
		lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
		lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
		lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
		lt.SortOrder [SortOrder],
		lt.DueDate [TaskDueDate]
		FROM 
		LegionellaTask lt
		INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
		WHERE
		lt.Deleted IS NULL
		UNION
		Select 
		'LegionellaTask_Asset' [TableName],
		NULL [TableCategoryID],
		lt.LegionellaTaskID [TableID],
		lta.TableID [ParentID],
		lt.GUID [GUID],
		lt.GUIDVersion [GUIDVersion],
		NULL [BuildingDesignation],
		NULL [GeneralDescriptionOfSite],
		NULL [AreasNotAccessed],
		NULL [Notes],
		NULL [SystemRef],
		NULL [Location],
		NULL [SourceCold],
		NULL [SourceHot],
		NULL [SourceMains],
		NULL [SourceMixed],
		NULL [SentinelCold],
		NULL [SentinelHot],
		NULL [SentinelMains],
		NULL [SentinelMixed],
		NULL [EnabledCold],
		NULL [EnabledHot],
		NULL [EnabledMains],
		NULL [EnabledMixed],
		NULL [LowUseCold],
		NULL [LowUseHot],
		NULL [LowUseMains],
		NULL [LowUseMixed],
		lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
		lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
		lt.LegionellaTaskNo [LegionellaTaskNo],
		lt.LegionellaSectionID [LegionellaSectionID], 
		lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
		lt.RiskDescription [RiskDescription],
		lt.[Action] [Action], 
		lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
		lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
		lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
		lt.SortOrder [SortOrder],
		lt.DueDate [TaskDueDate]
		FROM 
		LegionellaTask lt
		INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
		WHERE
		lt.Deleted IS NULL
		UNION
		Select 
		'LegionellaTask_Location' [TableName],
		NULL [TableCategoryID],
		lt.LegionellaTaskID [TableID],
		ltll.TableID [ParentID],
		lt.GUID [GUID],
		lt.GUIDVersion [GUIDVersion],
		NULL [BuildingDesignation],
		NULL [GeneralDescriptionOfSite],
		NULL [AreasNotAccessed],
		NULL [Notes],
		NULL [SystemRef],
		NULL [Location],
		NULL [SourceCold],
		NULL [SourceHot],
		NULL [SourceMains],
		NULL [SourceMixed],
		NULL [SentinelCold],
		NULL [SentinelHot],
		NULL [SentinelMains],
		NULL [SentinelMixed],
		NULL [EnabledCold],
		NULL [EnabledHot],
		NULL [EnabledMains],
		NULL [EnabledMixed],
		NULL [LowUseCold],
		NULL [LowUseHot],
		NULL [LowUseMains],
		NULL [LowUseMixed],
		lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
		lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
		lt.LegionellaTaskNo [LegionellaTaskNo],
		lt.LegionellaSectionID [LegionellaSectionID], 
		lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
		lt.RiskDescription [RiskDescription],
		lt.[Action] [Action], 
		lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
		lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
		lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
		lt.SortOrder [SortOrder],
		lt.DueDate [TaskDueDate]
		FROM 
		LegionellaTask lt
		INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
		WHERE
		lt.Deleted IS NULL
		UNION
		Select 
		'LegionellaTask_Legionella' [TableName],
		lt.LegionellaSectionID [TableCategoryID],
		lt.LegionellaTaskID [TableID],
		ltl.TableID [ParentID],
		lt.GUID [GUID],
		lt.GUIDVersion [GUIDVersion],
		NULL [BuildingDesignation],
		NULL [GeneralDescriptionOfSite],
		NULL [AreasNotAccessed],
		NULL [Notes],
		NULL [SystemRef],
		NULL [Location],
		NULL [SourceCold],
		NULL [SourceHot],
		NULL [SourceMains],
		NULL [SourceMixed],
		NULL [SentinelCold],
		NULL [SentinelHot],
		NULL [SentinelMains],
		NULL [SentinelMixed],
		NULL [EnabledCold],
		NULL [EnabledHot],
		NULL [EnabledMains],
		NULL [EnabledMixed],
		NULL [LowUseCold],
		NULL [LowUseHot],
		NULL [LowUseMains],
		NULL [LowUseMixed],
		lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
		lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
		lt.LegionellaTaskNo [LegionellaTaskNo],
		lt.LegionellaSectionID [LegionellaSectionID], 
		lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
		lt.RiskDescription [RiskDescription],
		lt.[Action] [Action], 
		lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
		lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
		lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
		lt.SortOrder [SortOrder],
		lt.DueDate [TaskDueDate]
		FROM 
		LegionellaTask lt
		INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
		WHERE
		lt.Deleted IS NULL
	  ) main

      
		WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
		BEGIN
		  DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
		  UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
		  DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
		  Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
		END
      
		WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
		BEGIN
		  DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
		  UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
		  DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
		  Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
		END
      
		WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
		BEGIN
		  DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
		  UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
		  DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
		  Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
		END
      
		WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
		BEGIN
		  DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
		  UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
		  DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
		  Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
		END
	END
	
	If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) = 0 BEGIN
		INSERT INTO LegionellaMonitoringDataCache (JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID)
		SELECT
			@JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID
		FROM
			@ReinspectData
	END

	-- Add row in for latest floorplan image
	If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
		Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
		SELECT
			'Legionella_Floorplan' [TableName],
			NULL [TableCategoryID],
			NULL [TableID],
			NULL [ParentID],
			NULL [GUID],
			NULL [GUIDVersion],
			NULL [BuildingDesignation],
			NULL [GeneralDescriptionOfSite],
			NULL [AreasNotAccessed],
			CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
			NULL [SystemRef],
			NULL [Location],
			NULL [SourceCold],
			NULL [SourceHot],
			NULL [SourceMains],
			NULL [SourceMixed],
			NULL [SentinelCold],
			NULL [SentinelHot],
			NULL [SentinelMains],
			NULL [SentinelMixed],
			NULL [EnabledCold],
			NULL [EnabledHot],
			NULL [EnabledMains],
			NULL [EnabledMixed],
			NULL [LowUseCold],
			NULL [LowUseHot],
			NULL [LowUseMains],
			NULL [LowUseMixed],
			NULL [LegionellaTaskAutoInsertID],
			NULL [LegionellaTaskAutoInsertTypeID],
			NULL [LegionellaTaskNo],
			NULL [LegionellaSectionID], 
			NULL [LegionellaRiskCategoryID],
			NULL [RiskDescription],
			NULL [Action], 
			NULL [LegionellaFrequencyCategoryID],
			NULL [LegionellaRiskRatingID],
			NULL [LegionellaPriorityRatingID],
			NULL [SortOrder],
			NULL [TaskDueDate],
			CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
		FROM 
			(
				SELECT TOP 1
					all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
				FROM
					@Legionella_Data ld 
					INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
					INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
					INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID AND j.Approved IS NOT NULL
					INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
					INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
					INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
					INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
					INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
					INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
					INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
				WHERE
					CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
				ORDER BY
					all_l.LegionellaFinish DESC
			) ld
			INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
	END

    Select TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID

SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.79_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.79_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Airtest_v1.0.0.79_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT, ContactID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID,ContactID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID,
  j.ContactID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentAirMonitoringTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select 'AppointmentAirMonitoring' AS [TableName], aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable 
  
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
          UNION
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - JSM: This needs to be after the client  
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringType' AS [TableName], aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable 
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringSampleClassification' AS [TableName], aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable 
  --------------------------------------------------------


  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable 
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [ContactID|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX), [RemovalContracterID|INTEGER|NULL|Client|] INT NULL) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [ContactID|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|], [SiteAlert|VARCHAR|NULL||] ) Select 'Job' AS [TableName], j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], j.[ContactID], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), (
         SELECT
            top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] 
         FROM
            @JobQuoteAppointmentIDList jqal 
            INNER JOIN
               @AppointmentAirMonitoringTable aam 
               ON jqal.AppointmentID = aam.[AppointmentID|INTEGER|NOTNULL||]
         WHERE
            jqal.JobID = j.JobID
      ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [ContactID|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||], [RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select 'QuoteVisit' AS [TableName], qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 

  DECLARE @NoAccessTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([SQLTableName|NVARCHAR|NOTNULL||], [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT 'NoAccess' AS [TableName], na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 

  DECLARE @ClientContacts TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[Client|VARCHAR|NULL||] VARCHAR(250) NULL,[Address|VARCHAR|NULL||] VARCHAR(250) NULL, [Contacts|INTEGER|NOTNULL||] INT NULL, [ContactIndex|INTEGER|NOTNULL||] INT NULL, [MainContact|INTEGER|NOTNULL||] INT NULL, [ContactID|INTEGER|NOTNULL||] INT NULL, [Contact|VARCHAR|NULL||] VARCHAR(200) NULL, [Email|VARCHAR|NULL||] VARCHAR(100) NULL, [Telephone|VARCHAR|NULL||] VARCHAR(50) NULL, [Fax|VARCHAR|NULL||] VARCHAR(50) NULL, [BadClient|INTEGER|NOTNULL||] INT NULL) INSERT INTO @ClientContacts ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[Client|VARCHAR|NULL||],[Address|VARCHAR|NULL||], [Contacts|INTEGER|NOTNULL||], [ContactIndex|INTEGER|NOTNULL||], [MainContact|INTEGER|NOTNULL||], [ContactID|INTEGER|NOTNULL||], [Contact|VARCHAR|NULL||], [Email|VARCHAR|NULL||], [Telephone|VARCHAR|NULL||], [Fax|VARCHAR|NULL||], [BadClient|INTEGER|NOTNULL||]) SELECT 'ClientContacts' AS [TableName], cc.ClientId, cc.Client, cc.Address, cc.Contacts, cc.ContactIndex, cc.MainContact, cc.ContactID, cc.Contact, cc.Email, cc.Telephone, cc.Fax, cc.BadClient FROM ClientContacts cc WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID,ContactID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID,ContactID) jqa ON jqa.ContactID = cc.ContactID SELECT [SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[Client|VARCHAR|NULL||],[Address|VARCHAR|NULL||], [Contacts|INTEGER|NOTNULL||], [ContactIndex|INTEGER|NOTNULL||], [MainContact|INTEGER|NOTNULL||], [ContactID|INTEGER|NOTNULL||], [Contact|VARCHAR|NULL||], [Email|VARCHAR|NULL||], [Telephone|VARCHAR|NULL||], [Fax|VARCHAR|NULL||], [BadClient|INTEGER|NOTNULL||] FROM @ClientContacts 

  SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.77_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.77_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



ALTER PROC [dbo].[mobile_Legionella_v1.4.0.77_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
   DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable  GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  DECLARE @AppointmentLegionellaTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  
  INSERT INTO @AppointmentLegionellaTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) 
  Select 'AppointmentLegionella' AS [TableName], al.[AppointmentLegionellaID],al.[AppointmentID],al.LegionellaTypeID,al.DueDate FROM AppointmentLegionella al WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentLegionellaID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentLegionellaTable 
  
  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ) 
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address] + ', ' + c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
          UNION 
        SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
          UNION
        SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID 
  GROUP BY
    c.[ClientID],c.[Client],c.[Address],c.[PostCode],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable 
  --------------------------------------------------------

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable 
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable 
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||]) Select 'Job' AS [TableName], j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [SQLTableName|NVARCHAR|NOTNULL||],[JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||] FROM @JobTable 
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable 

  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable 

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ) 
  
  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||]) 
    Select 'QuoteVisit' AS [TableName],  
      qv.[QuoteVisitID],
      qv.[QuoteVisitTypeID],
      qv.[QuoteEmployeeID],
      qv.[QuoteVisitStart],
      qv.[QuoteVisitFinish],
      qv.[Notes],
      qv.[PhotoID],
      qv.[SystemName],
      qv.[Closed],
      qv.[Finished],
      qv.[SignatureID],
      qv.[_QuoteVisitConsumableMarkup],
      qv.[_QuoteVisitEquipmentMarkup],
      qv.[_QuoteVisitLabourMarkup] 
    FROM 
      QuoteVisit qv 
      INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID 
      
  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[C_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[C_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[C_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable 
  --------------------------------------------------------

  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable 
  DECLARE @NoAccessTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) Select 'NoAccess' AS [TableName], na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable 
  
  SET NOCOUNT OFF;
END


GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.92_DataTransfer_JobQuoteAppointment')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.92_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_Surveying_v2.4.2.92_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  /*
  DECLARE @AppointmentAirMonitoringTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select 'AppointmentAirMonitoring' AS [TableName], aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringType' AS [TableName], aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringSampleClassification' AS [TableName], aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable
  */

  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )  
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID      
      
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM StandardPhraseCategoryClient WHERE ClientID IS NOT NULL GROUP BY ClientID 
      ) spcc ON c.ClientID=spcc.ClientID      

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]
  --------------------------------------------------------
  

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]
  , dbo.get_SiteHighestRegisterItemNo([SiteID|INTEGER|NOTNULL||SERVERKEY]) [SiteHighestRegisterItemNo|VARCHAR|INT||] 
  FROM @SiteTable
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID WHERE ae.EmployeeID=@EmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,  [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select 'Job' AS [TableName], j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable
  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select 'QuoteVisit' AS [TableName], qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


  SET NOCOUNT OFF;
END


GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.92_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.92_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Surveying_v2.4.2.92_DataTransfer_StaticTables]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
      
  UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
  --[mobile__HighestJobNo] is an exception from structure!
  --DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
  --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
  --SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
  IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
    DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [TableName], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT 'Config' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
    DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
    DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
    DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
    DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
  END

  -- This is where the StartTableNumber check has to check the lower limit as well

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
    DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
    DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
  DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
  DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
  DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
  DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
  DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
  DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
  DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
  DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
  DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
  -- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
  DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, 
    [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
    [RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
    [Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
    [IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
    [BranchOfficeID|INTEGER|NULL||] INTEGER NULL
  )

  INSERT INTO @EquipmentTable (
    [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||]
  )      
  SELECT 
    'Equipment' AS [TableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
    e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
  FROM 
    Equipment e 
    LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
    LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
  WHERE 
    e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
  GROUP BY 
    e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

  SELECT 
    'Equipment' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||] 
  FROM 
    @EquipmentTable
  -------------------------------------------------------------------------------------------------------------
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
  DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
  DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
  DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
  DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
  DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
  DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
  DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
  DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
  DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
  END
  
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
  DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Deleted|DATETIME|NULL||] DATETIME NULL)     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod],[Deleted] FROM RiskElementType       SELECT 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @RiskElementTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
  DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
  DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
  DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
  DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
  DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID],[TableName],[TableCode] FROM TableCode      SELECT 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
  DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
  DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
  DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
  DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
  DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
  DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
  END
    
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
  DECLARE @StandardProcedureTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
  DECLARE @StandardProcedureTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
  END
  
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
  DECLARE @EmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @EmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])  Select 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee SELECT 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable
  END

  SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_LicenceAuthorisation')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_LicenceAuthorisation] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_v2_LicenceAuthorisation]
(
  @SystemName nvarchar(MAX),
    @EmployeeID INT,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Version VARCHAR(50),
  @Platform VARCHAR(50),
  @DevDevice BIT,
  @Licensable BIT,
  @LicensableExpiry DATETIME = NULL
)
AS
BEGIN
  
  SET NOCOUNT ON; 
  
  /* ### Override the Extra parameters from what is in the MobileGuid table ### */
  If (SELECT COUNT(*) FROM MobileGuid WHERE DeviceGuid=@DeviceGuid) > 0 BEGIN
    SELECT @DevDevice=DevDevice,@Licensable=Licensable,@LicensableExpiry=LicensableExpiry FROM MobileGuid WhERE DeviceGuid=@DeviceGuid
  END
  
  /* ### Create the MobileGuid record ### */
  If (SELECT COUNT(*) FROM MobileGuid WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
    INSERT INTO MobileGuid (DeviceGuid,DevDevice,Licensable,LicensableExpiry) SELECT @DeviceGuid,@DevDevice,@Licensable,@LicensableExpiry
  END

  /* ### Auto license the equipment record that matches the system name, if a free key is available ### */
  IF (SELECT COUNT(*) FROM Equipment WHERE EquipmentCategoryID=19 AND RefNo=@SystemName AND MobileUnitLicenceKeyID IS NULL) > 0 BEGIN
    UPDATE e
      Set MobileUnitLicenceKeyID=u.MobileUnitLicenceKeyID
    FROM
      Equipment e
      CROSS APPLY
      (
        Select TOP 1
          mulk.MobileUnitLicenceKeyID
        FROM 
          MobileUnitLicenceKey mulk
          LEFT OUTER JOIN 
          (
            SELECT
              e.MobileUnitLicenceKeyID
            FROM
              Equipment e
            WHERE
              e.EquipmentCategoryID=19 
                AND 
              e.DeviceGuid IS NULL 
            GROUP BY
              e.MobileUnitLicenceKeyID
          ) e ON mulk.MobileUnitLicenceKeyID=e.MobileUnitLicenceKeyID
        WHERE 
          e.MobileUnitLicenceKeyID IS NULL
      ) u
    WHERE
      e.RefNo=@SystemName AND e.MobileUnitLIcenceKeyID IS NULL AND e.EquipmentCategoryID=19

  END

  /* ### Create the Equipment record if it doesnt exist ### */
  If (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
    INSERT INTO Equipment (DeviceGuid,EquipmentCategoryID,RefNo,Description,BranchOfficeID,MobileUnitLicenceKeyID)
    SELECT @DeviceGuid,19,@DeviceGuid,@DeviceGuid,ISNULL((SELECT BranchOfficeID FROM Employee WHERE EmployeeID=@EmployeeID),(SELECT TOP 1 BranchOfficeID FROM BranchOffice WHERE [Default]=1)),
    CASE WHEN @Licensable = 1 THEN
      (
        SELECT 
          mulk.MobileUnitLicenceKeyID
        FROM
          Equipment e
          INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID
          LEFT OUTER JOIN Equipment ge ON mulk.MobileUnitLicenceKeyID=ge.MobileUnitLicenceKeyID AND ge.DeviceGuid IS NOT NULL
        WHERE
          e.EquipmentCategoryID = 19
            AND
          e.RefNo = @SystemName
            AND
          ge.EquipmentID IS NULL
      )
    END
  END
  
  IF (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid) > 0 AND (SELECT COUNT(*) FROM Equipment WHERE DeviceGuid=@DeviceGuid AND MobileUnitLicenceKeyID IS NOT NULL) = 0 BEGIN
    UPDATE
      Equipment
      SET MobileUnitLicenceKeyID =
          CASE WHEN @Licensable = 1 THEN
            (
              SELECT 
                mulk.MobileUnitLicenceKeyID
              FROM
                Equipment e
                INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID
                LEFT OUTER JOIN Equipment ge ON mulk.MobileUnitLicenceKeyID=ge.MobileUnitLicenceKeyID AND ge.DeviceGuid IS NOT NULL
              WHERE
                e.EquipmentCategoryID = 19
                  AND
                e.RefNo = @SystemName
                  AND
                ge.EquipmentID IS NULL
            )
          END
    WHERE
       DeviceGuid=@DeviceGuid
  END

  /* ### Clear any open MobileDTSLog tokens ### */
  IF (SELECT COUNT(*) FROM MobileDtcLog WHERE EmployeeID=@EmployeeID AND App=@App AND DeviceGuid=@DeviceGuid) > 0 BEGIN
    UPDATE MobileDtcLog SET DateCompleted=GETDATE() WHERE EmployeeID=@EmployeeID AND DateCompleted IS NULL AND App=@App AND DeviceGuid=@DeviceGuid
  END

  IF (SELECT COUNT(*) FROM MobileAuditTrail WHERE DeviceGuid=@DeviceGuid) = 0 BEGIN
    INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform]) SELECT 2,@SystemName,'Initial Connection for DeviceGuid','MobileAuditTrail',0,'mobile_v2_LicenceAuthorisation',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform
  END


  DECLARE @Authorised BIT = 0

  IF (SELECT COUNT(*) FROM Equipment e INNER JOIN MobileUnitLicenceKey mulk ON e.MobileUnitLicenceKeyID=mulk.MobileUnitLicenceKeyID WHERE e.DeviceGuid=@DeviceGuid AND (@LicensableExpiry>GETDATE() OR @LicensableExpiry IS NULL)) > 0 OR (@Licensable = 1 AND @LicensableExpiry>GETDATE()) OR @Licensable=0 BEGIN
    SET @Authorised = 1
  END
  
  IF (SELECT COUNT(*) FROM Config WHERE s__CompanyName = 'TEAMS DEMO COMPANY' OR s__CompanyName = 'App Review Demo Company') = 1 BEGIN 
    UPDATE Config SET s__EnableMobileLicensing = DATEADD(dd,2,GETDATE())
  END
  
  IF @Authorised = 0 BEGIN
    INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform]) SELECT 0,@SystemName,'Failed Authorisation','MobileAuditTrail',0,'mobile_v2_LicenceAuthorisation','0.0.0.0','0.0.0.0',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform
    SET @Authorised = 1
  END

  SELECT @Authorised [Authorised], @DeviceGuid [DeviceGuid], @DevDevice [DevDevice], @Licensable [Licensable], @LicensableExpiry [LicensableExpiry];
  
  SET NOCOUNT OFF;
  
END



IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.67_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;

  /*
  DECLARE @CachedJobIDList VARCHAR(MAX) = '12914,11718,12210,12534,12485,12606,12627,12628,12629,12631,12635,12661,12660,12680,12633, 12680, 12687, 12704,12682,12683,12689, 8688,9693,9709,9723,9739,9751,12452,12455,12456,12459,12460,12464,12467,12619,12639,12644,
  12645,12646,12682,12683,12689,12714,12716,12717,12718,12721,12723,12724,12725,12726,12727,12728,12733,12735,12736
  ,12737,8754,12736,12742,12744,12745,12746,12747,12748,12749,12750,12751,12752,12753,12754,12755,12756,12757,12759,12760,12761,
  12762,12763,12764,12765,12766,12767,12768,12769,12772,12773,12774,12775,12777,12778,12779,12780,12782,12783,12784,12785,12786,12787,12788,12789,
  12790,12791,12792,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12804,12805,12806,12807,12808,12809,12810,12811,12812,12898,12813,12814,
  12815,12816,12817,12818,12819,12820,12821,12822,12823,12824,12825,12826,12828,12829,12830,12831,12832,12833,12834,12835,12836,12837,12838,12840,12841,12842,
  12843,12844,12845,12846,12848,12849,12850,12851,12852,12853,12854,12855,12856,12857,12858,12859,12860,12861,12862,12863,12864,12865,12866,12867,12868,12869,
  12870,12871,12872,12873,12874,12875,12876,12877,12878,12879,12880,12881,12882,12883,12884,12885,12886,12887,12888,12889,12890,12891,12892,12894,12895,12896,12897,12899,12900,12940,12900,12946,12984'
  */
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE, AssetPhotoID INT
    )

  If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) > 0 BEGIN

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
    SELECT 
      TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,lmdc.Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,p.PhotoData [AssetPhotoData],lmdc.AssetPhotoID
    FROM
      LegionellaMonitoringDataCache lmdc
      LEFT OUTER JOIN Photo p ON lmdc.AssetPhotoID = p.PhotoID
    WHERE
      JobID = @JobID
  END
  ELSE BEGIN

    DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

    --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

    DECLARE @LegionellaGUIDED TABLE
    (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
    )

    --SELECT @RestrictedLegionellaAssetCategoryID
    
    INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
    Select 
      l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
      la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
      ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
      lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
    FROM
      Job j WITH (NOLOCK)
      
      INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
      INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
      INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
      INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
      INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
      LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID AND la.Deleted Is Null AND la.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID AND ll.Deleted Is Null AND ll.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID AND lo.Deleted Is Null AND lo.DateRemoved IS NULL

    /*
      LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID AND la.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID AND ll.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID AND lo.DateRemoved IS NULL */

      OUTER APPLY
        (
        SELECT TOP 1
          _lo.DateRemoved
        FROM
          LegionellaOutlet _lo
        WHERE
          _lo.GUID = lo.GUID
        ORDER BY
          _lo.GUIDVersion DESC
        ) latestOutletRemoved
        OUTER APPLY
        (
        SELECT TOP 1
          _la.DateRemoved
        FROM
          LegionellaAsset _la
        WHERE
          _la.GUID = la.GUID
        ORDER BY
          _la.GUIDVersion DESC
        ) latestAssetRemoved
        OUTER APPLY
        (
        SELECT TOP 1
          _ll.DateRemoved
        FROM
          LegionellaLocation _ll
        WHERE
          _ll.GUID = ll.GUID
        ORDER BY
          _ll.GUIDVersion DESC
        ) latestLocationRemoved
        WHERE
        j.ClientID=@ClientID 
        AND 
        j.SiteID=@SiteID 
        AND 
        j.Approved IS NOT NULL  
        AND
        latestOutletRemoved.DateRemoved IS NULL
        AND
        latestLocationRemoved.DateRemoved IS NULL
        AND
        latestAssetRemoved.DateRemoved IS NULL
        
    DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
    Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

    DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
    Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

    DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
    Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
    Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData],
    p.PhotoID [AssetPhotoID]
    FROM
      (
        Select 
        'Legionella' [TableName],
        NULL [TableCategoryID],
        l.LegionellaID [TableID],
        NULL [ParentID],
        l.GUID [GUID],
        l.GUIDVersion [GUIDVersion],
        l.BuildingDesignation [BuildingDesignation],
        l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
        NULL [SystemRef],
        NULL [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        Legionella l WITH (NOLOCK)
        INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
        INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
      lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
        UNION
        Select 
        'LegionellaAsset' [TableName],
        la.LegionellaAssetCategoryID [TableCategoryID],
        la.LegionellaAssetID [TableID],
        ld.LegionellaID [ParentID],
        la.GUID [GUID],
        la.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        la.SystemRef [SystemRef],
        la.Location [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
        FROM 
        LegionellaAsset la WITH (NOLOCK)
        INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
        INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID          
        WHERE la.Deleted Is Null                    
      UNION
        Select 
        'LegionellaLocation' [TableName],
        NULL [TableCategoryID],
        ll.LegionellaLocationID [TableID],
        ld.LegionellaID [ParentID],
        ll.GUID [GUID],
        ll.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        NULL [SystemRef],
        ll.Location [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        LegionellaLocation ll WITH (NOLOCK)
        INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
        INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
        WHERE ll.Deleted Is Null
        UNION
        Select 
        'LegionellaOutlet' [TableName],
        lo.LegionellaOutletCategoryID [TableCategoryID],
        lo.LegionellaOutletID [TableID],
        lld.LegionellaLocationID [ParentID],
        lo.GUID [GUID],
        lo.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        lo.SystemRef [SystemRef],
        NULL [Location],
        lo.SourceCold [SourceCold],
        lo.SourceHot [SourceHot],
        lo.SourceMains [SourceMains],
        lo.SourceMixed [SourceMixed],
        lo.SentinelCold [SentinelCold],
        lo.SentinelHot [SentinelHot],
        lo.SentinelMains [SentinelMains],
        lo.SentinelMixed [SentinelMixed],
        lo.EnabledCold [EnabledCold],
        lo.EnabledHot [EnabledHot],
        lo.EnabledMains [EnabledMains],
        lo.EnabledMixed [EnabledMixed],
        lo.LowUseCold [LowUseCold],
      lo.LowUseHot [LowUseHot],
      lo.LowUseMains [LowUseMains],
      lo.LowUseMixed [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      WHERE lo.Deleted Is Null
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
    Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
    FROM
    (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
    ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END
  END
  
  If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) = 0 BEGIN
    INSERT INTO LegionellaMonitoringDataCache (JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID)
    SELECT
      @JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID
    FROM
      @ReinspectData
  END

  -- Add row in for latest floorplan image
  If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    SELECT
      'Legionella_Floorplan' [TableName],
      NULL [TableCategoryID],
      NULL [TableID],
      NULL [ParentID],
      NULL [GUID],
      NULL [GUIDVersion],
      NULL [BuildingDesignation],
      NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
      NULL [SystemRef],
      NULL [Location],
      NULL [SourceCold],
      NULL [SourceHot],
      NULL [SourceMains],
      NULL [SourceMixed],
      NULL [SentinelCold],
      NULL [SentinelHot],
      NULL [SentinelMains],
      NULL [SentinelMixed],
      NULL [EnabledCold],
      NULL [EnabledHot],
      NULL [EnabledMains],
      NULL [EnabledMixed],
      NULL [LowUseCold],
      NULL [LowUseHot],
      NULL [LowUseMains],
      NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
      NULL [LegionellaTaskAutoInsertTypeID],
      NULL [LegionellaTaskNo],
      NULL [LegionellaSectionID], 
      NULL [LegionellaRiskCategoryID],
      NULL [RiskDescription],
      NULL [Action], 
      NULL [LegionellaFrequencyCategoryID],
      NULL [LegionellaRiskRatingID],
      NULL [LegionellaPriorityRatingID],
      NULL [SortOrder],
      NULL [TaskDueDate],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
    FROM 
      (
        SELECT TOP 1
          all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
        FROM
          @Legionella_Data ld 
          INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
          INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
          INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID AND j.Approved IS NOT NULL
          INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
          INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
          INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
          INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
          INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
          INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
          INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
        WHERE
          CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
        ORDER BY
          all_l.LegionellaFinish DESC
      ) ld
      INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
  END

    Select TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID

SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.81_DataTransfer_MonitoringData')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.81_DataTransfer_MonitoringData] AS BEGIN SET NOCOUNT ON; END')
END
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_Legionella_v1.4.0.81_DataTransfer_MonitoringData]
(
      @JobID INT
)
AS
BEGIN
  SET NOCOUNT ON;

  /*
  DECLARE @CachedJobIDList VARCHAR(MAX) = '12914,11718,12210,12534,12485,12606,12627,12628,12629,12631,12635,12661,12660,12680,12633, 12680, 12687, 12704,12682,12683,12689, 8688,9693,9709,9723,9739,9751,12452,12455,12456,12459,12460,12464,12467,12619,12639,12644,
  12645,12646,12682,12683,12689,12714,12716,12717,12718,12721,12723,12724,12725,12726,12727,12728,12733,12735,12736
  ,12737,8754,12736,12742,12744,12745,12746,12747,12748,12749,12750,12751,12752,12753,12754,12755,12756,12757,12759,12760,12761,
  12762,12763,12764,12765,12766,12767,12768,12769,12772,12773,12774,12775,12777,12778,12779,12780,12782,12783,12784,12785,12786,12787,12788,12789,
  12790,12791,12792,12793,12794,12795,12796,12797,12798,12799,12800,12801,12802,12803,12804,12805,12806,12807,12808,12809,12810,12811,12812,12898,12813,12814,
  12815,12816,12817,12818,12819,12820,12821,12822,12823,12824,12825,12826,12828,12829,12830,12831,12832,12833,12834,12835,12836,12837,12838,12840,12841,12842,
  12843,12844,12845,12846,12848,12849,12850,12851,12852,12853,12854,12855,12856,12857,12858,12859,12860,12861,12862,12863,12864,12865,12866,12867,12868,12869,
  12870,12871,12872,12873,12874,12875,12876,12877,12878,12879,12880,12881,12882,12883,12884,12885,12886,12887,12888,12889,12890,12891,12892,12894,12895,12896,12897,12899,12900,12940,12900,12946,12984'
  */
  DECLARE @IncludeDataCollectionAndTasks INT = 1

  If ISNULL((SELECT MAX(lt.LegionellaMonitoringStructureOnly) FROM Job j INNER JOIN Quote q ON q.JobID=j.JobID INNER JOIN Appointment a ON a.QuoteID = q.QuoteID INNER JOIN AppointmentLegionella al ON a.AppointmentID=al.AppointmentID INNER JOIN LegionellaType lt ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID =  @JobID AND a.DateDeclined IS NULL GROUP BY lt.LegionellaMonitoringStructureOnly),0) = 1 BEGIN
  SET @IncludeDataCollectionAndTasks = 0
  END
  
  DECLARE @SiteID INT = (Select SiteID FROM Job Where JobID=@JobID)
  DECLARE @ClientID INT = (Select ClientID FROM Job Where JobID=@JobID)
  --Get @LegionellaTypeID
  --Select * FROM LegionellaType
  

    DECLARE @ReinspectData TABLE  
    (
      TableName VARCHAR(MAX),TableCategoryID INT,TableID INT,ParentID INT,GUID VARCHAR(50),GUIDVersion INT,BuildingDesignation VARCHAR(MAX),
      GeneralDescriptionOfSite VARCHAR(MAX), AreasNotAccessed VARCHAR(MAX), Notes VARCHAR(MAX),
      SystemRef VARCHAR(MAX),Location VARCHAR(MAX),
      SourceCold INT, SourceHot INT,SourceMains INT, SourceMixed INT,
      SentinelCold INT, SentinelHot INT, SentinelMains INT, SentinelMixed INT,
      EnabledCold INT, EnabledHot INT, EnabledMains INT, EnabledMixed INT,
      [LowUseCold] INT, [LowUseHot] INT, [LowUseMains] INT, [LowUseMixed] INT,
      LegionellaTaskAutoInsertID INT,LegionellaTaskAutoInsertTypeID INT, LegionellaTaskNo INT, LegionellaSectionID INT, 
      LegionellaRiskCategoryID INT, RiskDescription VARCHAR(MAX), [Action] VARCHAR(MAX), LegionellaFrequencyCategoryID INT, LegionellaRiskRatingID INT, LegionellaPriorityRatingID INT, 
      SortOrder INT, TaskDueDate DATETIME, AssetPhotoData IMAGE, AssetPhotoID INT
    )

  If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) > 0 BEGIN

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
    SELECT 
      TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,lmdc.Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,p.PhotoData [AssetPhotoData],lmdc.AssetPhotoID
    FROM
      LegionellaMonitoringDataCache lmdc
      LEFT OUTER JOIN Photo p ON lmdc.AssetPhotoID = p.PhotoID
    WHERE
      JobID = @JobID
  END
  ELSE BEGIN

    DECLARE @RestrictedLegionellaAssetCategoryID INT = (SELECT ISNULL((SELECT TOP 1 lt.LegionellaAssetCategoryID FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID),0))

    --SELECT lt.* FROM Job j WITH (NOLOCK) INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON al.AppointmentID=a.AppointmentID INNER JOIN LegionellaType lt WITH (NOLOCK) ON al.LegionellaTypeID=lt.LegionellaTypeID WHERE j.JobID = @JobID

    DECLARE @LegionellaGUIDED TABLE
    (
    LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT, LegionellaIdentifier INT,
    LegionellaAssetCategoryID INT,LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT, LegionellaAssetIdentifier INT,
    LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT, LegionellaLocationIdentifier INT,
    LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT, LegionellaOutletIdentifier INT,
    LegionellaAssetPhotoData IMAGE
    )

    --SELECT @RestrictedLegionellaAssetCategoryID
    
    INSERT INTO @LegionellaGUIDED (LegionellaID, LegionellaTypeID, LegionellaGUID, LegionellaGUIDVersion, LegionellaIdentifier, LegionellaAssetCategoryID, LegionellaAssetID, LegionellaAssetGUID, LegionellaAssetGUIDVersion, LegionellaAssetIdentifier, LegionellaLocationID, LegionellaLocationGUID, LegionellaLocationGUIDVersion, LegionellaLocationIdentifier, LegionellaOutletID, LegionellaOutletGUID, LegionellaOutletGUIDVersion, LegionellaOutletIdentifier)
    Select 
      l.LegionellaID,ISNULL(null/*this will come from the Legionella record eventually*/,al.LegionellaTypeID),l.GUID [LegionellaGUID],l.GUIDVersion [LegionellaGUIDVersion], ROW_NUMBER() OVER (PARTITION BY l.GUID ORDER BY l.GUIDVersion DESC) [LegionellaIdentifier], 
      la.LegionellaAssetCategoryID, la.LegionellaAssetID, la.GUID [LegionellaAssetGUID], la.GUIDVersion [LegionellaAssetGUIDVersion], ROW_NUMBER() OVER (PARTITION BY la.GUID ORDER BY la.GUIDVersion DESC) [LegionellaAssetIdentifier], 
      ll.LegionellaLocationID, ll.GUID [LegionellaLocationGUID], ll.GUIDVersion [LegionellaLocationGUIDVersion], ROW_NUMBER() OVER (PARTITION BY ll.GUID ORDER BY ll.GUIDVersion DESC) [LegionellaIdentifier], 
      lo.LegionellaOutletID, lo.GUID [LegionellaOutletGUID], lo.GUIDVersion [LegionellaOutletGUIDVersion], ROW_NUMBER() OVER (PARTITION BY lo.GUID ORDER BY lo.GUIDVersion DESC) [LegionellaIdentifier]
    FROM
      Job j WITH (NOLOCK)
      
      INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
      INNER JOIN Appointment a WITH (NOLOCK) ON a.QuoteID=q.QuoteID AND a.DateDeclined IS NULL
      INNER JOIN AppointmentLegionella al WITH (NOLOCK) ON a.AppointmentID=al.AppointmentID
      
      INNER JOIN JobEmployee je WITH (NOLOCK) ON j.JobID=je.JobID
      INNER JOIN Legionella l WITH (NOLOCK) ON l.JobEmployeeID=je.JobEmployeeID
      
      LEFT OUTER JOIN LegionellaAsset la WITH (NOLOCK) ON l.LegionellaID = la.LegionellaID AND la.Deleted Is Null AND la.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaLocation ll WITH (NOLOCK) ON l.LegionellaID = ll.LegionellaID AND ll.Deleted Is Null AND ll.DateRemoved IS NULL
      LEFT OUTER JOIN LegionellaOutlet lo WITH (NOLOCK) ON ll.LegionellaLocationID = lo.LegionellaLocationID AND lo.Deleted Is Null AND lo.DateRemoved IS NULL

      OUTER APPLY
        (
        SELECT TOP 1
          _lo.DateRemoved
        FROM
          LegionellaOutlet _lo
        WHERE
          _lo.GUID = lo.GUID
        ORDER BY
          _lo.GUIDVersion DESC
        ) latestOutletRemoved
        OUTER APPLY
        (
        SELECT TOP 1
          _la.DateRemoved
        FROM
          LegionellaAsset _la
        WHERE
          _la.GUID = la.GUID
        ORDER BY
          _la.GUIDVersion DESC
        ) latestAssetRemoved
        OUTER APPLY
        (
        SELECT TOP 1
          _ll.DateRemoved
        FROM
          LegionellaLocation _ll
        WHERE
          _ll.GUID = ll.GUID
        ORDER BY
          _ll.GUIDVersion DESC
        ) latestLocationRemoved
        WHERE
        j.ClientID=@ClientID 
        AND 
        j.SiteID=@SiteID 
        AND 
        j.Approved IS NOT NULL  
        AND
        latestOutletRemoved.DateRemoved IS NULL
        AND
        latestLocationRemoved.DateRemoved IS NULL
        AND
        latestAssetRemoved.DateRemoved IS NULL
        
    DECLARE @Legionella_Data TABLE (LegionellaID INT, LegionellaTypeID INT, LegionellaGUID VARCHAR(MAX), LegionellaGUIDVersion INT)
    Insert into @Legionella_Data (LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion) Select LegionellaID,LegionellaTypeID,LegionellaGUID,LegionellaGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaIdentifier=1

    DECLARE @LegionellaAsset_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaAssetID INT, LegionellaAssetGUID VARCHAR(MAX), LegionellaAssetGUIDVersion INT)
    Insert into @LegionellaAsset_data (LegionellaGUID,LegionellaAssetID,LegionellaAssetGUID,LegionellaAssetGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaAssetID,lguid.LegionellaAssetGUID,lguid.LegionellaAssetGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaAssetIdentifier=1 AND (@RestrictedLegionellaAssetCategoryID = 0 OR lguid.LegionellaAssetCategoryID = CASE WHEN @RestrictedLegionellaAssetCategoryID = 3 THEN CASE WHEN lguid.LegionellaAssetCategoryID IN (4,5) THEN lguid.LegionellaAssetCategoryID ELSE @RestrictedLegionellaAssetCategoryID END ELSE @RestrictedLegionellaAssetCategoryID END)

    DECLARE @LegionellaLocation_Data TABLE (LegionellaGUID VARCHAR(MAX), LegionellaLocationID INT, LegionellaLocationGUID VARCHAR(MAX), LegionellaLocationGUIDVersion INT)
    Insert into @LegionellaLocation_Data (LegionellaGUID,LegionellaLocationID,LegionellaLocationGUID,LegionellaLocationGUIDVersion) Select lguid.LegionellaGUID,lguid.LegionellaLocationID,lguid.LegionellaLocationGUID,lguid.LegionellaLocationGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaLocationIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    DECLARE @LegionellaOutlet_Data TABLE (LegionellaLocationGUID VARCHAR(MAX), LegionellaOutletID INT, LegionellaOutletGUID VARCHAR(MAX), LegionellaOutletGUIDVersion INT)
    Insert into @LegionellaOutlet_Data (LegionellaLocationGUID,LegionellaOutletID,LegionellaOutletGUID,LegionellaOutletGUIDVersion) Select lguid.LegionellaLocationGUID,lguid.LegionellaOutletID, lguid.LegionellaOutletGUID, lguid.LegionellaOutletGUIDVersion FROM @LegionellaGUIDED lguid Where lguid.LegionellaOutletIdentifier=1 AND @RestrictedLegionellaAssetCategoryID = 0

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData,AssetPhotoID)
    Select
      main.TableName,
      main.TableCategoryID,
      main.TableID,
      main.ParentID,
      main.GUID,
      main.GuidVersion,
      main.BuildingDesignation,
      main.GeneralDescriptionOfSite,
      main.AreasNotAccessed,
      main.Notes,
      main.SystemRef,
      main.Location,
      main.SourceCold,
      main.SourceHot,
      main.SourceMains,
      main.SourceMixed,
      main.SentinelCold,
      main.SentinelHot,
      main.SentinelMains,
      main.SentinelMixed,
      main.EnabledCold,
      main.EnabledHot,
      main.EnabledMains,
      main.EnabledMixed,
      main.LowUseCold,
      main.LowUseHot,
      main.LowUseMains,
      main.LowUseMixed,
      main.[LegionellaTaskAutoInsertID],
      main.[LegionellaTaskAutoInsertTypeID],
      main.[LegionellaTaskNo],
      main.[LegionellaSectionID], 
      main.[LegionellaRiskCategoryID],
      main.[RiskDescription],
      main.[Action], 
      main.[LegionellaFrequencyCategoryID],
      main.[LegionellaRiskRatingID],
      main.[LegionellaPriorityRatingID],
      main.[SortOrder],
    main.TaskDueDate [TaskDueDate],
    p.PhotoData [AssetPhotoData],
    p.PhotoID [AssetPhotoID]
    FROM
      (
        Select 
        'Legionella' [TableName],
        NULL [TableCategoryID],
        l.LegionellaID [TableID],
        NULL [ParentID],
        l.GUID [GUID],
        l.GUIDVersion [GUIDVersion],
        l.BuildingDesignation [BuildingDesignation],
        l.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
      l.AreasNotAccessed [AreasNotAccessed],
      l.Notes [Notes],
        NULL [SystemRef],
        NULL [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        Legionella l WITH (NOLOCK)
        INNER JOIN @Legionella_Data ld ON l.LegionellaID = ld.LegionellaID
        INNER JOIN LegionellaType lt ON lt.LegionellaTypeID=ld.LegionellaTypeID /*Will need modification when crazy other column comes in*/
      WHERE
      lt.LegionellaAssetCategoryID IS NULL AND lt.LegionellaFrequencyCategoryID IS NULL
        UNION
        Select 
        'LegionellaAsset' [TableName],
        la.LegionellaAssetCategoryID [TableCategoryID],
        la.LegionellaAssetID [TableID],
        ld.LegionellaID [ParentID],
        la.GUID [GUID],
        la.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        la.SystemRef [SystemRef],
        la.Location [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      la.PhotoID [PhotoID]
        FROM 
        LegionellaAsset la WITH (NOLOCK)
        INNER JOIN @LegionellaAsset_Data lad ON la.LegionellaAssetID=lad.LegionellaAssetID
        INNER JOIN @Legionella_Data ld ON lad.LegionellaGUID=ld.LegionellaGUID          
        WHERE la.Deleted Is Null                    
      UNION
        Select 
        'LegionellaLocation' [TableName],
        NULL [TableCategoryID],
        ll.LegionellaLocationID [TableID],
        ld.LegionellaID [ParentID],
        ll.GUID [GUID],
        ll.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        NULL [SystemRef],
        ll.Location [Location],
        NULL [SourceCold],
        NULL [SourceHot],
        NULL [SourceMains],
        NULL [SourceMixed],
        NULL [SentinelCold],
        NULL [SentinelHot],
        NULL [SentinelMains],
        NULL [SentinelMixed],
        NULL [EnabledCold],
        NULL [EnabledHot],
        NULL [EnabledMains],
        NULL [EnabledMixed],
        NULL [LowUseCold],
        NULL [LowUseHot],
        NULL [LowUseMains],
        NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        ll.SortOrder [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        LegionellaLocation ll WITH (NOLOCK)
        INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationID=ll.LegionellaLocationID
        INNER JOIN @Legionella_Data ld ON lld.LegionellaGUID=ld.LegionellaGUID
        WHERE ll.Deleted Is Null
        UNION
        Select 
        'LegionellaOutlet' [TableName],
        lo.LegionellaOutletCategoryID [TableCategoryID],
        lo.LegionellaOutletID [TableID],
        lld.LegionellaLocationID [ParentID],
        lo.GUID [GUID],
        lo.GUIDVersion [GUIDVersion],
        NULL [BuildingDesignation],
        NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      NULL [Notes],
        lo.SystemRef [SystemRef],
        NULL [Location],
        lo.SourceCold [SourceCold],
        lo.SourceHot [SourceHot],
        lo.SourceMains [SourceMains],
        lo.SourceMixed [SourceMixed],
        lo.SentinelCold [SentinelCold],
        lo.SentinelHot [SentinelHot],
        lo.SentinelMains [SentinelMains],
        lo.SentinelMixed [SentinelMixed],
        lo.EnabledCold [EnabledCold],
        lo.EnabledHot [EnabledHot],
        lo.EnabledMains [EnabledMains],
        lo.EnabledMixed [EnabledMixed],
        lo.LowUseCold [LowUseCold],
      lo.LowUseHot [LowUseHot],
      lo.LowUseMains [LowUseMains],
      lo.LowUseMixed [LowUseMixed],
        NULL [LegionellaTaskAutoInsertID],
        NULL [LegionellaTaskAutoInsertTypeID],
        NULL [LegionellaTaskNo],
        NULL [LegionellaSectionID], 
        NULL [LegionellaRiskCategoryID],
        NULL [RiskDescription],
        NULL [Action], 
        NULL [LegionellaFrequencyCategoryID],
        NULL [LegionellaRiskRatingID],
        NULL [LegionellaPriorityRatingID],
        NULL [SortOrder],
      NULL [TaskDueDate],
      NULL [PhotoID]
        FROM 
        LegionellaOutlet lo WITH (NOLOCK)
      INNER JOIN @LegionellaOutlet_Data lod ON lod.LegionellaOutletID=lo.LegionellaOutletID
      INNER JOIN @LegionellaLocation_Data lld ON lld.LegionellaLocationGUID=lod.LegionellaLocationGUID
      WHERE lo.Deleted Is Null
      ) main
    LEFT OUTER JOIN Photo p WITH (NOLOCK) ON main.PhotoID = p.PhotoID AND main.TableName='LegionellaAsset'

    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate)
    Select
    main.TableName,
    main.TableCategoryID,
    main.TableID,
    main.ParentID,
    main.GUID,
    main.GuidVersion,
    main.BuildingDesignation,
    main.GeneralDescriptionOfSite [GeneralDescriptionOfSite],
    main.AreasNotAccessed [AreasNotAccessed],
    main.Notes [Notes],
    main.SystemRef,
    main.Location,
    main.SourceCold,
    main.SourceHot,
    main.SourceMains,
    main.SourceMixed,
    main.SentinelCold,
    main.SentinelHot,
    main.SentinelMains,
    main.SentinelMixed,
    main.EnabledCold,
    main.EnabledHot,
    main.EnabledMains,
    main.EnabledMixed,
    main.LowUseCold,
    main.LowUseHot,
    main.LowUseMains,
    main.LowUseMixed,
    main.[LegionellaTaskAutoInsertID],
    main.[LegionellaTaskAutoInsertTypeID],
    main.[LegionellaTaskNo],
    main.[LegionellaSectionID], 
    main.[LegionellaRiskCategoryID],
    main.[RiskDescription],
    main.[Action], 
    main.[LegionellaFrequencyCategoryID],
    main.[LegionellaRiskRatingID],
    main.[LegionellaPriorityRatingID],
    main.[SortOrder],
    main.TaskDueDate [TaskDueDate]
    FROM
    (
    --now for the tasks!
    Select 
    'LegionellaTask_Outlet' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lto.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lto ON lt.LegionellaOutletID=lto.TableID AND lto.TableName='LegionellaOutlet'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Asset' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    lta.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData lta ON lt.LegionellaAssetID=lta.TableID AND lta.TableName='LegionellaAsset'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Location' [TableName],
    NULL [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltll.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltll ON lt.LegionellaLocationID=ltll.TableID AND ltll.TableName='LegionellaLocation'
    WHERE
    lt.Deleted IS NULL
    UNION
    Select 
    'LegionellaTask_Legionella' [TableName],
    lt.LegionellaSectionID [TableCategoryID],
    lt.LegionellaTaskID [TableID],
    ltl.TableID [ParentID],
    lt.GUID [GUID],
    lt.GUIDVersion [GUIDVersion],
    NULL [BuildingDesignation],
    NULL [GeneralDescriptionOfSite],
    NULL [AreasNotAccessed],
    NULL [Notes],
    NULL [SystemRef],
    NULL [Location],
    NULL [SourceCold],
    NULL [SourceHot],
    NULL [SourceMains],
    NULL [SourceMixed],
    NULL [SentinelCold],
    NULL [SentinelHot],
    NULL [SentinelMains],
    NULL [SentinelMixed],
    NULL [EnabledCold],
    NULL [EnabledHot],
    NULL [EnabledMains],
    NULL [EnabledMixed],
    NULL [LowUseCold],
    NULL [LowUseHot],
    NULL [LowUseMains],
    NULL [LowUseMixed],
    lt.LegionellaTaskAutoInsertID [LegionellaTaskAutoInsertID],
    lt.LegionellaTaskAutoInsertTypeID [LegionellaTaskAutoInsertTypeID],
    lt.LegionellaTaskNo [LegionellaTaskNo],
    lt.LegionellaSectionID [LegionellaSectionID], 
    lt.LegionellaRiskCategoryID [LegionellaRiskCategoryID],
    lt.RiskDescription [RiskDescription],
    lt.[Action] [Action], 
    lt.LegionellaFrequencyCategoryID [LegionellaFrequencyCategoryID],
    lt.LegionellaRiskRatingID [LegionellaRiskRatingID],
    lt.LegionellaPriorityRatingID [LegionellaPriorityRatingID],
    lt.SortOrder [SortOrder],
    lt.DueDate [TaskDueDate]
    FROM 
    LegionellaTask lt
    INNER JOIN @ReinspectData ltl ON lt.LegionellaID=ltl.TableID AND ltl.TableName='Legionella'
    WHERE
    lt.Deleted IS NULL
    ) main

      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaAssetID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaAsset' AND GUID IS NULL)
      UPDATE LegionellaAsset Set GUID=dbo.CreateGUID('000000000000','LegionellaAsset','TS'),GUIDVersion=1 Where LegionellaAssetID=@LegionellaAssetID
      DECLARE @LegionellaAssetGUID VARCHAR(50) = (Select GUID FROM LegionellaAsset Where LegionellaAssetID=@LegionellaAssetID)
      Update @ReinspectData Set GUID=@LegionellaAssetGUID,GUIDVersion=1 Where TableName='LegionellaAsset' AND TableID=@LegionellaAssetID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaLocationID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaLocation' AND GUID IS NULL)
      UPDATE LegionellaLocation Set GUID=dbo.CreateGUID('000000000000','LegionellaLocation','TS'),GUIDVersion=1 Where LegionellaLocationID=@LegionellaLocationID
      DECLARE @LegionellaLocationGUID VARCHAR(50) = (Select GUID FROM LegionellaLocation Where LegionellaLocationID=@LegionellaLocationID)
      Update @ReinspectData Set GUID=@LegionellaLocationGUID,GUIDVersion=1 Where TableName='LegionellaLocation' AND TableID=@LegionellaLocationID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaOutletID INT = (Select top 1 TableID FROM @ReinspectData Where TableName='LegionellaOutlet' AND GUID IS NULL)
      UPDATE LegionellaOutlet Set GUID=dbo.CreateGUID('000000000000','LegionellaOutlet','TS'),GUIDVersion=1 Where LegionellaOutletID=@LegionellaOutletID
      DECLARE @LegionellaOutletGUID VARCHAR(50) = (Select GUID FROM LegionellaOutlet Where LegionellaOutletID=@LegionellaOutletID)
      Update @ReinspectData Set GUID=@LegionellaOutletGUID,GUIDVersion=1 Where TableName='LegionellaOutlet' AND TableID=@LegionellaOutletID
    END
      
    WHILE (SELECT COUNT(*) FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL) > 0
    BEGIN
      DECLARE @LegionellaTaskID INT = (Select top 1 TableID FROM @ReinspectData Where TableName LIKE 'LegionellaTask%' AND GUID IS NULL)
      UPDATE LegionellaTask Set GUID=dbo.CreateGUID('000000000000','LegionellaTask','TS'),GUIDVersion=1 Where LegionellaTaskID=@LegionellaTaskID
      DECLARE @LegionellaTaskGUID VARCHAR(50) = (Select GUID FROM LegionellaTask Where LegionellaTaskID=@LegionellaTaskID)
      Update @ReinspectData Set GUID=@LegionellaTaskGUID,GUIDVersion=1 Where TableName LIKE 'LegionellaTask%' AND TableID=@LegionellaTaskID
    END
  END
  
  If @JobID IN (SELECT JobID FROM LegionellaMonitoringDataCacheJob) AND (SELECT COUNT(*) FROM LegionellaMonitoringDataCache WHERE @JobID = JobID) = 0 BEGIN
    INSERT INTO LegionellaMonitoringDataCache (JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID)
    SELECT
      @JobID,TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoID
    FROM
      @ReinspectData
  END

  -- Add row in for latest floorplan image
  If (SELECT MobileConfigInt FROM MobileConfig WHERE MobileConfigTypeID=137) > 0 BEGIN
    Insert into @ReinspectData (TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData)
    SELECT
      'Legionella_Floorplan' [TableName],
      NULL [TableCategoryID],
      NULL [TableID],
      NULL [ParentID],
      NULL [GUID],
      NULL [GUIDVersion],
      NULL [BuildingDesignation],
      NULL [GeneralDescriptionOfSite],
      NULL [AreasNotAccessed],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [Notes],
      NULL [SystemRef],
      NULL [Location],
      NULL [SourceCold],
      NULL [SourceHot],
      NULL [SourceMains],
      NULL [SourceMixed],
      NULL [SentinelCold],
      NULL [SentinelHot],
      NULL [SentinelMains],
      NULL [SentinelMixed],
      NULL [EnabledCold],
      NULL [EnabledHot],
      NULL [EnabledMains],
      NULL [EnabledMixed],
      NULL [LowUseCold],
      NULL [LowUseHot],
      NULL [LowUseMains],
      NULL [LowUseMixed],
      NULL [LegionellaTaskAutoInsertID],
      NULL [LegionellaTaskAutoInsertTypeID],
      NULL [LegionellaTaskNo],
      NULL [LegionellaSectionID], 
      NULL [LegionellaRiskCategoryID],
      NULL [RiskDescription],
      NULL [Action], 
      NULL [LegionellaFrequencyCategoryID],
      NULL [LegionellaRiskRatingID],
      NULL [LegionellaPriorityRatingID],
      NULL [SortOrder],
      NULL [TaskDueDate],
      CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [AssetPhotoData]
    FROM 
      (
        SELECT TOP 1
          all_l.LegionellaID, all_al.LegionellaTypeID, all_fp.FloorplanID, all_l.LegionellaFinish
        FROM
          @Legionella_Data ld 
          INNER JOIN Legionella l WITH (NOLOCK) ON ld.LegionellaID=l.LegionellaID
          INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobEmployeeID=l.JobEmployeeID
          INNER JOIN Job j WITH (NOLOCK) ON je.JobID=j.JobID AND j.Approved IS NOT NULL
          INNER JOIN Job all_j WITH (NOLOCK) ON all_j.ClientID=j.ClientID AND all_j.SiteID=j.SiteID
          INNER JOIN Quote all_q WITH (NOLOCK) ON all_j.JobID=all_q.JobID
          INNER JOIN Appointment all_a WITH (NOLOCK) ON all_q.QuoteID=all_a.QuoteID AND all_a.DateDeclined IS NULL
          INNER JOIN AppointmentLegionella all_al WITH (NOLOCK) ON all_al.AppointmentID=all_a.AppointmentID
          INNER JOIN JobEmployee all_je WITH (NOLOCK) ON all_je.JobID=all_j.JobID
          INNER JOIN Legionella all_l WITH (NOLOCK) ON all_l.JobEmployeeID=all_je.JobEmployeeID
          INNER JOIN Floorplan all_fp WITH (NOLOCK) ON all_fp.LegionellaID=all_l.LegionellaID
        WHERE
          CASE WHEN all_al.LegionellaTypeID NOT IN (1,2) THEN CASE WHEN all_al.LegionellaTypeID=ld.LegionellaTypeID THEN 1 ELSE 0 END ELSE 1 END = 1
        ORDER BY
          all_l.LegionellaFinish DESC
      ) ld
      INNER JOIN Floorplan fp WITH (NOLOCK) ON ld.FloorplanID=fp.FloorplanID
  END

    Select TableName,TableCategoryID,TableID,ParentID,GUID,GUIDVersion,BuildingDesignation,GeneralDescriptionOfSite,AreasNotAccessed,Notes,SystemRef,Location,[SourceCold],[SourceHot],[SourceMains],[SourceMixed],[SentinelCold],[SentinelHot],[SentinelMains],[SentinelMixed],[EnabledCold],[EnabledHot],[EnabledMains],[EnabledMixed],[LowUseCold],[LowUseHot],[LowUseMains],[LowUseMixed],LegionellaTaskAutoInsertID,LegionellaTaskAutoInsertTypeID,LegionellaTaskNo,LegionellaSectionID,LegionellaRiskCategoryID,RiskDescription,[Action],LegionellaFrequencyCategoryID,LegionellaRiskRatingID,LegionellaPriorityRatingID,SortOrder,TaskDueDate,AssetPhotoData FROM @ReinspectData WHERE TableName != 'Legionella' --[GUID] IS NOT NULL AND [GUIDVersion] IS NOT NULL

    SELECT
      *
    FROM
    (
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaID = rd.TableID AND TableName='Legionella'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaAssetID = rd.TableID AND TableName='LegionellaAsset'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaLocationID = rd.TableID AND TableName='LegionellaLocation'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
      UNION
      SELECT
        laodc.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaAssetOutletDataCollection laodc
        INNER JOIN @ReinspectData rd ON laodc.LegionellaOutletID = rd.TableID AND TableName='LegionellaOutlet'
      WHERE 
        laodc.Deleted IS NULL
          AND
        @IncludeDataCollectionAndTasks = 1
    ) main

    SELECT
      *
    FROM
    (
      SELECT
        lte.*,
        rd.TableName,rd.TableCategoryID,rd.TableID,rd.ParentID,rd.GUID,rd.GUIDVersion,rd.BuildingDesignation,
        rd.GeneralDescriptionOfSite, rd.AreasNotAccessed, rd.Notes,rd.SystemRef,rd.Location,rd.SourceCold, rd.SourceHot,rd.SourceMains, rd.SourceMixed,rd.SentinelCold, rd.SentinelHot, rd.SentinelMains, rd.SentinelMixed,rd.EnabledCold, rd.EnabledHot, rd.EnabledMains, rd.EnabledMixed,rd.[LowUseCold], rd.[LowUseHot],rd.[LowUseMains], rd.[LowUseMixed],
        rd.LegionellaTaskAutoInsertID,rd.LegionellaTaskAutoInsertTypeID, rd.LegionellaTaskNo, rd.LegionellaSectionID, rd.LegionellaRiskCategoryID, rd.RiskDescription, rd.[Action], rd.LegionellaFrequencyCategoryID, rd.LegionellaRiskRatingID, rd.LegionellaPriorityRatingID, rd.SortOrder, rd.TaskDueDate
      FROM
        LegionellaTaskEvent lte
        INNER JOIN @ReinspectData rd ON lte.LegionellaTaskID = rd.TableID AND TableName LIKE 'LegionellaTask_%'
      WHERE 
        lte.Deleted IS NULL
    ) main
    ORDER BY
      main.LegionellaTaskID

SET NOCOUNT OFF;
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v2.4.2.72_DataTransfer_StaticTables') < 1 
BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v2.4.2.72_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v2.4.2.72_DataTransfer_StaticTables]    Script Date: 17/08/2020 15:24:42 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO


Alter PROC [dbo].[mobile_Surveying_v2.4.2.72_DataTransfer_StaticTables]
(
  @SystemName nvarchar(MAX) = '',
  @Version nvarchar(MAX) = '',
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
      
  --UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
  --[mobile__HighestJobNo] is an exception from structure!
  --DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
  --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
  --SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
  IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
    DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [TableName], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT 'Config' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
    DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
    DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
    DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
    DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
  END

  -- This is where the StartTableNumber check has to check the lower limit as well

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
    DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
    DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
  DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
  DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
  DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
  DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
  DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
  DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
  DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
  DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
  DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
  -- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
  DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, 
    [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
    [RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
    [Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
    [IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
    [BranchOfficeID|INTEGER|NULL||] INTEGER NULL
  )

  INSERT INTO @EquipmentTable (
    [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||]
  )      
  SELECT 
    'Equipment' AS [TableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
    e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
  FROM 
    Equipment e 
    LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
    LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
  WHERE 
    e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
  GROUP BY 
    e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

  SELECT 
    'Equipment' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
    [Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
    [BranchOfficeID|INTEGER|NULL||] 
  FROM 
    @EquipmentTable
  -------------------------------------------------------------------------------------------------------------
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
  DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
  DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
  DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
  DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
  DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
  DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
  DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
  DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
  DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
  DECLARE @QuoteVisitTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'QuoteVisitType' AS [SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT 'QuoteVisitType' AS [SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
  DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Deleted|DATETIME|NULL||] DATETIME NULL)     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod],[Deleted] FROM RiskElementType       SELECT 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @RiskElementTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
  DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
  DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
  DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
  DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
  DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID],[TableName],[TableCode] FROM TableCode      SELECT 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
  DECLARE @TemplateTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select 'TemplateType' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT 'TemplateType' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
  DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
  DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
  DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
  DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
  DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
  DECLARE @AirTestDataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select 'AirTestDataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT 'AirTestDataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
  DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'AirTestDataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT 'AirTestDataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 38 AND @StartTableNumber <= 42) BEGIN
  DECLARE @AirTestDataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT 'AirTestDataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 39 AND @StartTableNumber <= 43) BEGIN
  DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 40 AND @StartTableNumber <= 44) BEGIN
  DECLARE @AirTestTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select 'AirTestType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT 'AirTestType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 41 AND @StartTableNumber <= 45) BEGIN
  DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 42 AND @StartTableNumber <= 46) BEGIN
  DECLARE @ResultTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select 'ResultType' AS [SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT 'ResultType' AS [SQLTableName|NVARCHAR|NOTNULL||], [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 43 AND @StartTableNumber <= 47) BEGIN
  DECLARE @MobileURLFileTransferTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'MobileURLFileTransfer' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT 'MobileURLFileTransfer' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 44 AND @StartTableNumber <= 48) BEGIN
  DECLARE @ReportFooterTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select 'ReportFooter' AS [SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT 'ReportFooter' AS [SQLTableName|NVARCHAR|NOTNULL||], [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 45 AND @StartTableNumber <= 49) BEGIN
  DECLARE @RowTemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select 'RowTemplate' AS [SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT 'RowTemplate' AS [SQLTableName|NVARCHAR|NOTNULL||], [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 46 AND @StartTableNumber <= 50) BEGIN
  DECLARE @StandardProcedureTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT 'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 47 AND @StartTableNumber <= 51) BEGIN
  DECLARE @StandardProcedureTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT 'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 48 AND @StartTableNumber <= 52) BEGIN
  DECLARE @TemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT 'Template' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT 'Template' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 49 AND @StartTableNumber <= 53) BEGIN
  DECLARE @TemplatePageLayoutTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select 'TemplatePageLayout' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT 'TemplatePageLayout' AS [SQLTableName|NVARCHAR|NOTNULL||], [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 50 AND @StartTableNumber <= 54) BEGIN
  DECLARE @EmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @EmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])  Select 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee SELECT 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable
  END

  SET NOCOUNT OFF;
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v3.2020.10.1_DataTransfer_JobQuoteAppointment') < 1 
BEGIN
  EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v3.2020.10.1_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
END
GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Surveying_v3.2020.10.1_DataTransfer_JobQuoteAppointment]    Script Date: 30/10/2020 11:32:38 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Surveying_v3.2020.10.1_DataTransfer_JobQuoteAppointment]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT,
  @AppointmentWindowDate DATETIME = NULL,
  @QuoteList VARCHAR(MAX) = '',
  @ExtraClientIds VARCHAR(MAX) = '',
  @ExtraSiteIds VARCHAR(MAX) = '',
  @DeviceGuid uniqueidentifier = NULL,
  @App VARCHAR(50) = NULL,
  @Platform VARCHAR(50) = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
  
  SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
  
  DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
  INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
  SELECT 
    q.ClientID,
    q.SiteID,
    j.JobID,
    q.QuoteID,
    a.AppointmentID
  FROM 
    Appointment a
    INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
    LEFT OUTER JOIN Quote q ON q.QuoteID=a.QuoteID
    LEFT OUTER JOIN Site si ON q.SiteID = si.SiteID
    LEFT OUTER JOIN Client c ON c.ClientID = q.ClientID
    LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
    LEFT OUTER JOIN Job j ON q.JobID = j.JobID
  WHERE 
    @AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
      AND 
    ae.EmployeeID=@EmployeeID
      AND 
    a.DateDeclined IS NULL

  INSERT INTO @JobQuoteAppointmentIDList (ClientID)
  SELECT
    a.ClientID
  FROM
  (
    SELECT 
      ClientID
    FROM
      ClientSpecificElement
    UNION
    SELECT
      s [ClientID]
    FROM
      dbo.SplitString(@ExtraClientIds,',')
  ) a
  GROUP BY
    a.ClientID

/*
  ORIGINAL
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )  INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID  SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
  --Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
  --Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
  --Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
  --Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
  --Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
  --DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)  INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
  DECLARE @AppointmentSurveyTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @AppointmentSurveyTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select 'AppointmentSurvey' AS [TableName], asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
  /*
  DECLARE @AppointmentAirMonitoringTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL||] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentAirMonitoringTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||]) Select 'AppointmentAirMonitoring' AS [TableName], aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL||],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable
  DECLARE @AppointmentAirMonitoringTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL) INSERT INTO @AppointmentAirMonitoringTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringType' AS [TableName], aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable
  DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)  INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select 'AppointmentAirMonitoringSampleClassification' AS [TableName], aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable
  */

  --------------------------------------------------------
  -- Clients - PJL: I split these up so I could read them!
  DECLARE @ClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EnterpriseAuthEnc|VARCHAR|NULL||] VARCHAR(MAX) NULL )  
  
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID
      ) jqa ON c.ClientID=jqa.ClientID      
      
  INSERT INTO @ClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]) 
    Select 
      'Client' AS [TableName], c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode], c.[EnterpriseAuthEnc]
    FROM 
      Client c WITH (NOLOCK) 
      INNER JOIN (
        SELECT ClientID FROM StandardPhraseCategoryClient WHERE ClientID IS NOT NULL GROUP BY ClientID 
      ) spcc ON c.ClientID=spcc.ClientID      

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||] FROM @ClientTable GROUP BY [SQLTableName|NVARCHAR|NOTNULL||],[ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||],[EnterpriseAuthEnc|VARCHAR|NULL||]
  --------------------------------------------------------
  

  --------------------------------------------------------
  -- Sites - PJL: I split these up so I could read them!
  DECLARE @SiteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

  INSERT INTO @SiteTable ([SQLTableName|NVARCHAR|NOTNULL||], [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
    Select 
      'Site' AS [TableName], si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
    FROM 
      Site si WITH (NOLOCK) 
      INNER JOIN (
        SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
      ) jqa ON si.SiteID=jqa.SiteID 

  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]
  , dbo.get_SiteHighestRegisterItemNo([SiteID|INTEGER|NOTNULL||SERVERKEY]) [SiteHighestRegisterItemNo|VARCHAR|INT||] 
  FROM @SiteTable
  --------------------------------------------------------

  DECLARE @AppointmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX)) INSERT INTO @AppointmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||]) Select 'Appointment' AS [TableName], a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID], cs.SiteAlerts FROM Appointment a WITH (NOLOCK) LEFT OUTER JOIN Site si WITH (NOLOCK) ON a.SiteID=si.SiteID LEFT OUTER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=a.ClientID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||],[SiteAlert|VARCHAR|NULL||] FROM @AppointmentTable
  DECLARE @AppointmentEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)  INSERT INTO @AppointmentEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select 'AppointmentEmployee' AS [TableName], ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID WHERE ae.EmployeeID=@EmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable
  DECLARE @JobTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,  [JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL, [JobNo|INTEGER|NOTNULL||] INT NOT NULL, [ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL, [SiteID|INTEGER|NULL|Site|] INT NULL, [ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL, [Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT ( getdate() ), [ProjectManagerID|INTEGER|NULL||] INT NULL, [HasSiteData|INTEGER|NULL||] INT NULL, [Notes|VARCHAR|NULL||] VARCHAR(MAX), [SiteAlert|VARCHAR|NULL||] VARCHAR(MAX) ) INSERT INTO @JobTable ([SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] ) Select 'Job' AS [TableName], j.[JobID], j.[JobNo], j.[ClientID], j.[SiteID], j.[ClientOrderNo], j.[Created], j.[ProjectManagerID], CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData], ( SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID = a.AppointmentID WHERE jqal.JobID = j.JobID ), cs.SiteAlerts FROM Job j WITH (NOLOCK) INNER JOIN ( SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID ) jqa ON j.JobID = jqa.JobID OUTER APPLY ( SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID = subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID = subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID = subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID = subr.RegisterID WHERE subSi.SiteID = j.SiteID ) sd INNER JOIN Site si WITH (NOLOCK) ON j.SiteID = si.SiteID INNER JOIN ClientSite cs WITH (NOLOCK) ON si.SiteID = cs.SiteID AND cs.ClientID=j.ClientID SELECT [SQLTableName|NVARCHAR|NOTNULL||], [JobID|INTEGER|NOTNULL||SERVERKEY], [JobNo|INTEGER|NOTNULL||], [ClientID|INTEGER|NOTNULL|Client|], [SiteID|INTEGER|NULL|Site|], [ClientOrderNo|VARCHAR|NULL||], [Created|DATETIME|NOTNULL||], [ProjectManagerID|INTEGER|NULL||], [HasSiteData|INTEGER|NULL||], [Notes|VARCHAR|NULL||], [SiteAlert|VARCHAR|NULL||] FROM @JobTable
  DECLARE @QuoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @QuoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select 'Quote' AS [TableName], q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable
  DECLARE @QuoteEmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @QuoteEmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||]) Select 'QuoteEmployee' AS [TableName], qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable
  DECLARE @QuoteVisitTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )  INSERT INTO @QuoteVisitTable ([SQLTableName|NVARCHAR|NOTNULL||], [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select 'QuoteVisit' AS [TableName], qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable
  DECLARE @DataCollectionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ) INSERT INTO @DataCollectionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||]) Select 'DataCollection' AS [TableName], dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection  dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable


  SET NOCOUNT OFF;
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Surveying_v3.2020.10.1_DataTransfer_StaticTables') < 1 
BEGIN
  EXEC('CREATE PROCEDURE [dbo].[mobile_Surveying_v3.2020.10.1_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Surveying_v3.2020.10.1_DataTransfer_StaticTables]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
      
	UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v3.2020.10.1_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
	--SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
	IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
	DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [TableName], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT 'Config' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
	DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
	DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
	DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
	DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	END

	-- This is where the StartTableNumber check has to check the lower limit as well

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
	DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
	DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
	DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
	DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
	DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
	DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
	DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
	DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
	-- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
	DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, 
	[EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
	[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
	[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
	[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
	[BranchOfficeID|INTEGER|NULL||] INTEGER NULL
	)

	INSERT INTO @EquipmentTable (
	[SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
	[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
	[BranchOfficeID|INTEGER|NULL||]
	)      
	SELECT 
	'Equipment' AS [TableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
	e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
	FROM 
	Equipment e 
	LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
	LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
	WHERE 
	e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
	GROUP BY 
	e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

	SELECT 
	'Equipment' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
	[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
	[BranchOfficeID|INTEGER|NULL||] 
	FROM 
	@EquipmentTable
	-------------------------------------------------------------------------------------------------------------
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
	DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
	DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
	DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
	DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
	DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
	DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
	DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
	DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
	DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	END
  
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
	DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
	DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
	DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
	DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
	DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
	DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID],[TableName],[TableCode] FROM TableCode      SELECT 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
	DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
	DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
	DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
	DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
	DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	END


	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------    
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
		DECLARE @StandardProcedureTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,
			[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),
			[Deleted|DATETIME|NULL||] DATETIME NULL 
		)      

		INSERT INTO @StandardProcedureTable (
			[SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
			[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID],sp.[StandardProcedureTypeID],[StandardProcedure],
			[Version],[EmployeeID],[DateCreated],sp.[Deleted] 
		FROM 
			StandardProcedure sp
			INNER JOIN StandardProcedureType t ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE 
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToSurveyingApp = 1
		
		SELECT 
			'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],
			[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTable
	END

	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
		DECLARE @StandardProcedureTypeTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL 
		)   
		
		INSERT INTO @StandardProcedureTypeTable (
			[SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], t.[StandardProcedureTypeID],[StandardProcedureType],t.[Deleted] 
		FROM 
			StandardProcedureType  t
			INNER JOIN StandardProcedure sp ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToSurveyingApp = 1			
			
		SELECT 
			'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTypeTable
	END
  
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
	DECLARE @EmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @EmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])  Select 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee SELECT 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable
	END

	SET NOCOUNT OFF;
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Hazmat_v2.4.2.97_DataTransfer_StaticTables') < 1 
BEGIN
  EXEC('CREATE PROCEDURE [dbo].[mobile_Hazmat_v2.4.2.97_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Hazmat_v2.4.2.97_DataTransfer_StaticTables]
(
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
      
	UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 4,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Surveying_v2.4.2.71_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
	--[mobile__HighestJobNo] is an exception from structure!
	--DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
	--INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
	--SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
	IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
	DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [TableName], [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT 'Config' AS [SQLTableName|NVARCHAR|NOTNULL||], [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
	DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT 'AppointmentType' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
	DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
	DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||], [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
	DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT 'Calibration' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
	END

	-- This is where the StartTableNumber check has to check the lower limit as well

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
	DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT 'CalibrationInformation' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
	DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT 'CalibrationInformationType' AS [SQLTableName|NVARCHAR|NOTNULL||], [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
	DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT 'ClientSpecificElement' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
	DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT 'DataCollectionCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
	DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT 'DataCollectionCategoryType' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
	DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT 'DataCollectionQuestion' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
	DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT 'ElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
	DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT 'ElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT 'ElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
	-- EQUIPMENT ------------I split this up so I could read it: PJL---------------------------------------------
	DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, 
	[EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,
	[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,
	[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,
	[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,
	[BranchOfficeID|INTEGER|NULL||] INTEGER NULL
	)

	INSERT INTO @EquipmentTable (
	[SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
	[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
	[BranchOfficeID|INTEGER|NULL||]
	)      
	SELECT 
	'Equipment' AS [TableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, 
	e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID 
	FROM 
	Equipment e 
	LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID 
	LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID 
	WHERE 
	e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 
	GROUP BY 
	e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID       

	SELECT 
	'Equipment' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],
	[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],
	[BranchOfficeID|INTEGER|NULL||] 
	FROM 
	@EquipmentTable
	-------------------------------------------------------------------------------------------------------------
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
	DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT 'EquipmentAssigned' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
	DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT 'EquipmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
	DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT 'EquipmentCheckType' AS [SQLTableName|NVARCHAR|NOTNULL||], [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
	DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT 'EquipmentIntervalCheck' AS [SQLTableName|NVARCHAR|NOTNULL||], [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
	DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT 'FloorplanImageItem' AS [SQLTableName|NVARCHAR|NOTNULL||], [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
	DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT 'InternalExternalLink' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
	DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT 'InternalExternalNote' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
	DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT 'InternalExternalOption' AS [SQLTableName|NVARCHAR|NOTNULL||], [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
	DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT 'MobileConfig' AS [SQLTableName|NVARCHAR|NOTNULL||], [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
	END
  
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
	DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT 'RiskElementType' AS [SQLTableName|NVARCHAR|NOTNULL||], [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
	DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT 'SampleClassification' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
	DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT 'SampleClassificationExtended' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
	DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT 'SampleResult' AS [SQLTableName|NVARCHAR|NOTNULL||], [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
	DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT 'SurveyType' AS [SQLTableName|NVARCHAR|NOTNULL||], [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
	DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID],[TableName],[TableCode] FROM TableCode      SELECT 'TableCode' AS [SQLTableName|NVARCHAR|NOTNULL||], [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
	DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT 'StandardPhrase' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
	DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT 'StandardPhraseCategory' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
	DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT 'StandardPhraseCategoryClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
	DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT 'StandardPhraseType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
	DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT 'StandardPhraseTypeClient' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT 'PhotoCollectionAutoInsert' AS [SQLTableName|NVARCHAR|NOTNULL||], [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
	END

    
	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------    
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
		DECLARE @StandardProcedureTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,
			[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),
			[Deleted|DATETIME|NULL||] DATETIME NULL 
		)      

		INSERT INTO @StandardProcedureTable (
			[SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
			[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID],sp.[StandardProcedureTypeID],[StandardProcedure],
			[Version],[EmployeeID],[DateCreated],sp.[Deleted] 
		FROM 
			StandardProcedure sp
			INNER JOIN StandardProcedureType t ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE 
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToSurveyingApp = 1
		
		SELECT 
			'StandardProcedure' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],
			[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTable
	END

	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
		DECLARE @StandardProcedureTypeTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL 
		)   
		
		INSERT INTO @StandardProcedureTypeTable (
			[SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], t.[StandardProcedureTypeID],[StandardProcedureType],t.[Deleted] 
		FROM 
			StandardProcedureType  t
			INNER JOIN StandardProcedure sp ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToSurveyingApp = 1			
			
		SELECT 
			'StandardProcedureType' AS [SQLTableName|NVARCHAR|NOTNULL||], [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTypeTable
	END

  
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
	DECLARE @EmployeeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FullName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Surveyor|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTester|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Approver|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Administrator|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Manager|BIT|NULL||] BIT NULL ,[MobilePin|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0000'),[Position|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @EmployeeTable ([SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||])  Select 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID],[FullName],[Surveyor],[AirTester],[Approver],[Administrator],[Deleted],[SortOrder],[Manager],[MobilePin],[Position],[BranchOfficeID] FROM Employee SELECT 'Employee' AS [SQLTableName|NVARCHAR|NOTNULL||], [EmployeeID|INTEGER|NOTNULL||SERVERKEY],[FullName|VARCHAR|NOTNULL||],[Surveyor|BIT|NOTNULL||],[AirTester|BIT|NOTNULL||],[Approver|BIT|NOTNULL||],[Administrator|BIT|NOTNULL||],[Deleted|DATETIME|NULL||],[SortOrder|INTEGER|NOTNULL||],[Manager|BIT|NULL||],[MobilePin|VARCHAR|NOTNULL||],[Position|VARCHAR|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @EmployeeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 38 AND @StartTableNumber <= 42) BEGIN
	DECLARE @SampleType TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL , [DateDeleted|DATETIME|NULL||] DATETIME NULL  )  INSERT INTO @SampleType ([SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DateDeleted|DATETIME|NULL||])  Select 'SampleType' AS [SQLTableName|NVARCHAR|NOTNULL||], SampleTypeID [SampleTypeID|INTEGER|NOTNULL||SERVERKEY], [Description] [Description|VARCHAR|NOTNULL||], DateDeleted [DateDeleted|DATETIME|NULL||]  FROM SampleType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @SampleType
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 39 AND @StartTableNumber <= 43) BEGIN
	DECLARE @SampleTypeElement TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,[SampleTypeElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[SampleTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementTypeDescription|VARCHAR|NOTNULL||] VARCHAR(MAX) NULL,[PriorityAssessment|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @SampleTypeElement ([SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementTypeDescription|VARCHAR|NOTNULL||],[PriorityAssessment|BIT|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])  Select 'SampleTypeElement' AS [SQLTableName|NVARCHAR|NOTNULL||],SampleTypeElementID [SampleTypeElementID|INTEGER|NOTNULL||SERVERKEY],SampleTypeID [SampleTypeID|INTEGER|NOTNULL||],ElementTypeID [ElementTypeID|INTEGER|NOTNULL||],ElementTypeDescription [ElementTypeDescription|VARCHAR|NOTNULL||],PriorityAssessment [PriorityAssessment|BIT|NOTNULL||],UseElementIntmeaningExtended [UseElementIntMeaningExtended|BIT|NOTNULL||],UseElementIntmeaningSubOption [UseElementIntMeaningSubOption|BIT|NOTNULL||]  FROM SampleTypeElement SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementTypeDescription|VARCHAR|NOTNULL||],[PriorityAssessment|BIT|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||]  FROM @SampleTypeElement 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 40 AND @StartTableNumber <= 44) BEGIN
	DECLARE @SampleTypeElementIntMeaning TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,[SampleTypeElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[SampleTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NULL,[ShortDescription|VARCHAR|NOTNULL||] VARCHAR(MAX) NULL)  INSERT INTO @SampleTypeElementIntMeaning ([SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NOTNULL||])  Select 'SampleTypeElementIntMeaning' AS [SQLTableName|NVARCHAR|NOTNULL||],SampleTypeElementIntMeaningID [SampleTypeElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],SampleTypeID [SampleTypeID|INTEGER|NOTNULL||],ElementTypeID [ElementTypeID|INTEGER|NOTNULL||],ElementIntMeaningID [ElementIntMeaningID|INTEGER|NOTNULL||],ElementIntValue [ElementIntValue|INTEGER|NOTNULL||],Description [Description|VARCHAR|NOTNULL||],ShortDescription [ShortDescription|VARCHAR|NOTNULL||]  FROM SampleTypeElementIntMeaning SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NOTNULL||] FROM @SampleTypeElementIntMeaning
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 41 AND @StartTableNumber <= 45) BEGIN
	DECLARE @SampleTypeElementIntMeaningExtended TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,[SampleTypeElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[SampleTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NULL)  INSERT INTO @SampleTypeElementIntMeaningExtended ([SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])  Select 'SampleTypeElementIntMeaningExtended' AS [SQLTableName|NVARCHAR|NOTNULL||],SampleTypeElementIntMeaningExtendedID [SampleTypeElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],SampleTypeID [SampleTypeID|INTEGER|NOTNULL||],ElementIntMeaningExtendedID [ElementIntMeaningExtendedID|INTEGER|NOTNULL||],ElementTypeID [ElementTypeID|INTEGER|NOTNULL||],Description [DescriptionOverride|VARCHAR|NOTNULL||]  FROM SampleTypeElementIntMeaningExtended SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||]  FROM @SampleTypeElementIntMeaningExtended
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 42 AND @StartTableNumber <= 46) BEGIN
	DECLARE @SampleTypeElementIntMeaningSubOption TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL,[SampleTypeElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[SampleTypeID|INTEGER|NOTNULL||] INT NOT NULL,[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||] INT NOT NULL,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NULL) INSERT INTO @SampleTypeElementIntMeaningSubOption ([SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])  Select 'SampleTypeElementIntMeaningSubOption' AS [SQLTableName|NVARCHAR|NOTNULL||],SampleTypeElementIntMeaningSubOptionID [SampleTypeElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],SampleTypeID [SampleTypeID|INTEGER|NOTNULL||],ElementIntMeaningSubOptionID [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||],ElementTypeID [ElementTypeID|INTEGER|NOTNULL||],Description [Description|VARCHAR|NOTNULL||] FROM SampleTypeElementIntMeaningSubOption SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleTypeElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[SampleTypeID|INTEGER|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @SampleTypeElementIntMeaningSubOption
	END

	SET NOCOUNT OFF;
END
GO

IF (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.73_DataTransfer_StaticTables') < 1 
BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.73_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.73_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Platform VARCHAR(50),
	@DbSizeMb INT,
	@DtsGuid uniqueidentifier = NULL,
	@StartTableNumber int = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
      
    SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 3,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Airtest_v1.0.0.72_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
      
	IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
	DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [SQLTableName],[ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber = 2) BEGIN
	DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName],[AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber = 3) BEGIN
	DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName],[AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber = 4) BEGIN
	DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName],[BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber = 5) BEGIN
	DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName],[CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
	DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName],[CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
	DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName],[CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     Select [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
	DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName],[ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName],[ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
	DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' as [SQLTableName], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
	DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName],[DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
	DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName],[DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName],[DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
	DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName],[ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
	DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName],[ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName],[ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
	DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select 'Equipment' AS [SQLTableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     Select [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
	DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName],[EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
	DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName],[EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
	DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName],[EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
	DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName],[IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      Select [SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
	END
	  
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN 
	DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' as [SQLTableName], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
	DECLARE @InternalExternalLinkTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select 'InternalExternalLink' AS [SQLTableName],[InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
	DECLARE @InternalExternalNoteTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select 'InternalExternalNote' AS [SQLTableName],[InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
	DECLARE @InternalExternalOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'InternalExternalOption' AS [SQLTableName],[InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
	DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName],[MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
	DECLARE @QuoteVisitTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'QuoteVisitType' AS [SQLTableName],[QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
	DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName],[RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
	DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName],[SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
	DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName],[SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
	DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName],[SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      Select [SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
	DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName],[SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      Select [SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
	DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName],[TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
	DECLARE @TemplateTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select 'TemplateType' AS [SQLTableName],[TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      Select [SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
	DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName],[StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
	DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName],[StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
	DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName],[StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
	DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName],[StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
	DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName],[StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
	DECLARE @AirTestDataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select 'AirTestDataCollectionCategory' AS [SQLTableName],[AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
	DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select 'AirTestDataCollectionCategoryType' AS [SQLTableName],[AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 38 AND @StartTableNumber <= 42) BEGIN
	DECLARE @AirTestDataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT 'AirTestDataCollectionQuestion' AS [SQLTableName],[AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 39 AND @StartTableNumber <= 43) BEGIN
	DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select 'AirTestDataCollectionQuestionOptionOrInsert' AS [SQLTableName],[AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 40 AND @StartTableNumber <= 44) BEGIN
	DECLARE @AirTestTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select 'AirTestType' AS [SQLTableName],[AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL AND (AirTestTypeID > 200 OR AirTestTypeID=2 OR AirTestTypeID=100)  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 41 AND @StartTableNumber <= 45) BEGIN
	DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName],[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 42 AND @StartTableNumber <= 46) BEGIN
	DECLARE @ResultTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select 'ResultType' AS [SQLTableName],[ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 43 AND @StartTableNumber <= 47) BEGIN
	DECLARE @MobileURLFileTransferTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'MobileURLFileTransfer' AS [SQLTableName],[MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 44 AND @StartTableNumber <= 48) BEGIN
	DECLARE @ReportFooterTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([SQLTableName|NVARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select 'ReportFooter' AS [SQLTableName],[ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      Select [SQLTableName|NVARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 45 AND @StartTableNumber <= 49) BEGIN
	DECLARE @RowTemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([SQLTableName|NVARCHAR|NOTNULL||],[RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select 'RowTemplate' AS [SQLTableName],[RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable 
	END


	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------    
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 46 AND @StartTableNumber <= 50) BEGIN
		DECLARE @StandardProcedureTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,
			[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,
			[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL 
		)      
		
		INSERT INTO @StandardProcedureTable (
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
			[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedure' AS [SQLTableName],[StandardProcedureID],sp.[StandardProcedureTypeID],
			[StandardProcedure],[Version],[EmployeeID],[DateCreated],sp.[Deleted]
		FROM 
			StandardProcedure sp
			INNER JOIN StandardProcedureType t ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToAirApp = 1

		SELECT 
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
			[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTable 
	END

	-- StandardProcedureType ------------I split this up so I could read it: PJL---------------------------------------------
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 47 AND @StartTableNumber <= 51) BEGIN
		DECLARE @StandardProcedureTypeTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL 
		)   
		
		INSERT INTO @StandardProcedureTypeTable (
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedureType' AS [SQLTableName],t.[StandardProcedureTypeID],[StandardProcedureType],t.[Deleted] 
		FROM 
			StandardProcedureType t
			INNER JOIN StandardProcedure sp ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToAirApp = 1
			
		SELECT 
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
		FROM 
			@StandardProcedureTypeTable 
	END


	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 48 AND @StartTableNumber <= 52) BEGIN
	DECLARE @TemplateTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT 'Template' AS [SQLTableName],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [SQLTableName|NVARCHAR|NOTNULL||],[TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 49 AND @StartTableNumber <= 53) BEGIN
	DECLARE @TemplatePageLayoutTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select 'TemplatePageLayout' AS [SQLTableName],[TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      Select [SQLTableName|NVARCHAR|NOTNULL||],[TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable 
	END

	SET NOCOUNT OFF;
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.64_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.64_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Platform VARCHAR(50),
	@DbSizeMb INT,
	@DtsGuid uniqueidentifier = NULL,
	@StartTableNumber int = NULL
)
AS
BEGIN
	SET NOCOUNT ON;
      
    INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.4.0.64_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
    
	IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
    DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [SQLTableName],[ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
    DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName],[AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
    DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName],[AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 4) BEGIN
    DECLARE @BranchOfficeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select 'BranchOffice' AS [SQLTableName],[BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      Select 'BranchOffice' AS [SQLTableName|NVARCHAR|NOTNULL||],[BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber <= 5) BEGIN
    DECLARE @CalibrationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select 'Calibration' AS [SQLTableName],[CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable 
	END

	-- This is where the StartTableNumber check has to check the lower limit as well
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 2 AND @StartTableNumber <= 6) BEGIN
    DECLARE @CalibrationInformationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select 'CalibrationInformation' AS [SQLTableName],[CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 3 AND @StartTableNumber <= 7) BEGIN
    DECLARE @CalibrationInformationTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select 'CalibrationInformationType' AS [SQLTableName],[CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     Select [SQLTableName|NVARCHAR|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 8) BEGIN
    DECLARE @ClientSpecificElementTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select 'ClientSpecificElement' AS [SQLTableName],[ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 9) BEGIN
    DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'ClientSpecificElementIntMeaningExtended' AS [SQLTableName], [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 10) BEGIN
    DECLARE @DataCollectionCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'DataCollectionCategory' as [SQLTableName], [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 11) BEGIN
    DECLARE @DataCollectionCategoryTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select 'DataCollectionCategoryType' AS [SQLTableName],[DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 12) BEGIN
    DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName],[DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 13) BEGIN
    DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestionOptionOrInsert' AS [SQLTableName],[DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 14) BEGIN
    DECLARE @ElementIntMeaningTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select 'ElementIntMeaning' AS [SQLTableName],[ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 15) BEGIN
    DECLARE @ElementIntMeaningExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningExtended' AS [SQLTableName],[ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 16) BEGIN
    DECLARE @ElementIntMeaningSubOptionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select 'ElementIntMeaningSubOption' AS [SQLTableName],[ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     Select [SQLTableName|NVARCHAR|NOTNULL||],[ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 17) BEGIN
    DECLARE @EquipmentTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select 'Equipment' AS [SQLTableName], e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     Select [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 18) BEGIN
    DECLARE @EquipmentAssignedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentAssigned' AS [SQLTableName],[EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 19) BEGIN
    DECLARE @EquipmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select 'EquipmentCategory' AS [SQLTableName],[EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 20) BEGIN
    DECLARE @EquipmentCheckTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'EquipmentCheckType' AS [SQLTableName],[EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 21) BEGIN
    DECLARE @EquipmentIntervalCheckTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select 'EquipmentIntervalCheck' AS [SQLTableName],[IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      Select [SQLTableName|NVARCHAR|NOTNULL||],[IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 22) BEGIN
    DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' as [SQLTableName], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 23) BEGIN
    DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName],[MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 24) BEGIN
    DECLARE @QuoteVisitTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'QuoteVisitType' AS [SQLTableName],[QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 25) BEGIN
    DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName],[RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 26) BEGIN
    DECLARE @SampleClassificationTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select 'SampleClassification' AS [SQLTableName],[SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 27) BEGIN
    DECLARE @SampleClassificationExtendedTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select 'SampleClassificationExtended' AS [SQLTableName],[SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 28) BEGIN
    DECLARE @SampleResultTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select 'SampleResult' AS [SQLTableName],[SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      Select [SQLTableName|NVARCHAR|NOTNULL||],[SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 29) BEGIN
    DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName],[SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      Select [SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 30) BEGIN
    DECLARE @TableCodeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select 'TableCode' AS [SQLTableName],[TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [SQLTableName|NVARCHAR|NOTNULL||],[TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 31) BEGIN
    DECLARE @TemplateTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select 'TemplateType' AS [SQLTableName],[TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      Select [SQLTableName|NVARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 32) BEGIN
    DECLARE @StandardPhraseTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select 'StandardPhrase' AS [SQLTableName],[StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 33) BEGIN
    DECLARE @StandardPhraseCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select 'StandardPhraseCategory' AS [SQLTableName],[StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 30 AND @StartTableNumber <= 34) BEGIN
    DECLARE @StandardPhraseCategoryClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select 'StandardPhraseCategoryClient' AS [SQLTableName],[StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 31 AND @StartTableNumber <= 35) BEGIN
    DECLARE @StandardPhraseTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select 'StandardPhraseType' AS [SQLTableName],[StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      Select [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 32 AND @StartTableNumber <= 36) BEGIN
    DECLARE @StandardPhraseTypeClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select 'StandardPhraseTypeClient' AS [SQLTableName],[StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [SQLTableName|NVARCHAR|NOTNULL||],[StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 33 AND @StartTableNumber <= 37) BEGIN
    DECLARE @AirTestTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select 'AirTestType' AS [SQLTableName],[AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL AND (AirTestTypeID > 200 OR AirTestTypeID=2 OR AirTestTypeID=100)  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 34 AND @StartTableNumber <= 38) BEGIN
    DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName],[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 35 AND @StartTableNumber <= 39) BEGIN
    DECLARE @MobileURLFileTransferTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select 'MobileURLFileTransfer' AS [SQLTableName],[MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  
	END

	-- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------    
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 36 AND @StartTableNumber <= 40) BEGIN
		DECLARE @StandardProcedureTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,
			[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,
			[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL 
		)      
		
		INSERT INTO @StandardProcedureTable (
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
			[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedure' AS [SQLTableName],[StandardProcedureID],sp.[StandardProcedureTypeID],
			[StandardProcedure],[Version],[EmployeeID],[DateCreated],sp.[Deleted] 
		FROM 
			StandardProcedure  sp
			INNER JOIN StandardProcedureType t ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE 
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToLegionellaApp = 1
					
		SELECT 
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
			[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],
			[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTable 
	END

	-- StandardProcedureType ------------I split this up so I could read it: PJL---------------------------------------------
	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 37 AND @StartTableNumber <= 41) BEGIN
		DECLARE @StandardProcedureTypeTable TABLE (
			[SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
			[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL 
		)   
		
		INSERT INTO @StandardProcedureTypeTable (
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
		)      
		SELECT 
			'StandardProcedureType' AS [SQLTableName],t.[StandardProcedureTypeID],[StandardProcedureType],t.[Deleted] 
		FROM 
			StandardProcedureType  t
			INNER JOIN StandardProcedure sp ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
		WHERE
			StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
				AND
			t.bIsFile = 1
				AND
			sp.DownloadToLegionellaApp = 1
		
		SELECT 
			[SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
			[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] 
		FROM 
			@StandardProcedureTypeTable 
	END


	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 38 AND @StartTableNumber <= 42) BEGIN
    DECLARE @LegionellaAssetCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaAssetCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaAssetCategory' AS [SQLTableName], [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 39 AND @StartTableNumber <= 43) BEGIN
    DECLARE @LegionellaAssetOutletQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @LegionellaAssetOutletQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])  Select 'LegionellaAssetOutletQuestion' AS [SQLTableName], [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 40 AND @StartTableNumber <= 44) BEGIN
    DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaAssetOutletQuestionOptionOrInsert' AS [SQLTableName], [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 41 AND @StartTableNumber <= 45) BEGIN
    DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL ) INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])  Select 'LegionellaAssetOutletTaskAutoInsert' AS [SQLTableName], [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 42 AND @StartTableNumber <= 46) BEGIN
    DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaAssetOutletTaskQuestionTrigger' AS [SQLTableName], [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 43 AND @StartTableNumber <= 47) BEGIN
    DECLARE @LegionellaFrequencyCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaFrequencyCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaFrequencyCategory' AS [SQLTableName], [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 44 AND @StartTableNumber <= 48) BEGIN
    DECLARE @LegionellaOutletCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DefaultOutletCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @LegionellaOutletCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||])  Select 'LegionellaOutletCategory' AS [SQLTableName], [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted],[DefaultOutletCode] FROM LegionellaOutletCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||] FROM @LegionellaOutletCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 45 AND @StartTableNumber <= 49) BEGIN
    DECLARE @LegionellaPriorityRatingTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaPriorityRatingTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaPriorityRating' AS [SQLTableName], [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 46 AND @StartTableNumber <= 50) BEGIN
    DECLARE @LegionellaRiskCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaRiskCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaRiskCategory' AS [SQLTableName], [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 47 AND @StartTableNumber <= 51) BEGIN
    DECLARE @LegionellaRiskRatingTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaRiskRatingTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaRiskRating' AS [SQLTableName], [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 48 AND @StartTableNumber <= 52) BEGIN
    DECLARE @LegionellaSampleTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaSampleTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaSampleType' AS [SQLTableName], [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 49 AND @StartTableNumber <= 53) BEGIN
    DECLARE @LegionellaTaskAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL ) INSERT INTO @LegionellaTaskAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||]) Select 'LegionellaTaskAutoInsert' AS [SQLTableName], [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 50 AND @StartTableNumber <= 54) BEGIN
    DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )  INSERT INTO @LegionellaTaskAutoInsertClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])  Select 'LegionellaTaskAutoInsertClient' AS [SQLTableName], [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 51 AND @StartTableNumber <= 55) BEGIN
    DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @LegionellaTaskAutoInsertTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])  Select 'LegionellaTaskAutoInsertType' AS [SQLTableName], [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 52 AND @StartTableNumber <= 56) BEGIN
    DECLARE @LegionellaTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaType' AS [SQLTableName], [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 53 AND @StartTableNumber <= 57) BEGIN
    DECLARE @LegionellaTypeConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )  INSERT INTO @LegionellaTypeConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])  Select 'LegionellaTypeConfig' AS [SQLTableName], [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 54 AND @StartTableNumber <= 58) BEGIN
    DECLARE @OrgErrorCode TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ErrorCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ParentCodeID|INTEGER|NULL||] INT NULL ,[ExceptionMessage|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[orgErrorCodeID|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgErrorCode ([SQLTableName|NVARCHAR|NOTNULL||],[ErrorCodeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||]) Select 'OrgErrorCode' AS [SQLTableName], [ErrorCodeID],[Description],[ParentCodeID],[ExceptionMessage],[orgErrorCodeID] FROM OrgErrorCode SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ErrorCodeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||] FROM @OrgErrorCode
	END

	IF @StartTableNumber IS NULL OR (@StartTableNumber >= 55 AND @StartTableNumber <= 59) BEGIN
    DECLARE @OrgState TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [orgStateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgState ([SQLTableName|NVARCHAR|NOTNULL||],[orgStateID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||]) Select 'OrgState' AS [SQLTableName], [orgStateID],[ShortDescription],[Description] FROM orgState SELECT [SQLTableName|NVARCHAR|NOTNULL||],[orgStateID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||] FROM @OrgState
	END

      SET NOCOUNT OFF;
END
GO


IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.92_DataTransfer_StaticTables')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.92_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.92_DataTransfer_StaticTables]
(
  @ServerCode nvarchar(MAX) = '',
  @SystemName nvarchar(MAX),
  @Version nvarchar(MAX),
  @EmployeeID INT = 0,
  @DeviceGuid uniqueidentifier,
  @App VARCHAR(50),
  @Platform VARCHAR(50),
  @DbSizeMb INT,
  @DtsGuid uniqueidentifier = NULL,
  @StartTableNumber int = NULL
)
AS
BEGIN
  SET NOCOUNT ON;
      
    INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID,DeviceGuid,App,[Version],[Platform],[DatabaseSize],DtsGuid) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.4.0.92_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END, @DeviceGuid,@App,@Version,@Platform,@DbSizeMb,@DtsGuid
    
  IF @StartTableNumber IS NULL OR (@StartTableNumber = 1) BEGIN
    DECLARE @ConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select 'Config' AS [SQLTableName],[ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 2) BEGIN
    DECLARE @AppointmentTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT 'AppointmentType' AS [SQLTableName],[AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber <= 3) BEGIN
    DECLARE @AppointmentCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select 'AppointmentCategory' AS [SQLTableName],[AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     Select 'AppointmentCategory' AS [SQLTableName|NVARCHAR|NOTNULL||],[AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable 
  END
  
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 4 AND @StartTableNumber <= 9) BEGIN
    DECLARE @DataCollectionQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select 'DataCollectionQuestion' AS [SQLTableName],[DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 5 AND @StartTableNumber <= 10) BEGIN
    DECLARE @FloorplanImageItemTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select 'FloorplanImageItem' as [SQLTableName], [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [SQLTableName|NVARCHAR|NOTNULL||],[FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 6 AND @StartTableNumber <= 11) BEGIN
    DECLARE @MobileConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select 'MobileConfig' AS [SQLTableName],[MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [SQLTableName|NVARCHAR|NOTNULL||],[MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 7 AND @StartTableNumber <= 12) BEGIN
    DECLARE @RiskElementTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select 'RiskElementType' AS [SQLTableName],[RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL   SELECT [SQLTableName|NVARCHAR|NOTNULL||],[RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 8 AND @StartTableNumber <= 13) BEGIN
    DECLARE @SurveyTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select 'SurveyType' AS [SQLTableName],[SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      Select [SQLTableName|NVARCHAR|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable 
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 9 AND @StartTableNumber <= 14) BEGIN
    DECLARE @PhotoCollectionAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select 'PhotoCollectionAutoInsert' AS [SQLTableName],[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      Select [SQLTableName|NVARCHAR|NOTNULL||],[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable 
  END
  
  -- StandardProcedure ------------I split this up so I could read it: PJL---------------------------------------------    
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 10 AND @StartTableNumber <= 15) BEGIN
    DECLARE @StandardProcedureTable TABLE (
      [SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
      [StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,
      [Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,
      [DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL 
    )      
    
    INSERT INTO @StandardProcedureTable (
      [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
      [StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],
      [Deleted|DATETIME|NULL||]
    )      
    SELECT 
      'StandardProcedure' AS [SQLTableName],[StandardProcedureID],sp.[StandardProcedureTypeID],
      [StandardProcedure],[Version],[EmployeeID],[DateCreated],sp.[Deleted] 
    FROM 
      StandardProcedure  sp
      INNER JOIN StandardProcedureType t ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
    WHERE 
      StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
        AND
      t.bIsFile = 1
        AND
      sp.DownloadToLegionellaApp = 1
          
    SELECT 
      [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],
      [StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],
      [DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] 
    FROM 
      @StandardProcedureTable 
  END

  -- StandardProcedureType ------------I split this up so I could read it: PJL---------------------------------------------
  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 11 AND @StartTableNumber <= 16) BEGIN
    DECLARE @StandardProcedureTypeTable TABLE (
      [SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,
      [StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL 
    )   
    
    INSERT INTO @StandardProcedureTypeTable (
      [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
      [StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]
    )      
    SELECT 
      'StandardProcedureType' AS [SQLTableName],t.[StandardProcedureTypeID],[StandardProcedureType],t.[Deleted] 
    FROM 
      StandardProcedureType  t
      INNER JOIN StandardProcedure sp ON sp.StandardProcedureTypeID = t.StandardProcedureTypeID 
    WHERE
      StandardProcedureID in (SELECT max(StandardProcedureID) FROM Standardprocedure WHERE Deleted IS NULL GROUP BY StandardProcedureTypeID)
        AND
      t.bIsFile = 1
        AND
      sp.DownloadToLegionellaApp = 1
    
    SELECT 
      [SQLTableName|NVARCHAR|NOTNULL||],[StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],
      [StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] 
    FROM 
      @StandardProcedureTypeTable 
  END


  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 12 AND @StartTableNumber <= 17) BEGIN
    DECLARE @LegionellaAssetCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaAssetCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaAssetCategory' AS [SQLTableName], [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 13 AND @StartTableNumber <= 18) BEGIN
    DECLARE @LegionellaAssetOutletQuestionTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @LegionellaAssetOutletQuestionTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])  Select 'LegionellaAssetOutletQuestion' AS [SQLTableName], [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 14 AND @StartTableNumber <= 19) BEGIN
    DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaAssetOutletQuestionOptionOrInsert' AS [SQLTableName], [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 15 AND @StartTableNumber <= 20) BEGIN
    DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL ) INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])  Select 'LegionellaAssetOutletTaskAutoInsert' AS [SQLTableName], [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 16 AND @StartTableNumber <= 21) BEGIN
    DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaAssetOutletTaskQuestionTrigger' AS [SQLTableName], [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 17 AND @StartTableNumber <= 22) BEGIN
    DECLARE @LegionellaFrequencyCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaFrequencyCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaFrequencyCategory' AS [SQLTableName], [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 18 AND @StartTableNumber <= 23) BEGIN
    DECLARE @LegionellaOutletCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DefaultOutletCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @LegionellaOutletCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||])  Select 'LegionellaOutletCategory' AS [SQLTableName], [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted],[DefaultOutletCode] FROM LegionellaOutletCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaOutletCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DefaultOutletCode|VARCHAR|NULL||] FROM @LegionellaOutletCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 19 AND @StartTableNumber <= 24) BEGIN
    DECLARE @LegionellaPriorityRatingTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaPriorityRatingTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaPriorityRating' AS [SQLTableName], [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaPriorityRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 20 AND @StartTableNumber <= 25) BEGIN
    DECLARE @LegionellaRiskCategoryTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )  INSERT INTO @LegionellaRiskCategoryTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaRiskCategory' AS [SQLTableName], [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 21 AND @StartTableNumber <= 26) BEGIN
    DECLARE @LegionellaRiskRatingTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaRiskRatingTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaRiskRating' AS [SQLTableName], [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaRiskRatingID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 22 AND @StartTableNumber <= 27) BEGIN
    DECLARE @LegionellaSampleTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaSampleTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||]) Select 'LegionellaSampleType' AS [SQLTableName], [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaSampleTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 23 AND @StartTableNumber <= 28) BEGIN
    DECLARE @LegionellaTaskAutoInsertTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL ) INSERT INTO @LegionellaTaskAutoInsertTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||]) Select 'LegionellaTaskAutoInsert' AS [SQLTableName], [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 24 AND @StartTableNumber <= 29) BEGIN
    DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )  INSERT INTO @LegionellaTaskAutoInsertClientTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])  Select 'LegionellaTaskAutoInsertClient' AS [SQLTableName], [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 25 AND @StartTableNumber <= 30) BEGIN
    DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @LegionellaTaskAutoInsertTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])  Select 'LegionellaTaskAutoInsertType' AS [SQLTableName], [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 26 AND @StartTableNumber <= 31) BEGIN
    DECLARE @LegionellaTypeTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @LegionellaTypeTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])  Select 'LegionellaType' AS [SQLTableName], [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 27 AND @StartTableNumber <= 32) BEGIN
    DECLARE @LegionellaTypeConfigTable TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )  INSERT INTO @LegionellaTypeConfigTable ([SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])  Select 'LegionellaTypeConfig' AS [SQLTableName], [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig  SELECT [SQLTableName|NVARCHAR|NOTNULL||],[LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 28 AND @StartTableNumber <= 33) BEGIN
    DECLARE @OrgErrorCode TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [ErrorCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ParentCodeID|INTEGER|NULL||] INT NULL ,[ExceptionMessage|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[orgErrorCodeID|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgErrorCode ([SQLTableName|NVARCHAR|NOTNULL||],[ErrorCodeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||]) Select 'OrgErrorCode' AS [SQLTableName], [ErrorCodeID],[Description],[ParentCodeID],[ExceptionMessage],[orgErrorCodeID] FROM OrgErrorCode SELECT [SQLTableName|NVARCHAR|NOTNULL||],[ErrorCodeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ParentCodeID|INTEGER|NULL||],[ExceptionMessage|VARCHAR|NULL||],[orgErrorCodeID|VARCHAR|NULL||] FROM @OrgErrorCode
  END

  IF @StartTableNumber IS NULL OR (@StartTableNumber >= 29 AND @StartTableNumber <= 34) BEGIN
    DECLARE @OrgState TABLE ([SQLTableName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL, [orgStateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @OrgState ([SQLTableName|NVARCHAR|NOTNULL||],[orgStateID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||]) Select 'OrgState' AS [SQLTableName], [orgStateID],[ShortDescription],[Description] FROM orgState SELECT [SQLTableName|NVARCHAR|NOTNULL||],[orgStateID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||] FROM @OrgState
  END

      SET NOCOUNT OFF;
END
GO