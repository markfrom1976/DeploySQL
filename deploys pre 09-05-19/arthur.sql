-- IMPORTANT - DO NOT REMOVE --
USE [TEAMS]
GO
-- IMPORTANT - DO NOT REMOVE - END --

USE [TEAMS]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

SET ANSI_PADDING ON
GO
BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcIdMap'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcIdMap](
			[MobileDtcIdMapId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[TableName] [varchar](50) NOT NULL,
			[MobileId] [int] NOT NULL,
			[ServerId] [int] NOT NULL,
			[SetDtc] [bit] NULL,
		 CONSTRAINT [PK_MobileDtcIdMap_MobileDtcIdMapId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcIdMapId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]
	END 
COMMIT TRANSACTION
GO
SET ANSI_PADDING OFF
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

SET ANSI_PADDING ON
GO
BEGIN TRANSACTION 
	IF (not EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='dbo' AND TABLE_NAME='MobileDtcLog'))
	BEGIN
		CREATE TABLE [dbo].[MobileDtcLog](
			[MobileDtcLogId] [int] IDENTITY(1,1) NOT NULL,
			[SystemName] [varchar](50) NOT NULL,
			[App] [varchar](50) NOT NULL,
			[Source] [varchar](50) NOT NULL,
			[Step] [varchar](200) NOT NULL,
			[EmployeeId] [int] NOT NULL,
			[DateCreated] [datetime] NOT NULL,
			[DateCompleted] [datetime] NULL,
		 CONSTRAINT [PK_MobileDtcLog_MobileDtcLogId] PRIMARY KEY CLUSTERED 
		(
			[MobileDtcLogId] ASC
		)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
		) ON [PRIMARY]
	END 
COMMIT TRANSACTION
GO
SET ANSI_PADDING OFF
GO

---------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_NextSampleRefBySystemName]    Script Date: 06/20/2018 12:29:18 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO




ALTER PROC [dbo].[mobile_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC

	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated, EmployeeID)
			SELECT 2, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE(), @EmployeeID

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
	
END




GO
USE [TEAMS]
-- Config.
IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'LegionellaID' AND OBJECT_ID = OBJECT_ID('TestEmployee'))
BEGIN
    ALTER TABLE TestEmployee
    ADD [LegionellaID] int NULL
END
USE [TEAMS]
-- Config.
IF NOT EXISTS(SELECT * FROM sys.columns WHERE name = 'LegionellaID' AND OBJECT_ID = OBJECT_ID('TestSignOff'))
BEGIN
    ALTER TABLE TestSignOff
    ADD [LegionellaID] int NULL
END



USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[EnterpriseSiteData]    Script Date: 27/06/2018 09:47:20 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[EnterpriseSiteData]
(
      @SiteID INT,
      @RequestingServerCode VARCHAR(MAX),
	  @IncludePhotoNoColumn BIT = 0
)
AS
BEGIN
       SET NOCOUNT ON;

       DECLARE @LocalServerCode VARCHAR(MAX) = (SELECT s__ServerCode FROM Config)
       -- crack @ClientIDs into a table
       DECLARE @Clients TABLE ( ClientID INT )

       INSERT
              @Clients (ClientID)
       SELECT
              ClientID
       FROM
              ClientSite
       WHERE
              SiteID = @SiteID

       DECLARE @IDList TABLE (UseRoomCode INT, RegisterID INT, BuildingGUID VARCHAR(MAX), BuildingGUIDVersion INT, FloorplanID INT, FloorGUID VARCHAR(MAX), FloorGUIDVersion INT, RoomID INT, RoomGUID VARCHAR(MAX), RoomGUIDVersion INT, SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       Insert into @IDList (UseRoomCode, RegisterID,BuildingGUID,BuildingGUIDVersion,FloorplanID,FloorGUID, FloorGUIDVersion,RoomID,RoomGUID,RoomGUIDVersion,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT 
              CASE WHEN NULLIF(rm.RoomCode,'') IS NOT NULL THEN 1 ELSE 0 END,
              r.RegisterID,r.GUID [BuildingGUID],r.GUIDVersion [BuildingGUIDVersion],
              fp.FloorplanID,fp.GUID [FloorGUID],fp.GUIDVersion [FloorGUIDVersion],
              rm.RoomID,rm.GUID [RoomGUID],rm.GUIDVersion [RoomGUIDVersion],
              s.SampleID,s.GUID [ItemGUID],s.GUIDVersion [ItemGUIDVersion]
       FROM 
              (
                     SELECT 
                           j.JobID, j.SiteID
                     FROM
                           Job j WITH (NOLOCK)
                           INNER JOIN @Clients c ON j.ClientID=c.ClientID
                           INNER JOIN Quote q WITH (NOLOCK) ON j.JobID=q.JobID
                           INNER JOIN Appointment a WITH (NOLOCK) ON q.QuoteID=a.QuoteID
                     WHERE
                           a.DateDeclined IS NULL
                                  AND
                           j.Approved IS NOT NULL
              ) j
              INNER JOIN JobEmployee je WITH (NOLOCK) ON je.JobID = j.JobID
              INNER JOIN Register r WITH (NOLOCK) ON r.JobEmployeeID = je.JobEmployeeID
              LEFT OUTER JOIN Floorplan fp WITH (NOLOCK) ON fp.RegisterID = r.RegisterID
              LEFT OUTER JOIN Room rm WITH (NOLOCK) ON fp.FloorplanID = rm.FloorplanID
              LEFT OUTER JOIN Sample s WITH (NOLOCK) ON s.RoomID = rm.RoomID
       WHERE 
              j.SiteID=@SiteID

       SELECT
              main.TableName, main.RegisterID, main.BuildingGUID, main.BuildingGUIDVersion, p.PhotoID, p.PhotoData, p.ContentType,
              r.RegisterStart, r.RegisterFinish, r.BuildingDesignation, r.Notes, r.SystemName, main.UseRoomCode
       FROM
              (
                     Select
                           'Register' [TableName], _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                  MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RegisterID,BuildingGUID,BuildingGUIDVersion
                     ) _r
                     WHERE
                           _r.Identifier = 1
              ) main
              INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
              LEFT OUTER JOIN Photo p WITH (NOLOCK) ON r.PhotoID=p.PhotoID
       
       SELECT --may need to fix this for the store system! / MobileConfigTypeID 76?
              main.TableName, main.ParentGUID, main.FloorplanID, main.FloorGUID, main.FloorGUIDVersion,
              fp.FloorNumber, 
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadData ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanData END END [FloorplanData],
              CASE WHEN (fp.AutocadData IS NOT NULL AND fp.AutocadDataContentType NOT LIKE '%pdf%') THEN fp.AutocadDataContentType ELSE CASE WHEN fp.FloorplanData IS NOT NULL THEN fp.FloorplanDataContentType END END [ContentType]
       FROM
              (      
                     Select
                           'Floorplan' [TableName], _f.FloorplanID,ParentGUID,FloorGUID,FloorGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY FloorGUID Order by FloorGUIDVersion DESC) [Identifier],
                                  FloorplanID,BuildingGUID [ParentGUID],FloorGUID,FloorGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  FloorplanID,BuildingGUID,FloorGUID,FloorGUIDVersion
                     ) _f
                     WHERE
                           _f.Identifier = 1
              ) main
              INNER JOIN Floorplan fp WITH (NOLOCK) ON fp.FloorplanID=main.FloorplanID
       
       SELECT
              main.TableName, main.ParentGUID, main.RoomID, main.RoomGUID, main.RoomGUIDVersion,
              rm.Number,rm.[Description], rm.Notes, rm.RandD, rm.Inaccessible, rm.RoomCode
       FROM
              (
                     Select
                           'Room' [TableName], _rm.RoomID,ParentGUID,RoomGUID,RoomGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY RoomGUID Order by RoomGUIDVersion DESC) [Identifier],
                                  RoomID,FloorGUID [ParentGUID],RoomGUID,RoomGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  RoomID,FloorGUID,RoomGUID,RoomGUIDVersion
                     ) _rm
                     WHERE
                           _rm.Identifier = 1
              ) main
              INNER JOIN Room rm WITH (NOLOCK) ON main.RoomID=rm.RoomID
       
       DECLARE @GuidSamples TABLE (TableName VARCHAR(MAX), ParentGUID VARCHAR(MAX), SampleID INT, ItemGUID VARCHAR(MAX), ItemGUIDVersion INT)
       
       INSERT INTO @GuidSamples (TableName,ParentGUID,SampleID,ItemGUID,ItemGUIDVersion)
       SELECT
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion
       FROM
              (      
                     Select
                           'Sample' [TableName], _s.SampleID,ParentGUID,ItemGUID,ItemGUIDVersion
                     FROM
                     (
                           SELECT
                                  ROW_NUMBER() OVER (Partition BY ItemGUID Order by ItemGUIDVersion DESC) [Identifier],
                                  SampleID,RoomGUID [ParentGUID],ItemGUID,ItemGUIDVersion
                           FROM
                                  @IDList
                           GROUP BY
                                  SampleID,RoomGUID,ItemGUID,ItemGUIDVersion
                     ) _s
                     WHERE
                           _s.Identifier = 1
              ) main
              INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
              INNER JOIN GuidSamples gs WITH (NOLOCK) ON gs.SampleId=s.SampleID AND gs.SiteId=@SiteID
              INNER JOIN @Clients c ON gs.ClientID=c.ClientID
       GROUP BY
              main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion

	   IF @IncludePhotoNoColumn = 1
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, p.PhotoNo, s.SampleRef, s.AsSample,  
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID

		ELSE
		   SELECT
				main.TableName, main.ParentGUID, main.SampleID, main.ItemGUID, main.ItemGUIDVersion,
				s.RegisterItemNo,p.PhotoID,p.PhotoData, s.SampleRef, s.AsSample, 
				s.SampleResultID, s.SampleClassificationID, 
				sce.SampleClassification + ' (' + CAST(sc.Value as varchar) + ')' [SampleClassificationExtended], --Need the string for comparison
				s.Notes, s.DateAnalysed, CASE WHEN s.EmployeeID IS NOT NULL THEN 0 END [Employee]
			FROM
				@GuidSamples main
				INNER JOIN Sample s WITH (NOLOCK) ON main.SampleID=s.SampleID AND s.Archived=0
				LEFT OUTER JOIN Photo p WITH (NOLOCK) ON s.PhotoID=p.PhotoID
				LEFT OUTER JOIN SampleClassification sc WITH (NOLOCK) ON sc.SampleClassificationID=s.SampleClassificationID
				LEFT OUTER JOIN SampleClassificationExtended sce WITH (NOLOCK) ON sce.SampleClassificationExtendedID=s.SampleClassificationExtendedID
       
       SELECT
              main.TableName,
              main.SampleID,
              main.RegisterID,
              main.ElementTypeID,
              main.ElementText
       FROM
       (
              SELECT
                     'Element' [TableName],
                     e.SampleID, 
                     NULL [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     @GuidSamples main
                     INNER JOIN Element e WITH (NOLOCK) ON main.SampleID=e.SampleID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     e.ElementTypeID NOT IN (32)
              UNION
              SELECT
                     'Element' [TableName],
                     NULL [SampleID], 
                     e.RegisterID [RegisterID],
                     e.ElementTypeID,
                     CASE WHEN e.ElementText IS NOT NULL THEN
                           e.ElementText
                     ELSE
                           CASE WHEN e.ElementTypeID = 20 THEN
                                  ISNULL(eime.Description,eim.Description)
                           ELSE
                                  CASE WHEN e.ElementTypeID = 32 THEN
                                         CAST(e.ElementIntID as varchar)
                                  ELSE
                                         ISNULL(eime.Description,eim.Description) + ' (' + CAST(eim.ElementIntValue as varchar) + ')'
                                  END
                           END
                     END [ElementText]
              FROM
                     (
                           Select
                                  _r.RegisterID, NULL [ParentGUID],BuildingGUID,BuildingGUIDVersion, _r.UseRoomCode
                           FROM
                           (
                                  SELECT
                                         ROW_NUMBER() OVER (Partition BY BuildingGUID Order by BuildingGUIDVersion DESC) [Identifier],
                                         MAX(UseRoomCode) [UseRoomCode], RegisterID,BuildingGUID,BuildingGUIDVersion
                                  FROM
                                         @IDList
                                  GROUP BY
                                         RegisterID,BuildingGUID,BuildingGUIDVersion
                           ) _r
                           WHERE
                                  _r.Identifier = 1
                     ) main
                     INNER JOIN Register r WITH (NOLOCK) ON r.RegisterID = main.RegisterID
                     INNER JOIN Element e WITH (NOLOCK) ON e.RegisterID=r.RegisterID
                     LEFT OUTER JOIN ElementIntMeaning eim WITH (NOLOCK) ON e.ElementIntMeaningID=eim.ElementIntMeaningID
                     LEFT OUTER JOIN ElementIntMeaningExtended eime WITH (NOLOCK) ON eime.ElementIntMeaningExtendedID=e.ElementIntMeaningExtendedID
              WHERE
                     CASE WHEN e.ElementTypeID IN (140,141,142) THEN 
                           1 
                     ELSE
                           CASE WHEN @RequestingServerCode = @LocalServerCode THEN 1 ELSE 0 END 
                     END = 1
       ) main
       
       SET NOCOUNT OFF;
END

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
End

GO

USE [TEAMS]
GO

/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]    Script Date: 03/07/2018 10:38:54 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment] AS BEGIN SET NOCOUNT ON; END')
End

GO

ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_JobQuoteAppointment]
(
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT,
	@AppointmentWindowDate DATETIME = NULL,
	@QuoteList VARCHAR(MAX) = '',
	@ExtraClientIds VARCHAR(MAX) = '',
	@ExtraSiteIds VARCHAR(MAX) = ''
)
AS
BEGIN
	SET NOCOUNT ON;
	
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @AppointmentWindowDate = ISNULL(@AppointmentWindowDate,GETDATE())
	
	DECLARE @JobQuoteAppointmentIDList TABLE (ClientID INT, SiteID INT,JobID INT, QuoteID INT, AppointmentID INT)
	INSERT INTO @JobQuoteAppointmentIDList (ClientID,SiteID,JobID,QuoteID,AppointmentID)
	SELECT 
		q.ClientID,
		q.SiteID,
		j.JobID,
		q.QuoteID,
		a.AppointmentID
	FROM 
		Quote q
		INNER JOIN Site si ON q.SiteID = si.SiteID
		INNER JOIN Client c ON c.ClientID = q.ClientID
		INNER JOIN Appointment a ON q.QuoteID=a.QuoteID
		INNER JOIN AppointmentEmployee ae ON a.AppointmentID = ae.AppointmentID 
		LEFT OUTER JOIN Project p ON a.ProjectID = p.ProjectID 
		LEFT OUTER JOIN Job j ON q.JobID = j.JobID
	WHERE 
		@AppointmentWindowDate BETWEEN DATEADD(DAY,-6, a.StartTime) AND DATEADD(DAY, 3, a.EndTime)
			AND 
		ae.EmployeeID=@EmployeeID
			AND 
		a.DateDeclined IS NULL

	INSERT INTO @JobQuoteAppointmentIDList (ClientID)
	SELECT
		a.ClientID
	FROM
	(
		SELECT 
			ClientID
		FROM
			ClientSpecificElement
		UNION
		SELECT
			s [ClientID]
		FROM
			dbo.SplitString(@ExtraClientIds,',')
	) a
	GROUP BY
		a.ClientID

/*
	ORIGINAL
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL] INT NOT NULL ,[Email|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL]) Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID SELECT [ClientID|INTEGER|NOTNULL],[Email|VARCHAR|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Fax|VARCHAR|NOTNULL],[MainContact|VARCHAR|NOTNULL],[EnterpriseServerCode|VARCHAR|NULL] FROM @ClientTable
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL] INT NOT NULL ,[Telephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL]) Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID	SELECT [SiteID|INTEGER|NOTNULL],[Telephone|VARCHAR|NOTNULL],[Contact|VARCHAR|NOTNULL],[UPRN|VARCHAR|NULL],[ClientOrderNumber|VARCHAR|NULL],[TEAMSUPRN|VARCHAR|NULL] FROM @SiteTable
	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NULL] INT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[StartTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL] INT NULL ,[DateConfirmed|DATETIME|NULL] DATETIME NULL ,[DateDeclined|DATETIME|NULL] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL] INT NULL ,[AppointmentGroupId|INTEGER|NULL] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0))) INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID SELECT [AppointmentID|INTEGER|NOTNULL],[AppointmentTypeID|INTEGER|NOTNULL],[ClientID|INTEGER|NULL],[SiteID|INTEGER|NULL],[StartTime|DATETIME|NOTNULL],[EndTime|DATETIME|NOTNULL],[Notes|VARCHAR|NOTNULL],[ClientOrderNo|VARCHAR|NOTNULL],[DateCreated|DATETIME|NOTNULL],[QuoteID|INTEGER|NULL],[DateConfirmed|DATETIME|NULL],[DateDeclined|DATETIME|NULL],[AppointmentCategoryID|INTEGER|NULL],[ProjectAppointmentId|INTEGER|NULL],[AppointmentGroupId|INTEGER|NULL],[BranchOfficeID|INTEGER|NOTNULL] FROM @AppointmentTable
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL] INT NOT NULL ,[JobNo|INTEGER|NOTNULL] INT NOT NULL ,[ClientID|INTEGER|NOTNULL] INT NOT NULL ,[SiteID|INTEGER|NULL] INT NULL ,[ClientOrderNo|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL] INT NULL) INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID SELECT [JobID|INTEGER|NOTNULL],[JobNo|INTEGER|NOTNULL],[ClientID|INTEGER|NOTNULL],[SiteID|INTEGER|NULL],[ClientOrderNo|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[ProjectManagerID|INTEGER|NULL] FROM @JobTable
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL] INT NULL ,[QuoteNo|INTEGER|NOTNULL] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL] DATETIME NULL ,[JobID|INTEGER|NULL] INT NULL ,[Rejected|DATETIME|NULL] DATETIME NULL ,[Exclusions|VARCHAR|NULL] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID	SELECT [QuoteID|INTEGER|NOTNULL],[QuoteTypeID|INTEGER|NULL],[QuoteNo|INTEGER|NOTNULL],[ScopeOfWork|VARCHAR|NOTNULL],[Status|VARCHAR|NULL],[Created|DATETIME|NOTNULL],[Accepted|DATETIME|NULL],[JobID|INTEGER|NULL],[Rejected|DATETIME|NULL],[Exclusions|VARCHAR|NULL] FROM @QuoteTable
*/
/*
	--Select c.[ClientID],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] FROM Client c WITH (NOLOCK) INNER JOIN (SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID) jqa ON c.ClientID=jqa.ClientID
	--Select si.[SiteID],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] FROM Site si WITH (NOLOCK) INNER JOIN (SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID) jqa ON si.SiteID=jqa.SiteID
	--Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID 
	--Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID] FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID
	--Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID
*/
	--DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NULL||] DATETIME NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID],asu.[DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||] FROM @AppointmentSurveyTable GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NULL||]
	DECLARE @AppointmentSurveyTable TABLE ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL,[SurveyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[PropertyTypeID|INTEGER|NOTNULL||] INT NOT NULL,[DueDate|DATETIME|NOTNULL||] DATETIME NOT NULL)	INSERT INTO @AppointmentSurveyTable ([AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]) Select asu.[AppointmentSurveyID],asu.[AppointmentID],asu.[SurveyTypeID],asu.[PropertyTypeID], ISNULL(asu.[DueDate], GETDATE()) [DueDate] FROM AppointmentSurvey asu WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=asu.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||] FROM @AppointmentSurveyTable WHERE @DisableFunctionality > 0 GROUP BY [AppointmentSurveyID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[SurveyTypeID|INTEGER|NOTNULL||],[PropertyTypeID|INTEGER|NOTNULL||],[DueDate|DATETIME|NOTNULL||]
	DECLARE @AppointmentAirMonitoringTable TABLE ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[NumberOfPumps|INTEGER|NOTNULL||] INT NOT NULL,[RemovalContractorID|INTEGER|NOTNULL|Client|] INT NOT NULL,[SampleResultID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentAirMonitoringTable ([AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||]) Select aam.[AppointmentAirMonitoringID],aam.[AppointmentID],aam.[NumberOfPumps],aam.[RemovalContractorID],aam.SampleResultID FROM AppointmentAirMonitoring aam WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  
	
	--------------------------------------------------------
	-- Clients - PJL: I split these up so I could read them!
	DECLARE @ClientTable TABLE ([ClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientAddress|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL  ,[Email|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Fax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MainContact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EnterpriseServerCode|VARCHAR|NULL||] VARCHAR(MAX) NULL )	
	
	INSERT INTO @ClientTable ([ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||]) 
		Select 
			c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
		FROM 
			Client c WITH (NOLOCK) 
			INNER JOIN (
				SELECT ClientID FROM @JobQuoteAppointmentIDList WHERE ClientID IS NOT NULL GROUP BY ClientID 
					UNION 
				SELECT [RemovalContractorID|INTEGER|NOTNULL|Client|] [ClientID] FROM @AppointmentAirMonitoringTable GROUP BY [RemovalContractorID|INTEGER|NOTNULL|Client|]
					UNION
				SELECT ClientID FROM StandardPhraseCategoryClient GROUP BY ClientID
					UNION
				SELECT ClientID FROM StandardPhraseTypeClient GROUP BY ClientID
			) jqa ON c.ClientID=jqa.ClientID 
	GROUP BY
		c.[ClientID],c.[Client],c.[Address],c.[Email],c.[Telephone],c.[Fax],c.[MainContact],c.[EnterpriseServerCode] 
	SELECT [ClientID|INTEGER|NOTNULL||SERVERKEY],[ClientName|VARCHAR|NOTNULL||],[ClientAddress|VARCHAR|NOTNULL||],[Email|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Fax|VARCHAR|NOTNULL||],[MainContact|VARCHAR|NOTNULL||],[EnterpriseServerCode|VARCHAR|NULL||] FROM @ClientTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	--------------------------------------------------------
	-- Sites - PJL: I split these up so I could read them!
	DECLARE @SiteTable TABLE ([SiteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SiteAddress|VARCHAR|NOTNULL||] VARCHAR(MAX), [Telephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Contact|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[UPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ClientOrderNumber|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TEAMSUPRN|VARCHAR|NULL||] VARCHAR(MAX) NULL )

	INSERT INTO @SiteTable ([SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||]) 
		Select 
			si.[SiteID],si.[Address] + ', ' + si.[Postcode] [SiteAddress],si.[Telephone],si.[Contact],si.[UPRN],si.[ClientOrderNumber],si.[TEAMSUPRN] 
		FROM 
			Site si WITH (NOLOCK) 
			INNER JOIN (
				SELECT SiteID FROM @JobQuoteAppointmentIDList WHERE SiteID IS NOT NULL GROUP BY SiteID UNION SELECT s [SiteID] FROM dbo.SplitString(@ExtraSiteIds,',')
			) jqa ON si.SiteID=jqa.SiteID	

	SELECT [SiteID|INTEGER|NOTNULL||SERVERKEY],[SiteAddress|VARCHAR|NOTNULL||],[Telephone|VARCHAR|NOTNULL||],[Contact|VARCHAR|NOTNULL||],[UPRN|VARCHAR|NULL||],[ClientOrderNumber|VARCHAR|NULL||],[TEAMSUPRN|VARCHAR|NULL||] FROM @SiteTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------

	--------------------------------------------------------
	-- Sites - JSM: This needs to be after the client
	SELECT [AppointmentAirMonitoringID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[NumberOfPumps|INTEGER|NOTNULL||],[RemovalContractorID|INTEGER|NOTNULL|Client|],[SampleResultID|INTEGER|NULL||] FROM @AppointmentAirMonitoringTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringTypeTable TABLE ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringTypeTable ([AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||]) Select aamt.[AppointmentAirMonitoringTypeID],aamt.[AppointmentAirMonitoringID],aamt.[AirTestTypeID] FROM AppointmentAirMonitoringType aamt WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam WITH (NOLOCK) ON aamt.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringTypeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringTypeTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentAirMonitoringSampleClassificationTable TABLE ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentAirMonitoringID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL)	INSERT INTO @AppointmentAirMonitoringSampleClassificationTable ([AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||]) Select aamsc.[AppointmentAirMonitoringSampleClassificationID],aamsc.[AppointmentAirMonitoringID],aamsc.[SampleClassificationID] FROM AppointmentAirMonitoringSampleClassification aamsc WITH (NOLOCK) INNER JOIN AppointmentAirMonitoring aam  WITH (NOLOCK) ON aamsc.AppointmentAirMonitoringID=aam.AppointmentAirMonitoringID INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=aam.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentAirMonitoringSampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[AppointmentAirMonitoringID|INTEGER|NOTNULL||],[SampleClassificationID|INTEGER|NOTNULL||] FROM @AppointmentAirMonitoringSampleClassificationTable WHERE @DisableFunctionality > 0
	--------------------------------------------------------


	DECLARE @AppointmentTable TABLE ([AppointmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NULL|Client|] INT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[StartTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[EndTime|DATETIME|NOTNULL||] DATETIME NOT NULL ,[Notes|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ClientOrderNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteID|INTEGER|NULL||] INT NULL ,[DateConfirmed|DATETIME|NULL||] DATETIME NULL ,[DateDeclined|DATETIME|NULL||] DATETIME NULL ,[AppointmentCategoryID|INTEGER|NULL||] INT NULL DEFAULT (NULL),[ProjectAppointmentId|INTEGER|NULL||] INT NULL ,[AppointmentGroupId|INTEGER|NULL||] INT NULL ,[BranchOfficeID|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))	INSERT INTO @AppointmentTable ([AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||]) Select a.[AppointmentID],a.[AppointmentTypeID],a.[ClientID],a.[SiteID],a.[StartTime],a.[EndTime],a.[Notes],a.[ClientOrderNo],a.[DateCreated],a.[QuoteID],a.[DateConfirmed],a.[DateDeclined],a.[AppointmentCategoryID],a.[ProjectAppointmentId],a.[AppointmentGroupId],a.[BranchOfficeID] FROM Appointment a WITH (NOLOCK) INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentID|INTEGER|NOTNULL||SERVERKEY],[AppointmentTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NULL|Client|],[SiteID|INTEGER|NULL|Site|],[StartTime|DATETIME|NOTNULL||],[EndTime|DATETIME|NOTNULL||],[Notes|VARCHAR|NOTNULL||],[ClientOrderNo|VARCHAR|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[QuoteID|INTEGER|NULL||],[DateConfirmed|DATETIME|NULL||],[DateDeclined|DATETIME|NULL||],[AppointmentCategoryID|INTEGER|NULL||],[ProjectAppointmentId|INTEGER|NULL||],[AppointmentGroupId|INTEGER|NULL||],[BranchOfficeID|INTEGER|NOTNULL||] FROM @AppointmentTable WHERE @DisableFunctionality > 0
	DECLARE @AppointmentEmployeeTable TABLE ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AppointmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NULL||] INT NULL)	INSERT INTO @AppointmentEmployeeTable ([AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||]) Select ae.[AppointmentEmployeeID],ae.[AppointmentID],ae.[EmployeeID] FROM AppointmentEmployee ae WITH (NOLOCK) INNER JOIN Appointment a WITH (NOLOCK) ON a.AppointmentID=ae.AppointmentID INNER JOIN (SELECT AppointmentID FROM @JobQuoteAppointmentIDList WHERE AppointmentID IS NOT NULL GROUP BY AppointmentID) jqa ON jqa.AppointmentID=a.AppointmentID  SELECT [AppointmentEmployeeID|INTEGER|NOTNULL||SERVERKEY],[AppointmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NULL||] FROM @AppointmentEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @JobTable TABLE ([JobID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[JobNo|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[SiteID|INTEGER|NULL|Site|] INT NULL ,[ClientOrderNo|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[ProjectManagerID|INTEGER|NULL||] INT NULL,[HasSiteData|INTEGER|NULL||] INT NULL,[Notes|VARCHAR|NULL||] VARCHAR(MAX),[RemovalContracterID|INTEGER|NULL|Client|] INT NULL)	INSERT INTO @JobTable ([JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|]) Select j.[JobID],j.[JobNo],j.[ClientID],j.[SiteID],j.[ClientOrderNo],j.[Created],j.[ProjectManagerID],CASE WHEN sd.DataCount > 0 THEN 1 END [HasSiteData],(SELECT top 1 a.Notes FROM @JobQuoteAppointmentIDList jqal INNER JOIN Appointment a WITH (NOLOCK) ON jqal.AppointmentID=a.AppointmentID WHERE jqal.JobID=j.JobID) ,(SELECT top 1 aam.[RemovalContractorID|INTEGER|NOTNULL|Client|] FROM @JobQuoteAppointmentIDList jqal INNER JOIN @AppointmentAirMonitoringTable aam ON jqal.AppointmentID=aam.[AppointmentID|INTEGER|NOTNULL||] WHERE jqal.JobID=j.JobID) FROM Job j WITH (NOLOCK) INNER JOIN (SELECT JobID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL GROUP BY JobID) jqa ON j.JobID = jqa.JobID OUTER APPLY (SELECT COUNT(*) [DataCount] FROM Site subSi WITH (NOLOCK) INNER JOIN Job subJ WITH (NOLOCK) ON subSi.SiteID=subJ.SiteID INNER JOIN JobEmployee subje WITH (NOLOCK) ON subje.JobID=subj.JobID INNER JOIN Register subr WITH (NOLOCK) ON subje.JobEmployeeID=subr.JobEmployeeID INNER JOIN Floorplan subfp WITH (NOLOCK) ON subfp.RegisterID=subr.RegisterID WHERE subSi.SiteID=j.SiteID) sd SELECT [JobID|INTEGER|NOTNULL||SERVERKEY],[JobNo|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[SiteID|INTEGER|NULL|Site|],[ClientOrderNo|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[ProjectManagerID|INTEGER|NULL||],[HasSiteData|INTEGER|NULL||],[Notes|VARCHAR|NULL||],[RemovalContracterID|INTEGER|NULL|Client|] FROM @JobTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteTable TABLE ([QuoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteTypeID|INTEGER|NULL||] INT NULL ,[QuoteNo|INTEGER|NOTNULL||] INT NOT NULL ,[ScopeOfWork|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Status|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Accepted|DATETIME|NULL||] DATETIME NULL ,[JobID|INTEGER|NULL|Job|] INT NULL ,[Rejected|DATETIME|NULL||] DATETIME NULL ,[Exclusions|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @QuoteTable ([QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||]) Select q.[QuoteID],q.[QuoteTypeID],q.[QuoteNo],q.[ScopeOfWork],q.[Status],q.[Created],q.[Accepted],q.[JobID],q.[Rejected],q.[Exclusions] FROM Quote q WITH (NOLOCK) INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) jqa ON q.QuoteID=jqa.QuoteID SELECT [QuoteID|INTEGER|NOTNULL||SERVERKEY],[QuoteTypeID|INTEGER|NULL||],[QuoteNo|INTEGER|NOTNULL||],[ScopeOfWork|VARCHAR|NOTNULL||],[Status|VARCHAR|NULL||],[Created|DATETIME|NOTNULL||],[Accepted|DATETIME|NULL||],[JobID|INTEGER|NULL|Job|],[Rejected|DATETIME|NULL||],[Exclusions|VARCHAR|NULL||] FROM @QuoteTable WHERE @DisableFunctionality > 0

	DECLARE @QuoteEmployeeTable TABLE ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[ScheduledStart|DATETIME|NULL||] DATETIME NULL ,[ScheduledFinish|DATETIME|NULL||] DATETIME NULL ,[ActualStart|DATETIME|NULL||] DATETIME NULL ,[ActualFinish|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @QuoteEmployeeTable ([QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||])	Select qe.[QuoteEmployeeID],qe.[QuoteID],qe.[EmployeeID],qe.[ScheduledStart],qe.[ScheduledFinish],qe.[ActualStart],qe.[ActualFinish] FROM QuoteEmployee qe INNER JOIN (SELECT QuoteID FROM @JobQuoteAppointmentIDList WHERE QuoteID IS NOT NULL GROUP BY QuoteID) q ON qe.QuoteID=q.QuoteID AND qe.EmployeeID>0 SELECT [QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY],[QuoteID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[ScheduledStart|DATETIME|NULL||],[ScheduledFinish|DATETIME|NULL||],[ActualStart|DATETIME|NULL||],[ActualFinish|DATETIME|NULL||] FROM @QuoteEmployeeTable WHERE @DisableFunctionality > 0
	DECLARE @QuoteVisitTable TABLE ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[QuoteEmployeeID|INTEGER|NULL||] INT NULL ,[QuoteVisitStart|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[QuoteVisitFinish|DATETIME|NULL||] DATETIME NULL ,[Notes|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoID|INTEGER|NULL||] INT NULL ,[SystemName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Closed|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Finished|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignatureID|INTEGER|NULL||] INT NULL ,[_QuoteVisitConsumableMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL ,[_QuoteVisitLabourMarkup|DECIMAL|NULL||] DECIMAL(38,38) NULL )	INSERT INTO @QuoteVisitTable ([QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||]) Select qv.[QuoteVisitID],qv.[QuoteVisitTypeID],qv.[QuoteEmployeeID],qv.[QuoteVisitStart],qv.[QuoteVisitFinish],qv.[Notes],qv.[PhotoID],qv.[SystemName],qv.[Closed],qv.[Finished],qv.[SignatureID],qv.[_QuoteVisitConsumableMarkup],qv.[_QuoteVisitEquipmentMarkup],qv.[_QuoteVisitLabourMarkup] FROM QuoteVisit qv INNER JOIN @QuoteEmployeeTable qet ON qet.[QuoteEmployeeID|INTEGER|NOTNULL||SERVERKEY]=qv.QuoteEmployeeID	SELECT [QuoteVisitID|INTEGER|NOTNULL||SERVERKEY],[QuoteVisitTypeID|INTEGER|NOTNULL||],[QuoteEmployeeID|INTEGER|NULL||],[QuoteVisitStart|DATETIME|NOTNULL||],[QuoteVisitFinish|DATETIME|NULL||],[Notes|VARCHAR|NULL||],[PhotoID|INTEGER|NULL||],[SystemName|VARCHAR|NOTNULL||],[Closed|BIT|NOTNULL||],[Finished|BIT|NOTNULL||],[SignatureID|INTEGER|NULL||],[_QuoteVisitConsumableMarkup|DECIMAL|NULL||],[_QuoteVisitEquipmentMarkup|DECIMAL|NULL||],[_QuoteVisitLabourMarkup|DECIMAL|NULL||] FROM @QuoteVisitTable WHERE @DisableFunctionality > 0
	DECLARE @DataCollectionTable TABLE ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[DataText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataInt|INTEGER|NULL||] INT NULL ,[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[QuoteVisitID|INTEGER|NULL||] INT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL )	INSERT INTO @DataCollectionTable ([DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||])	Select dc.[DataCollectionID],dc.[DataCollectionQuestionID],dc.[DataText],dc.[DataInt],dc.[DataCollectionQuestionOptionOrInsertID],dc.[Deleted],dc.[QuoteVisitID],dc.[DataCollectionCategoryTypeID] FROM DataCollection	dc INNER JOIN @QuoteVisitTable qvt ON dc.QuoteVisitID=qvt.[QuoteVisitID|INTEGER|NOTNULL||SERVERKEY] SELECT [DataCollectionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[DataText|VARCHAR|NULL||],[DataInt|INTEGER|NULL||],[DataCollectionQuestionOptionOrInsertID|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[QuoteVisitID|INTEGER|NULL||],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] FROM @DataCollectionTable WHERE @DisableFunctionality > 0

	DECLARE @NoAccessTable TABLE ([NoAccessID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[JobID|INTEGER|NOTNULL|Job|] INT NOT NULL,[PhotoID|INTEGER|NULL||] INT NULL,[Comment|VARCHAR|NULL||] VARCHAR(MAX) NULL,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL,[SignatureID|INTEGER|NOTNULL||] INT NOT NULL,[Completed|INTEGER|NOTNULL||] INT NOT NULL,[PreviousNoAccess|INTEGER|NOTNULL||] INT NOT NULL,[DTC|INTEGER|NOTNULL||] INT NOT NULL,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL) INSERT INTO @NoAccessTable ([NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||]) SELECT na.NoAccessID,na.JobID,0,na.Comment,na.EmployeeID,0,1,1,1,na.Created FROM NoAccess na WITH (NOLOCK) INNER JOIN (SELECT JobID,SiteID FROM @JobQuoteAppointmentIDList WHERE JobID IS NOT NULL AND SiteID IS NOT NULL GROUP BY JobID,SiteID) jqa ON jqa.JobID = na.JobID SELECT [NoAccessID|INTEGER|NOTNULL||SERVERKEY],[JobID|INTEGER|NOTNULL|Job|],[PhotoID|INTEGER|NULL||],[Comment|VARCHAR|NULL||],[EmployeeID|INTEGER|NOTNULL||],[SignatureID|INTEGER|NOTNULL||],[Completed|INTEGER|NOTNULL||],[PreviousNoAccess|INTEGER|NOTNULL||],[DTC|INTEGER|NOTNULL||],[Created|DATETIME|NOTNULL||] FROM @NoAccessTable WHERE @DisableFunctionality > 0


	SET NOCOUNT OFF;
END



GO


If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
End

GO

USE [TEAMS]
GO
/****** Object:  StoredProcedure [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables]    Script Date: 03/07/2018 10:39:00 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER PROC [dbo].[mobile_Airtest_v1.0.0.8_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
	  DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	  INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL ,[BranchOfficeID|INTEGER|NULL||] INTEGER NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked], BranchOfficeID from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased,e.BranchOfficeID     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||],[BranchOfficeID|INTEGER|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0

      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable WHERE @DisableFunctionality>0
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable WHERE @DisableFunctionality>0
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])  Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryTypeID],REPLACE([Description],'Summary','Questions'),[AirTestDynamicTabNo],REPLACE([AirTestTabName],'Summary','Questions'),[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType   WHERE AirTesttabName != 'Sampling Locations' SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[InspectionLabelID|INTEGER|NULL||] INT NULL,[InspectionChoiceID|INTEGER|NULL||] INT NULL,[ElementTypeID|INTEGER|NULL||] INT NULL,[ResultTypeID|INTEGER|NULL||] INT NULL,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL,[Deleted|DATETIME|NULL||] DATETIME NULL,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollection|INTEGER|NULL||] INT NULL,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionSuffix|VARCHAR|NULL||] VARCHAR(MAX) NULL,[DescriptionPrefix|VARCHAR|NULL||] VARCHAR(MAX) NULL) INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||]) SELECT [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken],[DescriptionSuffix],[DescriptionPrefix] FROM AirTestDataCollectionQuestion SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||],[DescriptionSuffix|VARCHAR|NULL||],[DescriptionPrefix|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable WHERE @DisableFunctionality>0
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable WHERE @DisableFunctionality>0
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable WHERE @DisableFunctionality>0

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable WHERE @DisableFunctionality>0
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable WHERE @DisableFunctionality>0
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable WHERE @DisableFunctionality>0

      SET NOCOUNT OFF;
END


GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobileV2.2.5_DataTransfer_StaticTables]
(
      @ServerCode nvarchar(MAX) = '',
      @SystemName nvarchar(MAX),
      @Version nvarchar(MAX),
      @EmployeeID INT = 0
)
AS
BEGIN
      SET NOCOUNT ON;
      
                  UPDATE Element Set ElementIntID=ElementText,ElementText=NULL WHERE ElementTypeID=32 AND ElementText IS NOT NULL

      SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
      INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 2,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobileV2.2.5_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END
      
      --[mobile__HighestJobNo] is an exception from structure!
      --DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL] INT NOT NULL)  
      --INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL]) Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config 
      --SELECT [ConfigId|INTEGER|NOTNULL],[s__CompanyName|NVARCHAR|NOTNULL],[s__CompanyAddress|NVARCHAR|NOTNULL],[s__CompanyTelephone|VARCHAR|NOTNULL],[s__CompanyFax|VARCHAR|NOTNULL],[s__CompanyEmail|VARCHAR|NOTNULL],[s__CompanyWebsite|VARCHAR|NOTNULL],[s__CompanyDetails|NVARCHAR|NOTNULL],[s__BranchName|NVARCHAR|NOTNULL],[s__BranchPrefix|VARCHAR|NOTNULL],[Stage4Statement|VARCHAR|NOTNULL],[ImageCaptureSize|INTEGER|NOTNULL],[s__ReportCSS|NVARCHAR|NOTNULL],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL],[s__ServerCode|NVARCHAR|NULL],[b__MobileGUIDCreate|BIT|NOTNULL],[mobile__HighestJobNo|INT|NOTNULL] FROM @ConfigTable
      
      DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable
      DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable
      DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable
      DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable
      DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable
      DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable
      DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable
      DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable
      DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable
      DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable
      DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable
      DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable
      DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable
      DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable
      DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable
      DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable
      DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable
      
      DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable
      DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable
      DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable
      DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable
      DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable
      DECLARE @InternalExternalLinkTable TABLE ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalNoteID|INTEGER|NOTNULL||] INT NOT NULL ,[OptionNumber|INTEGER|NOTNULL||] INT NOT NULL )      INSERT INTO @InternalExternalLinkTable ([InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||])      Select [InternalExternalLinkID],[InternalExternalNoteID],[OptionNumber] FROM InternalExternalLink    SELECT [InternalExternalLinkID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalNoteID|INTEGER|NOTNULL||],[OptionNumber|INTEGER|NOTNULL||] FROM @InternalExternalLinkTable
      DECLARE @InternalExternalNoteTable TABLE ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalNote|BIT|NOTNULL||] BIT NOT NULL ,[ExternalNote|BIT|NOTNULL||] BIT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Notetype|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultAnswer|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[BuildingComponent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AutoInsertDefaultAnswer|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SignOffNote|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @InternalExternalNoteTable ([InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||])      Select [InternalExternalNoteID],[InternalNote],[ExternalNote],[Description],[Notetype],[DefaultAnswer],[ElementTypeID],[SortOrder],[BuildingComponent],[AutoInsertDefaultAnswer],[SignOffNote] FROM InternalExternalNote WHERE DELETED IS NULL SELECT [InternalExternalNoteID|INTEGER|NOTNULL||SERVERKEY],[InternalNote|BIT|NOTNULL||],[ExternalNote|BIT|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Notetype|VARCHAR|NOTNULL||],[DefaultAnswer|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[BuildingComponent|BIT|NOTNULL||],[AutoInsertDefaultAnswer|BIT|NOTNULL||],[SignOffNote|BIT|NOTNULL||] FROM @InternalExternalNoteTable
      DECLARE @InternalExternalOptionTable TABLE ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[InternalExternalLinkID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @InternalExternalOptionTable ([InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [InternalExternalOptionID],[InternalExternalLinkID],[Description],[SortOrder] FROM InternalExternalOption WHERE DELETED IS NULL    SELECT [InternalExternalOptionID|INTEGER|NOTNULL||SERVERKEY],[InternalExternalLinkID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @InternalExternalOptionTable
      DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable
      DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable
      DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType WHERE Deleted IS NULL       SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable
      DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable
      DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable
      DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable
      DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable
      DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable
      DECLARE @TemplateTypeTable TABLE ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ReportFooterID|INTEGER|NULL||] INT NULL )     INSERT INTO @TemplateTypeTable ([TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||])      Select [TemplateTypeID],[TemplateType],[ReportFooterID] FROM TemplateType      SELECT [TemplateTypeID|INTEGER|NOTNULL||SERVERKEY],[TemplateType|VARCHAR|NOTNULL||],[ReportFooterID|INTEGER|NULL||] FROM @TemplateTypeTable
      DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable
      DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable
      DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable
      DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable
      DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable

      DECLARE @AirTestDataCollectionCategoryTable TABLE ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @AirTestDataCollectionCategoryTable ([AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||]) Select [AirTestDataCollectionCategoryID],[AirTestDataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM AirTestDataCollectionCategory  SELECT [AirTestDataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTable
      DECLARE @AirTestDataCollectionCategoryTypeTable TABLE ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirTestDynamicTabNo|INTEGER|NULL||] INT NULL ,[AirTestTabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[AirtestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))     INSERT INTO @AirTestDataCollectionCategoryTypeTable ([AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [AirTestDataCollectionCategoryTypeID],[Description],[AirTestDynamicTabNo],[AirTestTabName],[AirtestTypeID],[SortOrder] FROM AirTestDataCollectionCategoryType    SELECT [AirTestDataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[AirTestDynamicTabNo|INTEGER|NULL||],[AirTestTabName|VARCHAR|NULL||],[AirtestTypeID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @AirTestDataCollectionCategoryTypeTable
      DECLARE @AirTestDataCollectionQuestionTable TABLE ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[InspectionLabelID|INTEGER|NULL||] INT NULL ,[InspectionChoiceID|INTEGER|NULL||] INT NULL ,[ElementTypeID|INTEGER|NULL||] INT NULL ,[ResultTypeID|INTEGER|NULL||] INT NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemoveClear|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[AllowNull|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )  INSERT INTO @AirTestDataCollectionQuestionTable ([AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionID],[AirTestDataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[InspectionLabelID],[InspectionChoiceID],[ElementTypeID],[ResultTypeID],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[RemoveClear],[AllowNull],[AnswerRequired],[NullReplace],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM AirTestDataCollectionQuestion  SELECT [AirTestDataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[InspectionLabelID|INTEGER|NULL||],[InspectionChoiceID|INTEGER|NULL||],[ElementTypeID|INTEGER|NULL||],[ResultTypeID|INTEGER|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[RemoveClear|BIT|NOTNULL||],[AllowNull|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionTable
      DECLARE @AirTestDataCollectionQuestionOptionOrInsertTable TABLE ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[OverrideDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL )   INSERT INTO @AirTestDataCollectionQuestionOptionOrInsertTable ([AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||])      Select [AirTestDataCollectionQuestionOptionOrInsertID],[AirTestDataCollectionQuestionID],[Description],[SortOrder],[Deleted],[OverrideDescription] FROM AirTestDataCollectionQuestionOptionOrInsert      SELECT [AirTestDataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[OverrideDescription|VARCHAR|NULL||] FROM @AirTestDataCollectionQuestionOptionOrInsertTable
      DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable
      DECLARE @PhotoCollectionAutoInsertTable TABLE ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))   INSERT INTO @PhotoCollectionAutoInsertTable ([PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||])   Select [PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[LegionellaAssetOutletDataCollectionID],[Caption],[Description],[SortOrder] FROM PhotoCollectionAutoInsert      SELECT [PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[LegionellaAssetOutletDataCollectionID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||] FROM @PhotoCollectionAutoInsertTable
      DECLARE @ResultTypeTable TABLE ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[AirTestTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestDataCollectionCategoryID|INTEGER|NULL||] INT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Employee|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[Result|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)))    INSERT INTO @ResultTypeTable ([ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||])  Select [ResultTypeID],[Description],[AirTestTypeID],[AirTestDataCollectionCategoryID],[ReplaceVariable],[NullReplace],[Employee],[Result] FROM ResultType   SELECT [ResultTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[AirTestTypeID|INTEGER|NOTNULL||],[AirTestDataCollectionCategoryID|INTEGER|NULL||],[ReplaceVariable|VARCHAR|NULL||],[NullReplace|VARCHAR|NULL||],[Employee|BIT|NOTNULL||],[Result|BIT|NOTNULL||] FROM @ResultTypeTable

      DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable --WHERE 1=2
      DECLARE @ReportFooterTable TABLE ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReportFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PageOneFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[OtherPageFooter|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultFooter|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))  INSERT INTO @ReportFooterTable ([ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||])      Select [ReportFooterID],[ReportFooter],[PageOneFooter],[OtherPageFooter],[DefaultFooter] FROM ReportFooter      SELECT [ReportFooterID|INTEGER|NOTNULL||SERVERKEY],[ReportFooter|VARCHAR|NOTNULL||],[PageOneFooter|VARCHAR|NOTNULL||],[OtherPageFooter|VARCHAR|NOTNULL||],[DefaultFooter|BIT|NOTNULL||] FROM @ReportFooterTable
      DECLARE @RowTemplateTable TABLE ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ReplaceVariable|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[HeaderHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[RowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[FooterHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[HeaderFooterSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[RowSQL|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowHTML|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[NoDataRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[MaxRowsPerPage|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[RowTemplateTypeInt|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AddPagedRowHTML|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[AddPagedRowSQL|NVARCHAR|NULL||] NVARCHAR(MAX) NULL )      INSERT INTO @RowTemplateTable ([RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||])      Select [RowTemplateID],[ReplaceVariable],[HeaderHTML],[RowHTML],[FooterHTML],[HeaderFooterSQL],[RowSQL],[NoDataRowHTML],[NoDataRowSQL],[MaxRowsPerPage],[MaxRowsPerPageAdditionalPagesOverride],[RowTemplateTypeInt],[AddPagedRowHTML],[AddPagedRowSQL] FROM RowTemplate  SELECT [RowTemplateID|INTEGER|NOTNULL||SERVERKEY],[ReplaceVariable|VARCHAR|NOTNULL||],[HeaderHTML|NVARCHAR|NOTNULL||],[RowHTML|NVARCHAR|NOTNULL||],[FooterHTML|NVARCHAR|NOTNULL||],[HeaderFooterSQL|NVARCHAR|NULL||],[RowSQL|NVARCHAR|NOTNULL||],[NoDataRowHTML|NVARCHAR|NOTNULL||],[NoDataRowSQL|NVARCHAR|NULL||],[MaxRowsPerPage|INTEGER|NOTNULL||],[MaxRowsPerPageAdditionalPagesOverride|INTEGER|NOTNULL||],[RowTemplateTypeInt|INTEGER|NOTNULL||],[AddPagedRowHTML|NVARCHAR|NULL||],[AddPagedRowSQL|NVARCHAR|NULL||] FROM @RowTemplateTable
      DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable
      DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable
      DECLARE @TemplateTable TABLE ([TemplateID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Template|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))      INSERT INTO @TemplateTable ([TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||]) SELECT [TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM (SELECT  ROW_NUMBER() OVER (PARTITION BY TemplateTypeID Order by [Version] DESC) [Identifier],[TemplateID],[TemplateTypeID],[Template],[Version],[EmployeeID],[DateCreated] FROM Template WHERE TemplateTypeID IN (SELECT TemplateTypeID FROM AirTestType WHERE Deleted IS NULL)) t WHERE t.Identifier = 1 SELECT [TemplateID|INTEGER|NOTNULL||SERVERKEY],[TemplateTypeID|INTEGER|NOTNULL||],[Template|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||] FROM @TemplateTable
      DECLARE @TemplatePageLayoutTable TABLE ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SearchString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Header_BrowserWidth|INTEGER|NULL||] INT NULL ,[Header_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Body_RectString|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Body_BrowserWidth|INTEGER|NOTNULL||] INT NOT NULL ,[Footer_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Footer_BrowserWidth|INTEGER|NULL||] INT NULL ,[Footer_HTML_Override|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_RectString|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Watermark_BrowserWidth|INTEGER|NULL||] INT NULL ,[Watermark_HTML|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Landscape|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[IsChainable|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)),[MediaBox|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT ('0 0 612 792'),[FloorplanSystemType|INTEGER|NULL||] INT NULL ) INSERT INTO @TemplatePageLayoutTable ([TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||])    Select [TemplatePageLayoutID],[SearchString],[Header_RectString],[Header_BrowserWidth],[Header_HTML],[Body_RectString],[Body_BrowserWidth],[Footer_RectString],[Footer_BrowserWidth],[Footer_HTML_Override],[Watermark_RectString],[Watermark_BrowserWidth],[Watermark_HTML],[Landscape],[IsChainable],[MediaBox],[FloorplanSystemType] FROM TemplatePageLayout      SELECT [TemplatePageLayoutID|INTEGER|NOTNULL||SERVERKEY],[SearchString|VARCHAR|NULL||],[Header_RectString|VARCHAR|NULL||],[Header_BrowserWidth|INTEGER|NULL||],[Header_HTML|VARCHAR|NULL||],[Body_RectString|VARCHAR|NOTNULL||],[Body_BrowserWidth|INTEGER|NOTNULL||],[Footer_RectString|VARCHAR|NULL||],[Footer_BrowserWidth|INTEGER|NULL||],[Footer_HTML_Override|VARCHAR|NULL||],[Watermark_RectString|VARCHAR|NULL||],[Watermark_BrowserWidth|INTEGER|NULL||],[Watermark_HTML|VARCHAR|NULL||],[Landscape|BIT|NOTNULL||],[IsChainable|BIT|NOTNULL||],[MediaBox|VARCHAR|NOTNULL||],[FloorplanSystemType|INTEGER|NULL||] FROM @TemplatePageLayoutTable

      SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='PhotoCollectionAutoInsert') AND name='LegionellaAssetOutletQuestionID') < 1
BEGIN
  ALTER TABLE PhotoCollectionAutoInsert
      ADD LegionellaAssetOutletQuestionID INT NULL
END
GO

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables] AS BEGIN SET NOCOUNT ON; END')
End
GO

/****** Object:  StoredProcedure [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables]    Script Date: 19/12/2018 16:32:05 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

ALTER PROC [dbo].[mobile_Legionella_v1.4.0.14_DataTransfer_StaticTables]
(
	@ServerCode nvarchar(MAX) = '',
	@SystemName nvarchar(MAX),
	@Version nvarchar(MAX),
	@EmployeeID INT = 0
)
AS
BEGIN
	SET NOCOUNT ON;
      
	DECLARE @DisableFunctionality INT = (SELECT COUNT(*) FROM Equipment e WHERE e.RefNo=@SystemName AND e.EquipmentcategoryID=19 AND MobileUnitLicenceKeyID IS NOT NULL)

	SET @ServerCode = (SELECT ISNULL(NULLIF(@ServerCode,''),'NYS'))
      
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Stored Procedure StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality>0
	INSERT INTO MobileAuditTrail (Category,SystemName,[Message],DataTable,DataID,DataScript,DataQueryString,DataIPAddress,EmployeeID) SELECT 5,@SystemName,'Failed Server Authentication in StaticTable Call','MobileAuditTrail',0,'mobile_Legionella_v1.3.4.0_DataTransfer_StaticTables',@Version,'127.0.0.1',CASE WHEN @EmployeeID > 0 THEN @EmployeeID END WHERE @DisableFunctionality=0
      
	DECLARE @ConfigTable TABLE ([ConfigId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[s__CompanyName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyAddress|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__CompanyTelephone|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyFax|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyEmail|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyWebsite|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[s__CompanyDetails|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchName|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL ,[s__BranchPrefix|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Stage4Statement|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageCaptureSize|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[s__ReportCSS|NVARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL DEFAULT (''),[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[s__ServerCode|NVARCHAR|NULL||] NVARCHAR(MAX) NULL ,[b__MobileGUIDCreate|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((1)), [mobile__HighestJobNo|INT|NOTNULL||] INT NOT NULL)    INSERT INTO @ConfigTable ([ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||])     Select [ConfigId],[s__CompanyName],[s__CompanyAddress],[s__CompanyTelephone],[s__CompanyFax],[s__CompanyEmail],[s__CompanyWebsite],[s__CompanyDetails],[s__BranchName],[s__BranchPrefix],[Stage4Statement],[ImageCaptureSize],[s__ReportCSS],[s__ClientStoreNetworkPath],[s__ServerCode],[b__MobileGUIDCreate], (Select MAX(JobNo) FROM Job) [mobile__HighestJobNo] FROM Config SELECT [ConfigId|INTEGER|NOTNULL||SERVERKEY],[s__CompanyName|NVARCHAR|NOTNULL||],[s__CompanyAddress|NVARCHAR|NOTNULL||],[s__CompanyTelephone|VARCHAR|NOTNULL||],[s__CompanyFax|VARCHAR|NOTNULL||],[s__CompanyEmail|VARCHAR|NOTNULL||],[s__CompanyWebsite|VARCHAR|NOTNULL||],[s__CompanyDetails|NVARCHAR|NOTNULL||],[s__BranchName|NVARCHAR|NOTNULL||],[s__BranchPrefix|VARCHAR|NOTNULL||],[Stage4Statement|VARCHAR|NOTNULL||],[ImageCaptureSize|INTEGER|NOTNULL||],[s__ReportCSS|NVARCHAR|NOTNULL||],[s__ClientStoreNetworkPath|VARCHAR|NOTNULL||],[s__ServerCode|NVARCHAR|NULL||],[b__MobileGUIDCreate|BIT|NOTNULL||], [mobile__HighestJobNo|INT|NOTNULL||] FROM @ConfigTable WHERE @DisableFunctionality>0
	DECLARE @AppointmentTypeTable TABLE ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AppointmentType1|VARCHAR|NOTNULL||] NVARCHAR(MAX) NOT NULL) INSERT INTO @AppointmentTypeTable ([AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||]) SELECT [AppointmentTypeId],[AppointmentType] FROM AppointmentType  SELECT [AppointmentTypeId|INTEGER|NOTNULL||SERVERKEY],[AppointmentType1|VARCHAR|NOTNULL||] FROM @AppointmentTypeTable WHERE @DisableFunctionality>0
	DECLARE @AppointmentCategoryTable TABLE ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Sort_Order|INTEGER|NOTNULL||] INT NOT NULL ,[HTML_Colour|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AppointmentCategoryTable ([AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||])      Select [AppointmentCategoryID],[Description],[Sort_Order],[HTML_Colour] FROM AppointmentCategory     SELECT [AppointmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Sort_Order|INTEGER|NOTNULL||],[HTML_Colour|VARCHAR|NULL||] FROM @AppointmentCategoryTable WHERE @DisableFunctionality>0
	DECLARE @BranchOfficeTable TABLE ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[BranchOffice|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Default|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Address|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Postcode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL DEFAULT (''),[Email|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Telephone|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @BranchOfficeTable ([BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||])      Select [BranchOfficeID],[BranchOffice],[Default],[Address],[Postcode],[Email],[Telephone] FROM BranchOffice      SELECT [BranchOfficeID|INTEGER|NOTNULL||SERVERKEY],[BranchOffice|VARCHAR|NOTNULL||],[Default|BIT|NOTNULL||],[Address|VARCHAR|NOTNULL||],[Postcode|VARCHAR|NOTNULL||],[Email|VARCHAR|NULL||],[Telephone|VARCHAR|NULL||] FROM @BranchOfficeTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationTable TABLE ([CalibrationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationDate|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL ,[DateDeleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @CalibrationTable ([CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||])      Select [CalibrationID],[EquipmentID],[CalibrationDate],[DateCreated],[DateDeleted] FROM Calibration  SELECT [CalibrationID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[CalibrationDate|DATETIME|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[DateDeleted|DATETIME|NULL||] FROM @CalibrationTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationInformationTable TABLE ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[CalibrationID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInformationTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[CalibrationInt|INTEGER|NULL||] INT NULL ,[CalibrationText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CalibrationDateTime|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @CalibrationInformationTable ([CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||])      Select [CalibrationInformationID],[CalibrationID],[CalibrationInformationTypeID],[CalibrationInt],[CalibrationText],[CalibrationDateTime] FROM CalibrationInformation   SELECT [CalibrationInformationID|INTEGER|NOTNULL||SERVERKEY],[CalibrationID|INTEGER|NOTNULL||],[CalibrationInformationTypeID|INTEGER|NOTNULL||],[CalibrationInt|INTEGER|NULL||],[CalibrationText|VARCHAR|NULL||],[CalibrationDateTime|DATETIME|NULL||] FROM @CalibrationInformationTable WHERE @DisableFunctionality>0
	DECLARE @CalibrationInformationTypeTable TABLE ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @CalibrationInformationTypeTable ([CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||])      Select [CalibrationInformationTypeID],[EquipmentCategoryID],[Description],[EntryType],[Required] FROM CalibrationInformationType     SELECT [CalibrationInformationTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||] FROM @CalibrationInformationTypeTable WHERE @DisableFunctionality>0
	DECLARE @ClientSpecificElementTable TABLE ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[UseElementIntMeaningExtended|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[UseElementIntMeaningSubOption|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @ClientSpecificElementTable ([ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||])      Select [ClientSpecificElementID],[ClientID],[ElementTypeID],[MobileConfigTypeID],[UseElementIntMeaningExtended],[UseElementIntMeaningSubOption] FROM ClientSpecificElement    SELECT [ClientSpecificElementID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[ElementTypeID|INTEGER|NOTNULL||],[MobileConfigTypeID|INTEGER|NOTNULL||],[UseElementIntMeaningExtended|BIT|NOTNULL||],[UseElementIntMeaningSubOption|BIT|NOTNULL||] FROM @ClientSpecificElementTable WHERE @DisableFunctionality>0
	DECLARE @ClientSpecificElementIntMeaningExtendedTable TABLE ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @ClientSpecificElementIntMeaningExtendedTable ([ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [ClientSpecificElementIntMeaningExtendedID],[ElementIntMeaningExtendedID],[ClientID] FROM ClientSpecificElementIntMeaningExtended    SELECT [ClientSpecificElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningExtendedID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @ClientSpecificElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionCategoryTable TABLE ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShowHeader|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[PanelHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @DataCollectionCategoryTable ([DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])   Select [DataCollectionCategoryID],[DataCollectionCategoryTypeID],[Description],[ShowHeader],[PanelHeight],[Deleted],[SuppressOffice],[SortOrder] FROM DataCollectionCategory   SELECT [DataCollectionCategoryID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShowHeader|BIT|NOTNULL||],[PanelHeight|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressOffice|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionCategoryTypeTable TABLE ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[QuoteVisitTypeID|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @DataCollectionCategoryTypeTable ([DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||])      Select [DataCollectionCategoryTypeID],[Description],[QuoteVisitTypeID] FROM DataCollectionCategoryType    SELECT [DataCollectionCategoryTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NULL||],[QuoteVisitTypeID|INTEGER|NOTNULL||] FROM @DataCollectionCategoryTypeTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionQuestionTable TABLE ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[DisplayNA|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionTable ([DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionID],[DataCollectionCategoryID],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[Deleted],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[DataCollectionExtendedTypeID] FROM DataCollectionQuestion  SELECT [DataCollectionQuestionID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionTable WHERE @DisableFunctionality>0
	DECLARE @DataCollectionQuestionOptionOrInsertTable TABLE ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[DataCollectionQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[DataCollectionExtendedTypeID|INTEGER|NULL||] INT NULL )   INSERT INTO @DataCollectionQuestionOptionOrInsertTable ([DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||])      Select [DataCollectionQuestionOptionOrInsertID],[DataCollectionQuestionID],[Description],[SortOrder],[Deleted],[DataCollectionExtendedTypeID] FROM DataCollectionQuestionOptionOrInsert SELECT [DataCollectionQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[DataCollectionQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||],[DataCollectionExtendedTypeID|INTEGER|NULL||] FROM @DataCollectionQuestionOptionOrInsertTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningTable TABLE ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementIntValue|INTEGER|NOTNULL||] INT NOT NULL )  INSERT INTO @ElementIntMeaningTable ([ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||])      Select [ElementIntMeaningID],[Description],[ShortDescription],[ElementTypeID],[ElementIntValue] FROM ElementIntMeaning  SELECT [ElementIntMeaningID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ShortDescription|VARCHAR|NULL||],[ElementTypeID|INTEGER|NOTNULL||],[ElementIntValue|INTEGER|NOTNULL||] FROM @ElementIntMeaningTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningExtendedTable TABLE ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))  INSERT INTO @ElementIntMeaningExtendedTable ([ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningExtendedID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningExtended      SELECT [ElementIntMeaningExtendedID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningExtendedTable WHERE @DisableFunctionality>0
	DECLARE @ElementIntMeaningSubOptionTable TABLE ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ElementIntMeaningID|INTEGER|NOTNULL||] INT NOT NULL ,[ElementTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL )   INSERT INTO @ElementIntMeaningSubOptionTable ([ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||])      Select [ElementIntMeaningSubOptionID],[ElementIntMeaningID],[ElementTypeID],[Description],[SortOrder] FROM ElementIntMeaningSubOption     SELECT [ElementIntMeaningSubOptionID|INTEGER|NOTNULL||SERVERKEY],[ElementIntMeaningID|INTEGER|NOTNULL||],[ElementTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||] FROM @ElementIntMeaningSubOptionTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentTable TABLE ([EquipmentID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[RefNo|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Calibration|DATETIME|NULL||] DATETIME NULL ,[DatePurchased|DATETIME|NULL||] DATETIME NULL ,[IntervalCheck|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)), [LastChecked|DATETIME|NULL||] DATETIME NULL)    INSERT INTO @EquipmentTable ([EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||])      Select e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, dbo.CalibrationDueDate(e.EquipmentID) [Calibration],e.DatePurchased, e.IntervalCheck, MAX(s.Created) [LastChecked] from Equipment e LEFT OUTER JOIN EquipmentCheck ec ON e.EquipmentID=ec.EquipmentID LEFT OUTER JOIN Signature s ON s.SignatureID=ec.SignatureID Where e.Deleted IS NULL AND e.NotInUse=0 AND e.EquipmentCategoryID<>19 GROUP BY e.EquipmentID, e.EquipmentCategoryID, e.RefNo, e.Description, e.EquipmentID, e.IntervalCheck,e.DatePurchased     SELECT [EquipmentID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[RefNo|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||],[Calibration|DATETIME|NULL||],[DatePurchased|DATETIME|NULL||],[IntervalCheck|INTEGER|NOTNULL||], [LastChecked|DATETIME|NULL||] FROM @EquipmentTable WHERE @DisableFunctionality>0
      
	DECLARE @EquipmentAssignedTable TABLE ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentID|INTEGER|NOTNULL||] INT NOT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[Assigned|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @EquipmentAssignedTable ([EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentAssignedID],[EquipmentID],[EmployeeID],[Assigned],[Deleted] FROM EquipmentAssigned SELECT [EquipmentAssignedID|INTEGER|NOTNULL||SERVERKEY],[EquipmentID|INTEGER|NOTNULL||],[EmployeeID|INTEGER|NOTNULL||],[Assigned|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentAssignedTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentCategoryTable TABLE ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SurveyType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirTestType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[RemovalType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[AirSampleType|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[CheckFrequency|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CheckLevel|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[NoEquipmentAllowed|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((1)))     INSERT INTO @EquipmentCategoryTable ([EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||])      Select [EquipmentCategoryID],[Description],[SurveyType],[AirTestType],[RemovalType],[SampleType],[AirSampleType],[CheckFrequency],[CheckLevel],[Deleted],[NoEquipmentAllowed] FROM EquipmentCategory  SELECT [EquipmentCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[SurveyType|BIT|NOTNULL||],[AirTestType|BIT|NOTNULL||],[RemovalType|BIT|NOTNULL||],[SampleType|BIT|NOTNULL||],[AirSampleType|BIT|NOTNULL||],[CheckFrequency|VARCHAR|NULL||],[CheckLevel|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[NoEquipmentAllowed|INTEGER|NOTNULL||] FROM @EquipmentCategoryTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentCheckTypeTable TABLE ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[EquipmentCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Required|BIT|NOTNULL||] BIT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @EquipmentCheckTypeTable ([EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [EquipmentCheckTypeID],[EquipmentCategoryID],[Description],[Required],[SortOrder],[Deleted] FROM EquipmentCheckType SELECT [EquipmentCheckTypeID|INTEGER|NOTNULL||SERVERKEY],[EquipmentCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[Required|BIT|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @EquipmentCheckTypeTable WHERE @DisableFunctionality>0
	DECLARE @EquipmentIntervalCheckTable TABLE ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TypeName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ) INSERT INTO @EquipmentIntervalCheckTable ([IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||])      Select [IntervalCheckID],[TypeName],[Description] FROM EquipmentIntervalCheck      SELECT [IntervalCheckID|INTEGER|NOTNULL||SERVERKEY],[TypeName|VARCHAR|NOTNULL||],[Description|VARCHAR|NULL||] FROM @EquipmentIntervalCheckTable WHERE @DisableFunctionality>0
	DECLARE @FloorplanImageItemTable TABLE ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ImageData|IMAGE|NULL||] IMAGE NULL ,[ImageWidth|INTEGER|NOTNULL||] INT NOT NULL ,[ImageHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AirTestImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[SurveyImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[QuoteVisitImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[LegionellaImage|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0))) INSERT INTO @FloorplanImageItemTable ([FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||])  Select [FloorplanImageItemID],[Description],[ImageData],[ImageWidth],[ImageHeight],[AirTestImage],[SurveyImage],[QuoteVisitImage],[LegionellaImage] FROM FloorplanImageItem SELECT [FloorplanImageItemID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ImageData|IMAGE|NULL||],[ImageWidth|INTEGER|NOTNULL||],[ImageHeight|INTEGER|NOTNULL||],[AirTestImage|BIT|NOTNULL||],[SurveyImage|BIT|NOTNULL||],[QuoteVisitImage|BIT|NOTNULL||],[LegionellaImage|BIT|NOTNULL||] FROM @FloorplanImageItemTable WHERE @DisableFunctionality>0
	DECLARE @MobileConfigTable TABLE ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[MobileConfigTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[MobileConfigInt|INTEGER|NULL||] INT NULL ,[MobileConfigText|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[MobileConfigDateTime|DATETIME|NULL||] DATETIME NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()))    INSERT INTO @MobileConfigTable ([MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||])      Select [MobileConfigID],[MobileConfigTypeID],[MobileConfigInt],[MobileConfigText],[MobileConfigDateTime],[Deleted],[Created] FROM MobileConfig SELECT [MobileConfigID|INTEGER|NOTNULL||SERVERKEY],[MobileConfigTypeID|INTEGER|NOTNULL||],[MobileConfigInt|INTEGER|NULL||],[MobileConfigText|VARCHAR|NULL||],[MobileConfigDateTime|DATETIME|NULL||],[Deleted|DATETIME|NULL||],[Created|DATETIME|NOTNULL||] FROM @MobileConfigTable WHERE @DisableFunctionality>0
	DECLARE @QuoteVisitTypeTable TABLE ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @QuoteVisitTypeTable ([QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [QuoteVisitTypeID],[Description],[Deleted] FROM QuoteVisitType   SELECT [QuoteVisitTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @QuoteVisitTypeTable WHERE @DisableFunctionality>0
	DECLARE @RiskElementTypeTable TABLE ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ResultThreshold|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((6)),[RiskSeverity|INTEGER|NOTNULL||] INT NOT NULL ,[ControlMethod|VARCHAR|NULL||] VARCHAR(MAX) NULL )     INSERT INTO @RiskElementTypeTable ([RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||])      Select [RiskElementTypeID],[Description],[ResultThreshold],[RiskSeverity],[ControlMethod] FROM RiskElementType   SELECT [RiskElementTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[ResultThreshold|INTEGER|NOTNULL||],[RiskSeverity|INTEGER|NOTNULL||],[ControlMethod|VARCHAR|NULL||] FROM @RiskElementTypeTable WHERE @DisableFunctionality>0
	DECLARE @SampleClassificationTable TABLE ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL ,[Score|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)))      INSERT INTO @SampleClassificationTable ([SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||])      Select [SampleClassificationID],[SampleClassification],[Value],[Score] FROM SampleClassification    SELECT [SampleClassificationID|INTEGER|NOTNULL||SERVERKEY],[SampleClassification|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||],[Score|INTEGER|NOTNULL||] FROM @SampleClassificationTable WHERE @DisableFunctionality>0
	DECLARE @SampleClassificationExtendedTable TABLE ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleClassificationID|INTEGER|NOTNULL||] INT NOT NULL ,[SampleClassification|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ElementIntMeaningExtendedID|INTEGER|NULL||] INT NULL )    INSERT INTO @SampleClassificationExtendedTable ([SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||])      Select [SampleClassificationExtendedID],[SampleClassificationID],[SampleClassification],[ElementIntMeaningExtendedID] FROM SampleClassificationExtended   SELECT [SampleClassificationExtendedID|INTEGER|NOTNULL||SERVERKEY],[SampleClassificationID|INTEGER|NOTNULL||],[SampleClassification|VARCHAR|NOTNULL||],[ElementIntMeaningExtendedID|INTEGER|NULL||] FROM @SampleClassificationExtendedTable WHERE @DisableFunctionality>0
	DECLARE @SampleResultTable TABLE ([SampleResultID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[SampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[FullSampleResult|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Value|INTEGER|NOTNULL||] INT NOT NULL )    INSERT INTO @SampleResultTable ([SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||])      Select [SampleResultID],[SampleResult],[FullSampleResult],[Value] FROM SampleResult      SELECT [SampleResultID|INTEGER|NOTNULL||SERVERKEY],[SampleResult|VARCHAR|NOTNULL||],[FullSampleResult|VARCHAR|NOTNULL||],[Value|INTEGER|NOTNULL||] FROM @SampleResultTable WHERE @DisableFunctionality>0
	DECLARE @SurveyTypeTable TABLE ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )     INSERT INTO @SurveyTypeTable ([SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||])   Select [SurveyTypeID],[Description] FROM SurveyType WHERE Deleted IS NULL      SELECT [SurveyTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||] FROM @SurveyTypeTable WHERE @DisableFunctionality>0
	DECLARE @TableCodeTable TABLE ([TableCodeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[TableName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TableCode|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ) INSERT INTO @TableCodeTable ([TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||])      Select [TableCodeID],[TableName],[TableCode] FROM TableCode SELECT [TableCodeID|INTEGER|NOTNULL||SERVERKEY],[TableName|VARCHAR|NOTNULL||],[TableCode|VARCHAR|NOTNULL||] FROM @TableCodeTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTable TABLE ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)),[Locked|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[ExportCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PratMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))     INSERT INTO @StandardPhraseTable ([StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||])      Select [StandardPhraseID],[StandardPhraseTypeID],[Description],[SortOrder],[Locked],[ExportCode],[PratMode] FROM StandardPhrase     SELECT [StandardPhraseID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Locked|BIT|NOTNULL||],[ExportCode|VARCHAR|NULL||],[PratMode|BIT|NOTNULL||] FROM @StandardPhraseTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseCategoryTable TABLE ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[DefaultCategory|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))   INSERT INTO @StandardPhraseCategoryTable ([StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||])      Select [StandardPhraseCategoryID],[Description],[DefaultCategory] FROM StandardPhraseCategory  SELECT [StandardPhraseCategoryID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[DefaultCategory|BIT|NOTNULL||] FROM @StandardPhraseCategoryTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseCategoryClientTable TABLE ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL )    INSERT INTO @StandardPhraseCategoryClientTable ([StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|])      Select [StandardPhraseCategoryClientID],[StandardPhraseCategoryID],[ClientID] FROM StandardPhraseCategoryClient  SELECT [StandardPhraseCategoryClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|] FROM @StandardPhraseCategoryClientTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTypeTable TABLE ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )    INSERT INTO @StandardPhraseTypeTable ([StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||])      Select [StandardPhraseTypeID],[StandardPhraseCategoryID],[Description] FROM StandardPhraseType      SELECT [StandardPhraseTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||] FROM @StandardPhraseTypeTable WHERE @DisableFunctionality>0
	DECLARE @StandardPhraseTypeClientTable TABLE ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardPhraseTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[ButtonType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[PartialMode|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)))      INSERT INTO @StandardPhraseTypeClientTable ([StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||])      Select [StandardPhraseTypeClientID],[StandardPhraseTypeID],[ClientID],[ButtonType],[PartialMode] FROM StandardPhraseTypeClient SELECT [StandardPhraseTypeClientID|INTEGER|NOTNULL||SERVERKEY],[StandardPhraseTypeID|INTEGER|NOTNULL||],[ClientID|INTEGER|NOTNULL|Client|],[ButtonType|VARCHAR|NOTNULL||],[PartialMode|BIT|NOTNULL||] FROM @StandardPhraseTypeClientTable WHERE @DisableFunctionality>0

	DECLARE @AirTestTypeTable TABLE ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NULL||] INT NULL ,[AirMonitoringRowAdjustment|INTEGER|NOTNULL||] INT NOT NULL ,[DynamicContent|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[BackColorARGB|VARCHAR|NULL||] VARCHAR(MAX) NULL )    INSERT INTO @AirTestTypeTable ([AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||])      Select [AirTestTypeID],[Description],[TemplateTypeID],[AirMonitoringRowAdjustment],[DynamicContent],[BackColorARGB] FROM AirTestType WHERE [Deleted] IS NULL  SELECT [AirTestTypeID|INTEGER|NOTNULL||SERVERKEY],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NULL||],[AirMonitoringRowAdjustment|INTEGER|NOTNULL||],[DynamicContent|BIT|NOTNULL||],[BackColorARGB|VARCHAR|NULL||] FROM @AirTestTypeTable WHERE @DisableFunctionality>0


	-- ================================================================================================================
	-- PJL - I split this up so I can see the wood from the trees!
	DECLARE @PhotoCollectionAutoInsertTable TABLE (
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[AirTestDataCollectionQuestionID|INTEGER|NULL||] INT NULL ,[AirTestResultID|INTEGER|NULL||] INT NULL ,[Caption|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL DEFAULT ((0)) ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL
	)   
		
	INSERT INTO @PhotoCollectionAutoInsertTable (
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[AirTestDataCollectionQuestionID|INTEGER|NULL||],[AirTestResultID|INTEGER|NULL||],[Caption|VARCHAR|NULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||]
	)   
	Select 
		[PhotoCollectionAutoInsertID],[AirTestDataCollectionQuestionID],[AirTestResultID],[Caption],[Description],[SortOrder],[LegionellaAssetOutletQuestionID] 
	FROM PhotoCollectionAutoInsert      
			
	SELECT 
		[PhotoCollectionAutoInsertID|INTEGER|NOTNULL||SERVERKEY],
		[AirTestDataCollectionQuestionID|INTEGER|NULL||],
		[AirTestResultID|INTEGER|NULL||],
		[Caption|VARCHAR|NULL||],
		[Description|VARCHAR|NULL||],
		[SortOrder|INTEGER|NOTNULL||],
		[LegionellaAssetOutletQuestionID|INTEGER|NULL||] 
	FROM 
		@PhotoCollectionAutoInsertTable 
	WHERE 
		@DisableFunctionality>0
	-- ================================================================================================================


	DECLARE @MobileURLFileTransferTable TABLE ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[FileName|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[ContentType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MobileSavePath|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[URL|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Overwrite|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Created|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL ) INSERT INTO @MobileURLFileTransferTable ([MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [MobileURLFileTransferID],[FileName],[ContentType],[MobileSavePath],[URL],[Overwrite],[Created],[Deleted] FROM MobileURLFileTransfer    SELECT [MobileURLFileTransferID|INTEGER|NOTNULL||SERVERKEY],[FileName|VARCHAR|NOTNULL||],[ContentType|VARCHAR|NOTNULL||],[MobileSavePath|VARCHAR|NOTNULL||],[URL|VARCHAR|NOTNULL||],[Overwrite|BIT|NOTNULL||],[Created|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @MobileURLFileTransferTable  WHERE @DisableFunctionality>0
	DECLARE @StandardProcedureTable TABLE ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[StandardProcedure|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[Version|INTEGER|NULL||] INT NULL ,[EmployeeID|INTEGER|NOTNULL||] INT NOT NULL ,[DateCreated|DATETIME|NOTNULL||] DATETIME NOT NULL DEFAULT (getdate()),[Deleted|DATETIME|NULL||] DATETIME NULL )      INSERT INTO @StandardProcedureTable ([StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureID],[StandardProcedureTypeID],[StandardProcedure],[Version],[EmployeeID],[DateCreated],[Deleted] FROM StandardProcedure  SELECT [StandardProcedureID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureTypeID|INTEGER|NOTNULL||],[StandardProcedure|VARCHAR|NOTNULL||],[Version|INTEGER|NULL||],[EmployeeID|INTEGER|NOTNULL||],[DateCreated|DATETIME|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTable WHERE @DisableFunctionality>0
	DECLARE @StandardProcedureTypeTable TABLE ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[StandardProcedureType|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )   INSERT INTO @StandardProcedureTypeTable ([StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])      Select [StandardProcedureTypeID],[StandardProcedureType],[Deleted] FROM StandardProcedureType   SELECT [StandardProcedureTypeID|INTEGER|NOTNULL||SERVERKEY],[StandardProcedureType|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @StandardProcedureTypeTable WHERE @DisableFunctionality>0

	DECLARE @LegionellaAssetCategoryTable TABLE ([LegionellaAssetCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DefaultAssetCode|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetCategoryTable ([LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetCategoryID],[Description],[TabName],[DefaultAssetCode],[SortOrder],[Deleted] FROM LegionellaAssetCategory	SELECT [LegionellaAssetCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[DefaultAssetCode|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetCategoryTable
	DECLARE @LegionellaAssetOutletQuestionTable TABLE ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SubTabTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[GroupTitle|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[EntryType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[MaxLength|INTEGER|NOTNULL||] INT NOT NULL ,[DisplayNA|BIT|NOTNULL||] BIT NOT NULL ,[QuestionWidth|INTEGER|NOTNULL||] INT NOT NULL ,[QuestionHeight|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[AnswerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[ReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SpacerWidth|INTEGER|NOTNULL||] INT NOT NULL ,[SpacerHeight|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[SuppressReport|BIT|NOTNULL||] BIT NOT NULL ,[SuppressOffice|BIT|NOTNULL||] BIT NOT NULL ,[AnswerRequired|BIT|NOTNULL||] BIT NOT NULL ,[NullReplace|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[PhotoCollection|INTEGER|NULL||] INT NULL ,[PhotoCollectionReplaceVariable|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] VARCHAR(MAX) NULL )	INSERT INTO @LegionellaAssetOutletQuestionTable ([LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||])	Select [LegionellaAssetOutletQuestionID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SubTabTitle],[GroupTitle],[Description],[EntryType],[MaxLength],[DisplayNA],[QuestionWidth],[QuestionHeight],[AnswerWidth],[AnswerHeight],[ReplaceVariable],[SpacerWidth],[SpacerHeight],[SortOrder],[SuppressReport],[SuppressOffice],[AnswerRequired],[NullReplace],[Deleted],[PhotoCollection],[PhotoCollectionReplaceVariable],[PhotoCollectionReplaceVariableNotTaken] FROM LegionellaAssetOutletQuestion	SELECT [LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SubTabTitle|VARCHAR|NULL||],[GroupTitle|VARCHAR|NULL||],[Description|VARCHAR|NOTNULL||],[EntryType|VARCHAR|NOTNULL||],[MaxLength|INTEGER|NOTNULL||],[DisplayNA|BIT|NOTNULL||],[QuestionWidth|INTEGER|NOTNULL||],[QuestionHeight|INTEGER|NOTNULL||],[AnswerWidth|INTEGER|NOTNULL||],[AnswerHeight|INTEGER|NOTNULL||],[ReplaceVariable|VARCHAR|NULL||],[SpacerWidth|INTEGER|NOTNULL||],[SpacerHeight|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[SuppressReport|BIT|NOTNULL||],[SuppressOffice|BIT|NOTNULL||],[AnswerRequired|BIT|NOTNULL||],[NullReplace|VARCHAR|NULL||],[Deleted|DATETIME|NULL||],[PhotoCollection|INTEGER|NULL||],[PhotoCollectionReplaceVariable|VARCHAR|NULL||],[PhotoCollectionReplaceVariableNotTaken|VARCHAR|NULL||] FROM @LegionellaAssetOutletQuestionTable
	DECLARE @LegionellaAssetOutletQuestionOptionOrInsertTable TABLE ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletQuestionOptionOrInsertTable ([LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletQuestionOptionOrInsertID],[LegionellaAssetOutletQuestionID],[Description],[SortOrder],[Deleted] FROM LegionellaAssetOutletQuestionOptionOrInsert	SELECT [LegionellaAssetOutletQuestionOptionOrInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaAssetOutletQuestionID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletQuestionOptionOrInsertTable

	DECLARE @LegionellaAssetOutletTaskAutoInsertTable TABLE ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaOutletCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaSectionID|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL ,[LegionellaOutletSentinel|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaAssetOutletTaskAutoInsertTable ([LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||])	Select [LegionellaAssetOutletTaskAutoInsertID],[LegionellaTaskAutoInsertID],[LegionellaAssetCategoryID],[LegionellaOutletCategoryID],[LegionellaSectionID],[SortOrder],[Deleted],[LegionellaOutletSentinel] FROM LegionellaAssetOutletTaskAutoInsert	SELECT [LegionellaAssetOutletTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaOutletCategoryID|INTEGER|NULL||],[LegionellaSectionID|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||],[LegionellaOutletSentinel|INTEGER|NULL||] FROM @LegionellaAssetOutletTaskAutoInsertTable

	DECLARE @LegionellaAssetOutletTaskQuestionTriggerTable TABLE ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaOutletEntryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL ,[CompareValue|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[SecondaryParameter_CompareValue|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[CompareType|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaAssetOutletTaskQuestionTriggerTable ([LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaAssetOutletTaskQuestionTriggerID],[LegionellaOutletEntryID],[LegionellaAssetOutletQuestionID],[SecondaryParameter_LegionellaAssetOutletQuestionID],[CompareValue],[SecondaryParameter_CompareValue],[CompareType],[LegionellaTaskAutoInsertID],[SortOrder],[Deleted] FROM LegionellaAssetOutletTaskQuestionTrigger	SELECT [LegionellaAssetOutletTaskQuestionTriggerID|INTEGER|NOTNULL||SERVERKEY],[LegionellaOutletEntryID|INTEGER|NULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||],[SecondaryParameter_LegionellaAssetOutletQuestionID|INTEGER|NULL||],[CompareValue|VARCHAR|NOTNULL||],[SecondaryParameter_CompareValue|VARCHAR|NULL||],[CompareType|VARCHAR|NOTNULL||],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaAssetOutletTaskQuestionTriggerTable
	DECLARE @LegionellaFrequencyCategoryTable TABLE ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddModifier|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[DateAddValue|INTEGER|NULL||] INT NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaFrequencyCategoryTable ([LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaFrequencyCategoryID],[Description],[DateAddModifier],[DateAddValue],[SortOrder],[Deleted] FROM LegionellaFrequencyCategory	SELECT [LegionellaFrequencyCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[DateAddModifier|VARCHAR|NULL||],[DateAddValue|INTEGER|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaFrequencyCategoryTable
	DECLARE @LegionellaOutletCategoryTable TABLE ([LegionellaOutletCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[TabName|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NOTNULL||] INT NOT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaOutletCategoryTable ([LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaOutletCategoryID],[Description],[TabName],[SortOrder],[Deleted] FROM LegionellaOutletCategory	SELECT [LegionellaOutletCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[TabName|VARCHAR|NULL||],[SortOrder|INTEGER|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaOutletCategoryTable
	DECLARE @LegionellaPriorityRatingTable TABLE ([LegionellaPriorityRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[ShortDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[PriorityColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaPriorityRatingTable ([LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaPriorityRatingID],[Description],[ShortDescription],[PriorityColour],[SortOrder],[Deleted] FROM LegionellaPriorityRating	SELECT [LegionellaPriorityRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[ShortDescription|VARCHAR|NULL||],[PriorityColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaPriorityRatingTable
	DECLARE @LegionellaRiskCategoryTable TABLE ([LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskCategoryTable ([LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskCategoryID],[Description],[SortOrder],[Deleted] FROM LegionellaRiskCategory	SELECT [LegionellaRiskCategoryID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskCategoryTable
	DECLARE @LegionellaRiskRatingTable TABLE ([LegionellaRiskRatingID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[RiskColour|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[SortOrder|INTEGER|NULL||] INT NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaRiskRatingTable ([LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaRiskRatingID],[Description],[RiskColour],[SortOrder],[Deleted] FROM LegionellaRiskRating	SELECT [LegionellaRiskRatingID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[RiskColour|VARCHAR|NULL||],[SortOrder|INTEGER|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaRiskRatingTable
	DECLARE @LegionellaSampleTypeTable TABLE ([LegionellaSampleTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaSampleTypeTable ([LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaSampleTypeID],[Description],[Deleted] FROM LegionellaSampleType	SELECT [LegionellaSampleTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaSampleTypeTable
	DECLARE @LegionellaTaskAutoInsertTable TABLE ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaRiskCategoryID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||] INT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertTable ([LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertID],[LegionellaRiskCategoryID],[LegionellaTaskAutoInsertTypeID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsert	SELECT [LegionellaTaskAutoInsertID|INTEGER|NOTNULL||SERVERKEY],[LegionellaRiskCategoryID|INTEGER|NOTNULL||],[LegionellaTaskAutoInsertTypeID|INTEGER|NULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertTable
	DECLARE @LegionellaTaskAutoInsertClientTable TABLE ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[ClientID|INTEGER|NOTNULL|Client|] INT NOT NULL ,[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||] INT NOT NULL ,[RiskDescription|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[Action|VARCHAR|NULL||] VARCHAR(MAX) NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaRiskRatingID|INTEGER|NULL||] INT NULL ,[LegionellaPriorityRatingID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTaskAutoInsertClientTable ([LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||])	Select [LegionellaTaskAutoInsertClientID],[ClientID],[LegionellaTaskAutoInsertID],[RiskDescription],[Action],[LegionellaFrequencyCategoryID],[LegionellaRiskRatingID],[LegionellaPriorityRatingID] FROM LegionellaTaskAutoInsertClient	SELECT [LegionellaTaskAutoInsertClientID|INTEGER|NOTNULL||SERVERKEY],[ClientID|INTEGER|NOTNULL|Client|],[LegionellaTaskAutoInsertID|INTEGER|NOTNULL||],[RiskDescription|VARCHAR|NULL||],[Action|VARCHAR|NULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaRiskRatingID|INTEGER|NULL||],[LegionellaPriorityRatingID|INTEGER|NULL||] FROM @LegionellaTaskAutoInsertClientTable
	DECLARE @LegionellaTaskAutoInsertTypeTable TABLE ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL )	INSERT INTO @LegionellaTaskAutoInsertTypeTable ([LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||])	Select [LegionellaTaskAutoInsertTypeID],[LegionellaTypeID],[LegionellaAssetCategoryID],[Description] FROM LegionellaTaskAutoInsertType	SELECT [LegionellaTaskAutoInsertTypeID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[Description|VARCHAR|NOTNULL||] FROM @LegionellaTaskAutoInsertTypeTable
	DECLARE @LegionellaTypeTable TABLE ([LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[Description|VARCHAR|NOTNULL||] VARCHAR(MAX) NOT NULL ,[TemplateTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaFrequencyCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaAssetCategoryID|INTEGER|NULL||] INT NULL ,[LegionellaMonitoring|BIT|NOTNULL||] BIT NOT NULL DEFAULT ((0)),[Deleted|DATETIME|NULL||] DATETIME NULL )	INSERT INTO @LegionellaTypeTable ([LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||])	Select [LegionellaTypeID],[Description],[TemplateTypeID],[LegionellaFrequencyCategoryID],[LegionellaAssetCategoryID],[LegionellaMonitoring],[Deleted] FROM LegionellaType	SELECT [LegionellaTypeID|INTEGER|NOTNULL||],[Description|VARCHAR|NOTNULL||],[TemplateTypeID|INTEGER|NOTNULL||],[LegionellaFrequencyCategoryID|INTEGER|NULL||],[LegionellaAssetCategoryID|INTEGER|NULL||],[LegionellaMonitoring|BIT|NOTNULL||],[Deleted|DATETIME|NULL||] FROM @LegionellaTypeTable
	DECLARE @LegionellaTypeConfigTable TABLE ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY] INT NOT NULL ,[LegionellaTypeID|INTEGER|NOTNULL||] INT NOT NULL ,[LegionellaAssetOutletQuestionID|INTEGER|NULL||] INT NULL )	INSERT INTO @LegionellaTypeConfigTable ([LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||])	Select [LegionellaTypeConfigID],[LegionellaTypeID],[LegionellaAssetOutletQuestionID] FROM LegionellaTypeConfig	SELECT [LegionellaTypeConfigID|INTEGER|NOTNULL||SERVERKEY],[LegionellaTypeID|INTEGER|NOTNULL||],[LegionellaAssetOutletQuestionID|INTEGER|NULL||] FROM @LegionellaTypeConfigTable


	SET NOCOUNT OFF;
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='App') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD App VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcIdMap') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcIdMap
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Version') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Version] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='Platform') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD [Platform] VARCHAR(50) NULL
END
GO

IF (Select COUNT(*) FROM sys.[all_columns] Where object_id IN (Select object_id FROM sys.tables Where name='MobileDtcLog') AND name='DeviceGuid') < 1
BEGIN
  ALTER TABLE MobileDtcLog
      ADD DeviceGuid UNIQUEIDENTIFIER NULL
END
GO

If (SELECT COUNT(*) FROM sys.objects WHERE type = 'P' AND name = 'mobile_CreateIdentityInsertStub') < 1 BEGIN
	EXEC('CREATE PROCEDURE [dbo].[mobile_CreateIdentityInsertStub] AS BEGIN SET NOCOUNT ON; END')
End
GO

ALTER PROC [dbo].[mobile_CreateIdentityInsertStub]
(
	@TableName VARCHAR(MAX),
	@TableID INT
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	SELECT
       'SET IDENTITY_INSERT ' + @TableName + ' ON; INSERT INTO [' + @TableName + '] (' + cF.Fields + ') SELECT ' + cV.[Values] + '; SET IDENTITY_INSERT ' + @TableName + ' OFF;'
	FROM
       sys.tables t
       CROSS APPLY
       (
              SELECT STUFF((
              SELECT
                     ',' + c.[name]
              FROM
                     sys.columns c
                     INNER JOIN sys.tables t ON c.object_id=t.object_id
              WHERE
                     t.name = @TableName
                           AND
                     c.is_nullable=0
              ORDER BY
                     column_id
              FOR XML PATH('')),1,1,''
              ) [Fields]
       ) cF
       CROSS APPLY
       (
              SELECT STUFF((
              SELECT
                     ',' +
                     CASE WHEN is_identity = 1 THEN
                           '' + CAST(@TableID as VARCHAR) + ''
                     ELSE
                           CASE system_type_id
                                  WHEN 48 THEN '0'
                                  WHEN 52 THEN '0'
                                  WHEN 56 THEN '0'
                                  WHEN 60 THEN '0'
                                  WHEN 62 THEN '0'
                                  WHEN 104 THEN '0'
                                  WHEN 106 THEN '0'
                                  WHEN 108 THEN '0'
                                  WHEN 122 THEN '0'
                                  WHEN 127 THEN '0'
                                  WHEN 165 THEN '0'
                                  WHEN 36 THEN '''00000000-0000-0000-0000-000000000000'''
                                  WHEN 40 THEN 'GETDATE()'
                                  WHEN 58 THEN 'GETDATE()'
                                  WHEN 61 THEN 'GETDATE()'
                                  WHEN 189 THEN 'GETDATE()'
                                  ELSE ''''''
                           END
                     END [FieldValue]
              FROM
                     sys.columns c
                     INNER JOIN sys.tables t ON c.object_id=t.object_id
              WHERE
                     t.name = @TableName
                           AND
                     c.is_nullable=0
              ORDER BY
                     column_id
              FOR XML PATH(''), TYPE).value('.', 'varchar(max)'),1,1,''
              ) [Values]
       ) cV
	WHERE
       t.name = @TableName
	
	SET NOCOUNT OFF;
	
END
GO

IF NOT EXISTS (SELECT 1 FROM sys.objects WHERE type = 'P' AND name = 'mobile_v2_NextSampleRefBySystemName')
BEGIN
    EXEC('CREATE PROCEDURE [dbo].[mobile_v2_NextSampleRefBySystemName] AS BEGIN SET NOCOUNT ON; END')
END
GO

ALTER PROC [dbo].[mobile_v2_NextSampleRefBySystemName]
(
	@SystemName nvarchar(MAX),
    @EmployeeID INT = 0,
	@DeviceGuid uniqueidentifier,
	@App VARCHAR(50),
	@Version VARCHAR(50),
	@Platform VARCHAR(50)
)
AS
BEGIN
	SET NOCOUNT ON;	
	
	DECLARE
		@enableLicensing BIT = (SELECT
									CASE
										WHEN DATEDIFF(MINUTE, (SELECT ISNULL(s__EnableMobileLicensing, DATEADD(DAY, -1, GETDATE())) FROM Config), GETDATE()) <= 5
										THEN 1
									ELSE
										0
									END)	

	DECLARE @SampleRefList TABLE (SampleRef VARCHAR(MAX))
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM Sample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM Sample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRef FROM AirSample WHERE SampleRef LIKE @SystemName + '%' AND SampleRef NOT LIKE '%{%'  ORDER BY SampleRef DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) FROM AirSample WHERE SampleRef LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRef, PATINDEX('%{%', SampleRef) + 1, LEN(SampleRef) - PATINDEX('%{%', SampleRef)) DESC 
	
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefCold FROM LegionellaSample WHERE SampleRefCold LIKE @SystemName + '%' AND SampleRefCold NOT LIKE '%{%'  ORDER BY SampleRefCold DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) FROM LegionellaSample WHERE SampleRefCold LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefCold, PATINDEX('%{%', SampleRefCold) + 1, LEN(SampleRefCold) - PATINDEX('%{%', SampleRefCold)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefHot FROM LegionellaSample WHERE SampleRefHot LIKE @SystemName + '%' AND SampleRefHot NOT LIKE '%{%'  ORDER BY SampleRefHot DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) FROM LegionellaSample WHERE SampleRefHot LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefHot, PATINDEX('%{%', SampleRefHot) + 1, LEN(SampleRefHot) - PATINDEX('%{%', SampleRefHot)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMixed FROM LegionellaSample WHERE SampleRefMixed LIKE @SystemName + '%' AND SampleRefMixed NOT LIKE '%{%'  ORDER BY SampleRefMixed DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) FROM LegionellaSample WHERE SampleRefMixed LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMixed, PATINDEX('%{%', SampleRefMixed) + 1, LEN(SampleRefMixed) - PATINDEX('%{%', SampleRefMixed)) DESC 
	INSERT INTO @SampleRefList (SampleRef) SELECT SampleRefMains FROM LegionellaSample WHERE SampleRefMains LIKE @SystemName + '%' AND SampleRefMains NOT LIKE '%{%'  ORDER BY SampleRefMains DESC
	INSERT INTO @SampleRefList (SampleRef) SELECT SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) FROM LegionellaSample WHERE SampleRefMains LIKE '%{' + @SystemName + '%' ORDER BY SUBSTRING(SampleRefMains, PATINDEX('%{%', SampleRefMains) + 1, LEN(SampleRefMains) - PATINDEX('%{%', SampleRefMains)) DESC 
	
	DECLARE @SampleRefIntList TABLE (SampleRef INT)
	INSERT INTO @SampleRefIntList SELECT TOP 1 NULLIF(REPLACE(SampleRef,@SystemName,''),'') FROM @SampleRefList WHERE ISNUMERIC(REPLACE(SampleRef,@SystemName,''))=1 ORDER BY SampleRef DESC

	
	IF @enableLicensing = 1
		BEGIN
			INSERT INTO MobileAuditTrail (Category, SystemName, Message, DataTable, DataID, DataScript, DataQueryString, DataIPAddress, DateCreated, EmployeeID,DeviceGuid,App,[Version],[Platform])
			SELECT 2, @SystemName, 'Attempted Connection', 'MobileAuditTrail', 0, 'mobile_v2_NextSampleRefBySystemName', '0.0.0.0', '0.0.0.0', GETDATE(), @EmployeeID, @DeviceGuid,@App,@Version,@Platform

			SELECT ISNULL((SELECT TOP 1 SampleRef FROM @SampleRefIntList Order By SampleRef DESC),0)+1
		END
	ELSE
		BEGIN
			SELECT ''
		END
	
	SET NOCOUNT OFF;
	
END
GO